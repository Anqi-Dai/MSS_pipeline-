scale_fill_manual(values = color_set) +
facet_grid(Condition ~ Group, scales = 'free')
ggsave('../data/06_FMT_bar.pdf', width = 5, height = 4)
ggsave('../data/06_FMT_bar.pdf', width = 3, height = 3)
ggsave('../data/06_FMT_bar.pdf', width = 4, height = 3)
ggsave('../data/06_FMT_bar.pdf', width = 5, height = 4)
View(pheno)
# alpha diversity
shotgunalpha <- pheno %>%
filter(sampleid %in% barshot$sampleid)
View(shotgunalpha)
View(barshot)
shotgunalpha
# alpha diversity
shotgunalpha <- pheno %>%
filter(sampleid %in% barshot$sampleid) %>%
select(sampleid:Condition, alpha)
alpha16s <- asv_alpha_diversity_ag %>%
filter(sampleid %in% amplisamp)
View(alpha16s)
alpha16s
alpha16s <- asv_alpha_diversity_ag %>%
filter(sampleid %in% amplisamp) %>%
select(sampleid, alpha = simpson_reciprocal)
alpha16s <- asv_alpha_diversity_ag %>%
filter(sampleid %in% amplisamp) %>%
select(sampleid, alpha = simpson_reciprocal) %>%
mutate(
Group = if_else(sampleid == '1964A', 'Responder', 'Non-Responder'),
Condition = 'donor'
)
both_alpha <- bind_rows(shotgunalpha, alpha16s)
both_alpha
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha')
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid( ~ Group, scales = 'free')
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid( ~ Group, scales = 'free')
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha')
View(both_alpha)
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid( ~ Group, scales = 'free')
# alpha diversity
shotgunalpha <- pheno %>%
filter(sampleid %in% barshot$sampleid) %>%
select(sampleid:Condition, alpha) %>%
mutate(Group = if_else(sampleid == 'PH131', 'Responder',Group ),
Condition = if_else(sampleid == 'PH131', 'Slurry',Condition ))
both_alpha <- bind_rows(
shotgunalpha %>% mutate(data = 'shotgun'),
alpha16s %>% mutate(data = '16S')
)
# alpha diversity
shotgunalpha <- pheno %>%
filter(sampleid %in% barshot$sampleid) %>%
select(sampleid:Condition, alpha) %>%
mutate(Group = if_else(sampleid == 'PH131', 'Responder',Group ),
Condition = if_else(sampleid == 'PH131', 'Slurry',Condition ))
alpha16s <- asv_alpha_diversity_ag %>%
filter(sampleid %in% amplisamp) %>%
select(sampleid, alpha = simpson_reciprocal) %>%
mutate(
Group = if_else(sampleid == '1964A', 'Responder', 'Non-Responder'),
Condition = 'donor'
)
both_alpha <- bind_rows(
shotgunalpha %>% mutate(data = 'shotgun'),
alpha16s %>% mutate(data = '16S')
)
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid(data ~ Group, scales = 'free')
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'dotplot') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid(data ~ Group, scales = 'free')
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid(data ~ Group, scales = 'free')
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
facet_grid(data ~ Group, scales = 'free')
color_key <- both_alpha %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_color_manual(values = color_key) +
facet_grid(data ~ Group, scales = 'free')
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter', color = 'Group') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_color_manual(values = color_key) +
facet_grid(data ~ Group, scales = 'free')
color_key <- both_alpha %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter', color = 'Group') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_color_manual(values = color_key) +
facet_grid(data ~ Group, scales = 'free')
color_key <- both_alpha %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
both_alpha
both_alpha
color_key <- both_alpha %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter', color = 'Group') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_color_manual(values = color_key) +
facet_grid(data ~ Group, scales = 'free')
# alpha diversity
shotgunalpha <- pheno %>%
filter(sampleid %in% barshot$sampleid) %>%
select(sampleid:Condition, alpha) %>%
mutate(Group = if_else(sampleid == 'PH131', 'Responder',Group ),
Condition = if_else(sampleid == 'PH131', 'Slurry',Condition ))
alpha16s <- asv_alpha_diversity_ag %>%
filter(sampleid %in% amplisamp) %>%
select(sampleid, alpha = simpson_reciprocal) %>%
mutate(
Group = if_else(sampleid == '1964A', 'Responder', 'Non-Responder'),
Condition = 'donor'
)
both_alpha <- bind_rows(
shotgunalpha %>% mutate(data = 'shotgun'),
alpha16s %>% mutate(data = '16S')
)
color_key <- both_alpha %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
both_alpha %>%
mutate(Condition = factor(Condition, levels = c('donor','Slurry','Pre-A20','2nd Week post-CAR T cells'))) %>%
ggboxplot(x = 'Condition', y = 'alpha', add = 'jitter', color = 'Group') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_color_manual(values = color_key) +
facet_grid(data ~ Group, scales = 'free')
ggsave('../data/06_FMT_alpha.pdf', width = 5, height = 6)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
abx <- read_csv('../data/abx_experiment_pheno.csv')
View(abx)
abx <- read_csv('../data/abx_experiment_pheno.csv')
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
View(pheno)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
abx <- read_csv('../data/abx_experiment_pheno.csv')
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
knitr::opts_chunk$set(echo = TRUE)
fns <- list.files('../../shotgun_pipeline/data/IGO_13852/', pattern = 'metaphlan3_profile.txt', full.names = T)
taxa <- fns %>%
set_names(fns) %>%
map(~ read_tsv(., skip = 4, col_types = 'ccddd') %>%
rename(clade_name = names(.)[1]) %>%
select(clade_name, relative_abundance) %>%
filter(str_detect(clade_name, 's__')) %>%
mutate(relative_abundance = relative_abundance/100)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(sampleid = str_replace(sampleid, '../../shotgun_pipeline/data/IGO_13852//Sample_',''),
sampleid = str_replace(sampleid, '_IGO_.+$',''))
taxa %>% write_csv('../data/01_all_metaphlan.csv')
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
library(vegan)
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
View(meta_mouse)
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)
abx <- read_csv('../data/abx_experiment_pheno.csv')
abx <- read_csv('../data/abx_experiment_pheno.csv')
abx <- read_csv('../data/abx_experiment_pheno.csv')
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)
View(abx)
abx
abx %>%
ggboxplot( x = 'Group', y = 'inv', facet.by = 'Condition')
abx %>%
ggboxplot( x = 'Group', y = 'inv') +
facet_grid( ~ Condition)
abx %>%
ggboxplot( x = 'Group', y = 'inv', add = 'jitter') +
facet_grid( ~ Condition)
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)  %>% # 26 samples
mutate(grp = if_else(Group == '1B', 'control', 'treatment'))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter') +
facet_grid( ~ Condition)
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter') +
facet_grid( ~ Condition) +
theme(axis.text.x = element_text(angle = 45))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter') +
facet_grid( ~ Condition) +
theme(axis.text.x = element_text(angle = 90))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter',
add.params = list(color = 'red', size = 2)) +
facet_grid( ~ Condition) +
theme(axis.text.x = element_text(angle = 90))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter',
add.params = list(color = 'grp', size = 2)) +
facet_grid( ~ Condition) +
theme(axis.text.x = element_text(angle = 90))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter',
add.params = list(color = 'grp', size = 2)) +
facet_grid( ~ Condition) +
scale_color_manual(values = c('#42B440','#EC0000')) +
theme(axis.text.x = element_text(angle = 90))
abx %>%
ggboxplot( x = 'grp', y = 'inv', add = 'jitter',ylab = 'alpha diversity' ,
add.params = list(color = 'grp', size = 2)) +
facet_grid( ~ Condition) +
scale_color_manual(values = c('#42B440','#EC0000')) +
theme(axis.text.x = element_text(angle = 90))
ggsave('../data/07_abx_experiment_alpha.pdf', height = 6)
ggsave('../data/07_abx_experiment_alpha.pdf', height = 5)
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)  %>% # 26 samples
mutate(grp = if_else(Group == '1B', 'control', 'treatment'))
fns <- list.files('../../shotgun_pipeline/data/IGO_13852/', pattern = 'metaphlan3_profile.txt', full.names = T)
taxa <- fns %>%
set_names(fns) %>%
map(~ read_tsv(., skip = 4, col_types = 'ccddd') %>%
rename(clade_name = names(.)[1]) %>%
select(clade_name, relative_abundance) %>%
filter(str_detect(clade_name, 's__')) %>%
mutate(relative_abundance = relative_abundance/100)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(sampleid = str_replace(sampleid, '../../shotgun_pipeline/data/IGO_13852//Sample_',''),
sampleid = str_replace(sampleid, '_IGO_.+$',''))
taxa %>% write_csv('../data/01_all_metaphlan.csv')
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)  %>% # 26 samples
mutate(grp = if_else(Group == '1B', 'control', 'treatment'))
abx <- read_csv('../data/abx_experiment_pheno.csv') %>%
inner_join(meta_mouse)  %>% # 26 samples
mutate(grp = if_else(Group == '1B', 'control', 'treatment'))
View(abx)
abx %>% write_csv('../data/abx_experiment_pheno_alpha.csv')
# the bar plot using the same palette
all  <- read_csv('../data/01_all_metaphlan.csv')
genus <- all %>%
mutate(genus = str_replace(clade_name, '\\|s__.+$','')) %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(relative_abundance)) %>%
ungroup() %>%
mutate(ge = str_extract(genus, 'g__.+$'),
genus = str_replace(ge, 'g__', '')) %>%
inner_join(abx) %>%
select(-ge)
View(genus)
# the bar plot using the same palette
all  <- read_csv('../data/01_all_metaphlan.csv')
library(vdbR)
connect_database()
get_table_from_database('asv_annotation_blast_color_ag')
View(asv_annotation_blast_color_ag)
# the genus that can find color in the 16s pal
pals <- asv_annotation_blast_color_ag %>%
filter(genus %in% genus$genus)
genus <- all %>%
mutate(genus = str_replace(clade_name, '\\|s__.+$','')) %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(relative_abundance)) %>%
ungroup() %>%
mutate(ge = str_extract(genus, 'g__.+$'),
genus = str_replace(ge, 'g__', '')) %>%
inner_join(abx) %>%
select(-ge)
# the genus that can find color in the 16s pal
pals <- asv_annotation_blast_color_ag %>%
filter(genus %in% genus$genus)
# the bar plot using the same palette
all  <- read_csv('../data/01_all_metaphlan.csv')
genus_ <- all %>%
mutate(genus = str_replace(clade_name, '\\|s__.+$','')) %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(relative_abundance)) %>%
ungroup() %>%
mutate(ge = str_extract(genus, 'g__.+$'),
genus = str_replace(ge, 'g__', '')) %>%
inner_join(abx) %>%
select(-ge)
# the genus that can find color in the 16s pal
pals <- asv_annotation_blast_color_ag %>%
filter(genus %in% genus_$genus)
View(pals)
# the genus that can find color in the 16s pal
pals <- asv_annotation_blast_color_ag %>%
filter(genus %in% genus_$genus) %>%
distinct(genus,color_label_group_distinct, color)
length(intersect(asv_annotation_blast_color_ag$genus, genus_$genus))
pals
# the genus that can find color in the 16s pal
pals <- asv_annotation_blast_color_ag %>%
filter(genus %in% genus_$genus) %>%
distinct(genus,color_label_group_distinct, color) %>%
add_row(genus = 'Other', color_label_group_distinct = 'other__other.164', color = '#BBBBBB') %>%
rename(genus_cleaned = genus)
genus_ <- all %>%
mutate(genus = str_replace(clade_name, '\\|s__.+$','')) %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(relative_abundance)) %>%
ungroup() %>%
mutate(ge = str_extract(genus, 'g__.+$'),
genus = str_replace(ge, 'g__', '')) %>%
inner_join(abx) %>%
select(-ge) %>%
mutate(genus_cleaned = if_else(genus %in% asv_annotation_blast_color_ag$genus, genus, 'Other'))
genus_df <- genus_ %>%
left_join(pals)
genus_df <- genus_ %>%
left_join(pals, by = "genus_cleaned")
View(genus_df)
color_set <- pals %>%
select(color_label_group_distinct, color) %>%
deframe()
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set)
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set)
View(abx)
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(Condition ~ grp, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
ggsave('../data/07_abx_bar.pdf', width = 5, height = 4)
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
genus_df %>%
ggplot(aes(sampleid, relab, fill = color_label_group_distinct) ) +
geom_bar(stat = "identity", position="fill", width = 1) +
theme_classic() +
labs(title = '',
x = '',
y = 'Relative abundance') +
theme(axis.text.x = element_text(angle = 90),
legend.position = "none") +
scale_fill_manual(values = color_set) +
facet_grid(grp ~ Condition, scales = 'free')
ggsave('../data/07_abx_bar.pdf', width = 5, height = 4)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
FMT <- read_csv('../data/01_FMT_pheno.csv')
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
# PH131 is the slurry of 1964A which is the 16s responder patient stool that FMT to the mice
# PH132 is the slurry of 1943B which is the 16s nonresponder patient stool that FMT to the mice
