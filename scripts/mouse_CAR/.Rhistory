theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/01_PH_alpha.pdf', width = 12, height = 5)
pheno %>%
arrange(Date_Collected) %>%
mutate(Condition = factor(Condition, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list(color = 'blue', size = 2)) +
facet_grid(. ~ Condition, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/01_PH_alpha.pdf', width = 12, height = 5)
pheno %>% write_csv('../data/01_pheno_with_alpha.csv')
knitr::opts_chunk$set(echo = TRUE)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
get_table_from_database('asv_alpha_diversity_ag')
View(asv_alpha_diversity_ag)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
library(tidyverse)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
library(tidyverse)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
View(pheno)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(vegan)
library(lubridate)
library(vdbR)
connect_database()
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
View(asv_alpha_diversity_ag)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
View(pheno)
fns <- list.files('../../shotgun_pipeline/data/IGO_13852/', pattern = 'metaphlan3_profile.txt', full.names = T)
taxa <- fns %>%
set_names(fns) %>%
map(~ read_tsv(., skip = 4, col_types = 'ccddd') %>%
rename(clade_name = names(.)[1]) %>%
select(clade_name, relative_abundance) %>%
filter(str_detect(clade_name, 's__')) %>%
mutate(relative_abundance = relative_abundance/100)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(sampleid = str_replace(sampleid, '../../shotgun_pipeline/data/IGO_13852//Sample_',''),
sampleid = str_replace(sampleid, '_IGO_.+$',''))
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
View(meta_mouse)
View(pheno)
View(pheno)
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv') %>%
left_join(pheno)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(vegan)
library(lubridate)
pheno <- read_csv('../data/01_pheno_with_alpha.csv')
View(pheno)
fns <- list.files('../../shotgun_pipeline/data/IGO_13852/', pattern = 'metaphlan3_profile.txt', full.names = T)
taxa <- fns %>%
set_names(fns) %>%
map(~ read_tsv(., skip = 4, col_types = 'ccddd') %>%
rename(clade_name = names(.)[1]) %>%
select(clade_name, relative_abundance) %>%
filter(str_detect(clade_name, 's__')) %>%
mutate(relative_abundance = relative_abundance/100)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(sampleid = str_replace(sampleid, '../../shotgun_pipeline/data/IGO_13852//Sample_',''),
sampleid = str_replace(sampleid, '_IGO_.+$',''))
taxa %>% write_csv('../data/01_all_metaphlan.csv')
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv') %>%
left_join(pheno)
pheno <- read_csv('../data/PH_meta.csv') %>%
mutate(Date_Collected = mdy(Date_Collected)) %>%
left_join(meta_mouse, by = "sampleid") %>%
rename(alpha = inv)
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
pheno <- read_csv('../data/PH_meta.csv') %>%
mutate(Date_Collected = mdy(Date_Collected)) %>%
left_join(meta_mouse, by = "sampleid") %>%
rename(alpha = inv)
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv') %>%
left_join(pheno)
pheno <- read_csv('../data/PH_meta.csv')
View(pheno)
pheno <- read_csv('../data/PH_meta.csv') %>%
mutate(Date_Collected = mdy(Date_Collected))
pheno
View(meta_mouse)
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv')%>%
enframe(name = 'sampleid', value = 'inv')
pheno <- read_csv('../data/PH_meta.csv') %>%
mutate(Date_Collected = mdy(Date_Collected))
pheno <- read_csv('../data/PH_meta.csv') %>%
mutate(Date_Collected = mdy(Date_Collected)) %>%
left_join(meta_mouse, by = "sampleid") %>%
rename(alpha = inv)
pheno %>% write_csv('../data/01_pheno_with_alpha.csv')
View(pheno)
FMT <- pheno %>%
filter(str_detect(Group, 'Responder'))
View(FMT)
FMT %>% write_csv('../data/01_FMT_pheno.csv')
suboptimal <- tibble(
sampleid = c('PH99',
'PH88',
'PH130',
'PH11',
'PH100',
'PH10',
'PH117',
'PH89',
'PH16',
'PH98')
)
View(suboptimal)
suboptimal <- tibble(
sampleid = c(
'PH99',
'PH88',
'PH130',
'PH11',
'PH100',
'PH10',
'PH117',
'PH89',
'PH16',
'PH98')
)
suboptimal <- tibble(
sampleid = c(
'PH99',
'PH88',
'PH130',
'PH11',
'PH100',
'PH10',
'PH117',
'PH89',
'PH16',
'PH98')
)
length(intersect(suboptimal$sampleid, FMT$sampleid))
intersect(suboptimal$sampleid, FMT$sampleid)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
pheno <- read_csv('data/01_FMT_pheno.csv')
View(pheno)
order_level <- pheno %>%
distinct(Condition, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(Condition)
order_level
pheno %>%
arrange(Date_Collected) %>%
#mutate(Condition = factor(Condition, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list(color = 'blue', size = 2)) +
facet_grid(. ~ Condition, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
pheno %>%
#arrange(Date_Collected) %>%
mutate(Condition = factor(Condition, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list(color = 'blue', size = 2)) +
facet_grid(. ~ Condition, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
pheno
pheno <- read_csv('data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' Cells',''))
pheno <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' Cells',''))
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' Cells',''))
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' ells',''))
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' cells',''))
order_level <- FMT %>%
distinct(Condition, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(Condition)
FMT %>%
#arrange(Date_Collected) %>%
mutate(Condition = factor(Condition, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list(color = 'blue', size = 2)) +
facet_grid(. ~ Condition, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 12, height = 5)
FMT
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' cells','')) %>%
mutate(condition_simple = case_when(
Condition == '1st Collection (2 days) post-CAR T' ~ 'Week1 post-CAR',
TRUE
))
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' cells','')) %>%
mutate(condition_simple = case_when(
Condition == '1st Collection (2 days) post-CAR T' ~ 'Week1 post-CAR',
TRUE ~ Condition
))
order_level
FMT <- read_csv('../data/01_FMT_pheno.csv') %>%
mutate(Condition = str_replace(Condition, ' cells','')) %>%
mutate(condition_simple = case_when(
Condition == '1st Collection (2 days) post-CAR T' ~ 'Week1 post-CAR',
Condition == '2nd Week post-CAR T' ~ 'Week2 post-CAR',
Condition == '3rd Week post-CAR T' ~ 'Week3 post-CAR',
Condition == '4th Week post-CAR T' ~ 'Week4 post-CAR',
Condition == '5th Week post-CAR T' ~ 'Week5 post-CAR',
TRUE ~ Condition
))
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list(color = 'blue', size = 2)) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 12, height = 5)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
palette = 'jco',
xlab = '', ylab = 'alpha diversity') +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
palette = 'nejm',
xlab = '', ylab = 'alpha diversity') +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
FMT
color_key <- FMT %>%
distinct(Group)
color_key
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000'))
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
color_key
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.signif",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
?stat_compare_means
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 4)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 5)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 2),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 6)
order_level <- FMT %>%
distinct(condition_simple, Date_Collected) %>%
arrange(Date_Collected) %>%
pull(condition_simple)
color_key <- FMT %>%
distinct(Group) %>%
mutate(color = c('#42B440','#EC0000')) %>%
deframe()
FMT %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'alpha', add = 'jitter', add.params = list( size = 3),color = 'Group',
xlab = '', ylab = 'alpha diversity') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 6, height = 6)
ggsave('../data/03_PH_alpha_FMT.pdf', width = 8, height = 6)
taxa <- read_csv('../data/01_all_metaphlan.csv')
View(taxa)
taxa <- read_csv('../data/01_all_metaphlan.csv') %>%
filter(sampleid %in% FMT$sampleid)
rumino <- taxa %>% filter(str_detect(clade_name, 'Rumino'))
View(rumino)
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae'))
View(rumino_fam)
taxa
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance))
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance)) %>%
inner_join(FMT)
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance)) %>%
inner_join(FMT, by = "sampleid")
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance))
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance)) %>%
inner_join(FMT, by = "sampleid")
rumino_fam
rumino_fam %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'rumino_family', add = 'jitter', add.params = list( size = 3),color = 'Group',
xlab = '', ylab = 'Ruminococcaceae relative abundance') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_Ruminococcaceae_FMT.pdf', width = 8, height = 6)
rumino_fam
rumino_fam %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'rumino_family', add = 'jitter', add.params = list( size = 3),color = 'Group',
xlab = '', ylab = 'Ruminococcaceae relative abundance') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_Ruminococcaceae_FMT.pdf', width = 8, height = 6)
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance))
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance)) %>%
right_join(FMT, by = "sampleid")
# g__Blautia|s__Ruminococcus_gnavus and g__Blautia|s__Ruminococcus_torques
# use the family level
rumino_fam <- taxa %>% filter(str_detect(clade_name, 'f__Ruminococcaceae')) %>%
group_by(sampleid) %>%
summarise(rumino_family = sum(relative_abundance)) %>%
right_join(FMT, by = "sampleid") %>%
mutate(rumino_family = if_else(is.na(rumino_family), 0, rumino_family))
rumino_fam %>%
#arrange(Date_Collected) %>%
mutate(condition_simple = factor(condition_simple, levels = order_level)) %>%
ggboxplot(x = 'Group', y = 'rumino_family', add = 'jitter', add.params = list( size = 3),color = 'Group',
xlab = '', ylab = 'Ruminococcaceae relative abundance') +
scale_color_manual(values = color_key) +
facet_grid(. ~ condition_simple, scales = 'free') +
theme(axis.text.x=element_text(angle = 90, hjust = 0)) +
stat_compare_means(comparisons= list(c('Responder', 'Non-Responder')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/03_Ruminococcaceae_FMT.pdf', width = 8, height = 6)
