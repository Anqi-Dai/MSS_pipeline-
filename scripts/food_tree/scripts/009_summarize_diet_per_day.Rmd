---
title: "Summarise food group & nutrients by gram and perc per day per patient"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Summarize the diet data by day for each patient. and get the gram weight and the percentage for the food group and nutrients. 

```{r}
library(tidyverse)
```

```{r}
dtb <- read_csv('../data/cleaned_diet_data/FINAL_97_with_code_all_foods.csv') 
ptb <- read_csv('../data/cleaned_patients/diet_patients_97.csv')  

dtb1 <- dtb %>% 
  left_join(ptb %>% select(mrn, hct), by = "mrn") %>% 
  mutate(fdrt = Date - hct) %>% 
  select(-hct, -Date)  
```
 

```{r}
nutrients_df <- filled %>% 
  select(mrn, DayRT, Proteing_g:Sodium_g) %>% 
  gather('nutrient', 'gram', names(.)[3]:names(.)[ncol(.)]) 
nutrients_day_nut_total  <- nutrients_df %>% 
  group_by(mrn, DayRT, nutrient) %>% 
  summarise(nut_day_total = sum(gram))
# the denominator is all the nutrients summed together for that day for that patient
nutrients_day_denomi <- nutrients_df %>% 
  group_by(mrn, DayRT) %>% 
  summarise(all_tol_day = sum(gram))
nutrients_all  <- nutrients_day_nut_total %>% 
  left_join(nutrients_day_denomi) %>% 
  mutate(nut_day_perc = round(nut_day_total/all_tol_day, 2)) %>% 
  mutate(nutrient = str_replace(nutrient, '_g$','')) %>% 
  mutate(nutrient = str_glue('Nut_{nutrient}'))
```