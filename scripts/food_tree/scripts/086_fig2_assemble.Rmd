---
title: "Figure 2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(cowplot)
```

```{r}
axis_text_size <- 10
axis_title_size <- 10
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
```

# fig2 main figure

```{r 2a_procrustes}
procrustes_Nday_score <- read_csv('../data/022_procrustes_Nday_score.csv')
macro_pro <- read_csv('../data/091_macro_procrustes_Nday_score.csv')

two_score <- bind_rows(
  procrustes_Nday_score %>% mutate(grp = 'Food group based'), 
  macro_pro %>% mutate(grp = 'Macronutrient based')
)
```


```{r 2a_procrustes}
f2a <- two_score %>% 
  mutate(pNd = str_extract(pNd, '\\d')) %>% 
  arrange(desc(grp)) %>% 
  ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
  geom_line(size = 0.3) +
  geom_point(size = 1.3) +
  labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
  scale_color_manual(values = c('black','gray60')) +
  theme_classic()  +
  theme(aspect.ratio=1,
        #legend.position = 'none',
        axis.text=element_text(size=axis_text_size), 
        legend.title  = element_blank(),
        axis.title=element_text(size=axis_text_size),
        axis.text.x = element_text(angle=0, hjust=0.5)) 
    
f2a
```
```{r 2b_diagram}
p <- '../figs/paper/cartoon_of_model.png'
diagram <- ggdraw() +
  draw_image(magick::image_read(p),   scale = 0.9) 
diagram 
```

```{r 2c_div_fg9}

f2c <- read_rds('../data/068_div_post_ridge.rds')
#f2d <- read_rds('../data/068_only3_sim.rds')


#f2e <- read_rds('../data/087_entero_genus_fg_main.rds')
f2e <- read_rds('../data/120_F2E_extra_genera.rds')


```

```{r}



# new version that is without the diversity prediction thing
left <- cowplot::align_plots(f2a, f2c, align = 'v', axis = 'l')

top <- plot_grid(left[[1]], diagram, labels = c('A', 'B'),rel_widths  = c(1.2, 1) )

bottom <- plot_grid(  left[[2]],f2e,
                  nrow = 1, labels = c('C','D'), rel_widths  = c(1, 1), align = 'hv')

f2 <-  plot_grid(top,bottom,
                 rel_heights = c(1,1),
                 nrow = 2)
f2

ggsave('../data/F2_model_results_086_new.pdf',
       width = 220,
       height = 170,
         #height = 60,
         units = c("mm"),
         dpi = 400, plot = f2)
```





```{r align}
# output a version just for the legend of fig2A
f2a_legend <- two_score %>% 
  mutate(pNd = str_extract(pNd, '\\d')) %>% 
  arrange(desc(grp)) %>% 
  ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
  geom_line(size = 0.3) +
  geom_point(size = 1.3) +
  labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
  scale_color_manual(values = c('black','gray60')) +
  theme_classic()  +
  theme(aspect.ratio=1,
        #legend.position = 'none',
        axis.text=element_text(size=8), 
        legend.title  = element_blank(),
        axis.title=element_text(size=8),
        axis.text.x = element_text(angle=0, hjust=0.5)) 

#ggsave('../figs/paper/f2a_legend.pdf', plot =f2a_legend )
```

# accompanying supplementary figure

```{r}
div_fac <- read_rds('../data/068_diversity_factor_forest.rds')
enter_fac <- read_rds('../data/087_entero_genus_factor_forest.rds')
fac2 <- plot_grid(  div_fac,enter_fac,
                  nrow = 1, labels = c('A','B'), rel_widths = c(1, 1))

ggsave('../data/S5_div_entero_factor_086.pdf',
       width = 170,
       height = 60, 
         #height = 60,
         units = c("mm"),
         dpi = 400, device = 'pdf', plot = fac2)


```

# accompanying supp figures of the prior simulation of the div and enterococcus model

```{r}
div_prior <- read_rds('../data/068_prior_diversity_hist.rds')
enter_prior <- read_rds('../data/087_prior_enterococcus_hist.rds')
prior <- plot_grid(  div_prior,enter_prior,
                  nrow = 1, labels = c('A','B'), rel_widths = c(1, 1))

ggsave('../figs/paper/S4_div_entero_prior_086.pdf',
       width = 170, height = 60, units = c("mm"),
         dpi = 400, device = 'pdf', plot = prior)

```


```{r}
# to put the fg-div two plots together
div2 <- plot_grid(  f2c,div_fac,
                  nrow = 1, labels = c('A','B'), rel_widths = c(1, 1))

ggsave('../data/086_div_fg_2_086.jpg',
       width = 170, height = 60, units = c("mm"),
         dpi = 400, device = 'jpg', plot = div2)
```

