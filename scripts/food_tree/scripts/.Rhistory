# fg_order <- dtb %>% distinct(Food_code) %>% mutate(fgrp1 = str_sub(as.character(Food_code),1, 1)) %>%
#   count(fgrp1) %>%
#   full_join(key) %>% arrange(n) %>% pull(shortname)
# calculate the percentage of > 0 and < 0 and annotate that to the figure
percs <- post_coeff %>%
count(shortname, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc') %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%'))
# sort the fg in the negative perc desc order
fg_order <- percs %>% arrange(neg_num) %>% pull(shortname)
# Install scales R package
library("scales")
# Amount of default colors
hex_codes1 <- hue_pal()(2)                             # Identify hex codes
hex_codes1
div_post_ridge <- post_coeff %>%
left_join(percs) %>%
mutate(shortname = factor(shortname, levels = fg_order)) %>%
ggplot(aes(x = coeff, y = shortname, fill = after_stat(x > 0))) +
stat_pointinterval(.width = c(.66, .95)) +stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = 'ln(diversity) change per 100g of food',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
#scale_color_manual(values = c("#F8766D", "#00BFC4")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
div_post_ridge
div_post_ridge %>%
write_rds('../data/068_div_post_ridge.rds')
div_post_ridge
div_post_ridge
fg_order
percs %>% arrange(neg_num) %>% select(shortname)
percs %>% arrange(neg_num) %>% select(shortname) %>% write_csv('../data/068_fg_sorting_order.csv')
knitr::opts_chunk$set(echo = TRUE)
fg_order <- read_csv('../data/068_fg_sorting_order.csv')
fg_order
fg_order <- read_csv('../data/068_fg_sorting_order.csv') %>% pull(shortname)
post <- bind_rows(entero, extra5) %>%
select(genus, starts_with('b_fg')) %>%
gather('item','coeff', names(.)[2]:names(.)[ncol(.)])
# import the model post results
entero <- read_csv('../data/087_Enterococcus_model_fg_post.csv') %>%
mutate(genus = 'Enterococcus') %>%
relocate(genus, .before = b_fg_fruit)
extra5 <- read_csv('../data/087_genus_foodgroup_model_post_extra_few.csv')
post <- bind_rows(entero, extra5) %>%
select(genus, starts_with('b_fg')) %>%
gather('item','coeff', names(.)[2]:names(.)[ncol(.)])
post_res_genera <- post %>%
group_by(genus, item) %>%
summarise(q50 = median(coeff),
q2.5 = quantile(coeff, probs = 0.025),
q97.5 = quantile(coeff, probs = 0.975),
q12.5 = quantile(coeff, probs = 0.125),
q87.5 = quantile(coeff, probs = 0.875),
q1.25 = quantile(coeff, probs = 0.0125),
q98.75 = quantile(coeff, probs = 0.9875),
q0.5 = quantile(coeff, probs = 0.005),
q99.5 = quantile(coeff, probs = 0.995)
) %>%
ungroup() %>%
mutate(mark = if_else(q99.5 < 0 | q0.5 > 0, '***', if_else(q98.75 < 0 | q1.25 > 0, '**', if_else(q97.5 < 0 | q2.5 > 0, '*', '')))) %>%
mutate(color = if_else(q87.5 < 0, 'steelblue', if_else(q12.5 > 0, 'maroon', 'white'))) %>%
mutate(item = str_replace(item, 'b_ave_','')) %>%
mutate(item = str_to_title(item)) %>%
mutate(item = str_replace(item, 'B_','')) %>%
left_join(key %>% select(item = fg1_name, shortname))
# calculate the percentage of interval that is >|< 0 for each genus/food combo
fg_order <- read_csv('../data/068_fg_sorting_order.csv') %>% pull(shortname)
perc_side <- post %>%
group_by(genus,item ) %>%
count(coeff >= 0) %>%
mutate(perc = round(n/4000, 2)) %>%
mutate(side = if_else(`coeff >= 0` == 'TRUE', 'positive', 'negative')) %>%
ungroup() %>%
select(genus, item, perc, side) %>%
spread('side', 'perc') %>%
mutate(item = str_replace(item, 'b_','')) %>%
left_join(key %>% select(item = fg1_name, shortname), by = "item") %>%
mutate(color = if_else(positive >= 0.75, 'maroon', if_else(negative >= 0.75, 'steelblue', 'white'))) %>%
mutate(mark = if_else(negative >= 0.99 | positive >= 0.99, '***', if_else(negative >= 0.975 | positive >= 0.975, '**', if_else(negative >= 0.95 | positive >= 0.95, '*', '')))) %>%
mutate(genus = factor(genus, levels = c('Enterococcus','Klebsiella','Cronobacter','Enterobacter','Citrobacter','Cedecea','Escherichia'))) %>%
mutate(shortname = factor(shortname, levels = fg_order))
col_key <- perc_side %>%
ungroup() %>%
distinct(color) %>%
pull(color)
names(col_key) <- col_key
genus_fg_extra <- ggplot(perc_side, aes(x = genus, y = shortname)) +
geom_tile(aes(fill = color,  x = genus, y =  shortname), alpha = 0.5, color='gray0', width=1, height=1) +
geom_text(aes(label = mark, x = genus,y =  shortname),
nudge_y = -0.05, nudge_x = 0,size = 3) +
scale_fill_manual(values = col_key, labels = c('Less than 75% CI crosses 0', '75% CI < 0 negative','75% CI > 0 positive')) +
theme_void() +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_text(angle=90, hjust=1, size=axis_text_size),
axis.text.y=element_text(size=axis_text_size, hjust=0.95,vjust=0.2),
axis.title=element_text(size=axis_title_size),
legend.position = 'none',legend.text=element_text(size=8),
legend.key = element_rect( colour = "gray50"))
genus_fg_extra %>% write_rds('../data/120_F2E_extra_genera.rds')
ggsave('../data/120_F2E_extra_genera.pdf', width =  60,plot = genus_fg_extra,
height = 70,
units = c("mm"),
dpi = 400)
f2c <- read_rds('../data/068_div_post_ridge.rds')
ggsave('../data/086_f2c.pdf', width = 3,height = 3, plot = f2c)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(brms)
library(ggpubr)
library(tidybayes)
library(cowplot)
dtb <- read_csv('../data/152_combined_DTB.csv')
theme_set(theme_tidybayes() + panel_border())
ncores <- parallel::detectCores()
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
axis_text_size <- 10
axis_title_size <- 10
# the mean food group intake from our data
meta <- read_csv('../data/153_combined_META.csv') %>%
mutate(timebin = cut_width(sdrt, 7, boundary=0, closed = 'left')) %>%
mutate(intensity = factor(intensity, levels = c('nonablative','reduced','ablative'))) %>%
mutate(mrn = factor(mrn)) %>%
mutate(fg_egg = fg_egg/100,
fg_fruit = fg_fruit/100,
fg_grain = fg_grain/100,
fg_legume = fg_legume/100,
fg_meat = fg_meat/100,
fg_milk = fg_milk/100,
fg_oils = fg_oils/100,
fg_sweets = fg_sweets/100,
fg_veggie = fg_veggie/100) %>%
mutate(inten_non = if_else(intensity == 'nonablative', 1, 0),
inten_ab = if_else(intensity == 'ablative', 1, 0),
inten_re = if_else(intensity == 'reduced', 1, 0))
max_fg <- meta %>%
select(starts_with('fg')) %>%
summarise_all(funs(max))
View(meta)
# randomly sample 100 diets
set.seed(123)
reals <- meta %>%
select(starts_with('fg')) %>%
slice_sample(n = 100)
View(reals)
reals %>% write_csv('../data/101_100_random_diets.csv')
View(reals)
# take a deep breath you can do it trust yourself cuz you are strong and you are brave
one <- reals %>% slice(1)
View(one)
View(reals)
# randomly sample 100 diets
set.seed(123)
test <- post_samples %>%
select(starts_with('b_fg'), b_intensityreduced, sigma) %>%
slice_sample(n = 100)
# when the intake is max
post_samples  <- read_csv('../data/068_div_model_fg_post.csv')
test <- post_samples %>%
select(starts_with('b_fg'), b_intensityreduced, sigma) %>%
slice_sample(n = 100)
test_coeffb <- test %>% select(-sigma)
View(test_coeffb)
View(one)
one
colnames(one)
paste(colnames(one), collapse = '',)
paste(colnames(one), collapse = ',')
colnames(one)
test_coeffb
test_coeffb
test_coeffb
paste(colnames(one), collapse = '_,')
cal_real_all <- function(b_fg_fruit_,b_fg_meat_,b_fg_milk_,b_fg_oils_,b_fg_egg_,b_fg_grain_,b_fg_sweets_,b_fg_legume_,b_fg_veggie_,b_intensityreduced_ , fg_egg_,fg_fruit_,fg_grain_,fg_legume_,fg_meat_,fg_milk_,fg_oils_,fg_sweets_,fg_veggie_){
res =
b_fg_egg_ * fg_egg_+
b_fg_fruit_ * fg_fruit_+
b_fg_grain_ * fg_grain_ +
b_fg_legume_ * fg_legume_+
b_fg_meat_ * fg_meat_ +
b_fg_milk_ * fg_milk_ +
b_fg_oils_ * fg_oils_ +
b_fg_sweets_ * fg_sweets_ +
b_fg_veggie_ * fg_veggie_ +
b_intensityreduced_
}
paste(colnames(test_fg), collapse = ',')
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
cal_real_all <- function(b_fg_fruit_,b_fg_meat_,b_fg_milk_,b_fg_oils_,b_fg_egg_,b_fg_grain_,b_fg_sweets_,b_fg_legume_,b_fg_veggie_,b_intensityreduced_ , fg_egg_,fg_fruit_,fg_grain_,fg_legume_,fg_meat_,fg_milk_,fg_oils_,fg_sweets_,fg_veggie_){
res =
b_fg_egg_ * fg_egg_+
b_fg_fruit_ * fg_fruit_+
b_fg_grain_ * fg_grain_ +
b_fg_legume_ * fg_legume_+
b_fg_meat_ * fg_meat_ +
b_fg_milk_ * fg_milk_ +
b_fg_oils_ * fg_oils_ +
b_fg_sweets_ * fg_sweets_ +
b_fg_veggie_ * fg_veggie_ +
b_intensityreduced_
}
res <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)
})
res <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)
return(ret)
})
View(res)
View(res[[1]])
res[[1]]
res <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})
View(res)
View(res[[1]])
all_realdiet <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})
View(meta)
View(max_fg)
# the fg value depends on the input it could be real value it could be the max of one fg
cal_real_all <- function(b_fg_fruit_,b_fg_meat_,b_fg_milk_,b_fg_oils_,b_fg_egg_,b_fg_grain_,b_fg_sweets_,b_fg_legume_,b_fg_veggie_,b_intensityreduced_ , fg_egg_,fg_fruit_,fg_grain_,fg_legume_,fg_meat_,fg_milk_,fg_oils_,fg_sweets_,fg_veggie_){
res =
b_fg_egg_ * fg_egg_+
b_fg_fruit_ * fg_fruit_+
b_fg_grain_ * fg_grain_ +
b_fg_legume_ * fg_legume_+
b_fg_meat_ * fg_meat_ +
b_fg_milk_ * fg_milk_ +
b_fg_oils_ * fg_oils_ +
b_fg_sweets_ * fg_sweets_ +
b_fg_veggie_ * fg_veggie_ +
b_intensityreduced_
}
all_realdiet_sweetsmax <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=max_fg$fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','max_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, max_real_diet) %>%
pmap(function(sigma, max_real_diet){
rnorm(500, mean = max_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_max_real = exp(value))
return(ret)
})
# take a deep breath you can do it trust yourself cuz you are strong and you are brave
one <- reals %>% slice(1)
colnames(one)
all_realdiet <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})
# the fg value depends on the input it could be real value it could be the max of one fg
cal_real_all <- function(b_fg_fruit_,b_fg_meat_,b_fg_milk_,b_fg_oils_,b_fg_egg_,b_fg_grain_,b_fg_sweets_,b_fg_legume_,b_fg_veggie_,b_intensityreduced_ , fg_egg_,fg_fruit_,fg_grain_,fg_legume_,fg_meat_,fg_milk_,fg_oils_,fg_sweets_,fg_veggie_){
res =
b_fg_egg_ * fg_egg_+
b_fg_fruit_ * fg_fruit_+
b_fg_grain_ * fg_grain_ +
b_fg_legume_ * fg_legume_+
b_fg_meat_ * fg_meat_ +
b_fg_milk_ * fg_milk_ +
b_fg_oils_ * fg_oils_ +
b_fg_sweets_ * fg_sweets_ +
b_fg_veggie_ * fg_veggie_ +
b_intensityreduced_
}
# take a deep breath you can do it trust yourself cuz you are strong and you are brave
one <- reals %>% slice(1)
colnames(one)
all_realdiet <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})
all_realdiet_sweetsmax <- one %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=max_fg$fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','max_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, max_real_diet) %>%
pmap(function(sigma, max_real_diet){
rnorm(500, mean = max_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_max_real = exp(value))
return(ret)
})
# take a deep breath you can do it trust yourself cuz you are strong and you are brave
one <- reals %>% slice(1)
colnames(one)
all_realdiet <- reals %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})
all_realdiet_sweetsmax <- reals %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=max_fg$fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','max_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, max_real_diet) %>%
pmap(function(sigma, max_real_diet){
rnorm(500, mean = max_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_max_real = exp(value))
return(ret)
})
View(all_realdiet)
View(all_realdiet_sweetsmax)
View(all_realdiet_sweetsmax[[1]])
View(all_realdiet[[1]])
View(all_realdiet_sweetsmax)
# combine them together and do the subtraction
allrealdf <- all_realdiet %>% bind_rows()
View(allrealdf)
View(all_realdiet)
100*50000
View(allrealdf)
all_realdiet_sweetsmax <- reals %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=max_fg$fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','max_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, max_real_diet) %>%
pmap(function(sigma, max_real_diet){
rnorm(500, mean = max_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_max_real = exp(value))
return(ret)
})%>% bind_rows()
all_realdiet <- reals %>%
pmap(function(fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
test_fg = test_coeffb %>%
mutate(fg_egg=fg_egg,fg_fruit=fg_fruit,fg_grain=fg_grain,fg_legume=fg_legume,fg_meat=fg_meat,fg_milk=fg_milk,fg_oils=fg_oils,fg_sweets=fg_sweets,fg_veggie=fg_veggie)
ret = pmap(test_fg, function(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie){
cal_real_all(b_fg_fruit,b_fg_meat,b_fg_milk,b_fg_oils,b_fg_egg,b_fg_grain,b_fg_sweets,b_fg_legume,b_fg_veggie,b_intensityreduced, fg_egg,fg_fruit,fg_grain,fg_legume,fg_meat,fg_milk,fg_oils,fg_sweets,fg_veggie)
})%>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'ID') %>%
gather('key','all_real_diet')%>%
mutate(sigma = test$sigma)      %>%
select(sigma, all_real_diet) %>%
pmap(function(sigma, all_real_diet){
rnorm(500, mean = all_real_diet, sd = sigma)
}) %>% set_names(seq(1, 100)) %>%
bind_rows(.id = 'id') %>%
gather() %>% mutate(div_all_real = exp(value))
return(ret)
})%>% bind_rows()
View(all_realdiet_sweetsmax)
all_realdiet_sweetsmax
# combine them together and do the subtraction
diff <- bind_cols(
all_realdiet_sweetsmax = all_realdiet_sweetsmax$div_max_real,
all_realdiet = all_realdiet$div_all_real
)
View(diff)
diff
# combine them together and do the subtraction
diff <- bind_cols(
all_realdiet_sweetsmax = all_realdiet_sweetsmax$div_max_real,
all_realdiet = all_realdiet$div_all_real
) %>%
mutate(difference = all_realdiet_sweetsmax - all_realdiet)
diff
# combine them together and do the subtraction
diff <- bind_cols(
all_realdiet_sweetsmax = all_realdiet_sweetsmax$div_max_real,
all_realdiet = all_realdiet$div_all_real
) %>%
mutate(difference = all_realdiet_sweetsmax - all_realdiet,
key = 'sweetmax - realdiet')
diff %>%
ggplot(aes(y = key, x = difference, color = '#A73030FF' )) +
stat_pointinterval(.width = c(.66, .95)) +
geom_vline(xintercept = 0, linetype = "dashed", col = 'black') +
labs(x = '',
y = '',
title = 'Diversity prediction') +
theme_classic() +
theme(axis.text=element_text(size=8),
legend.position = 'none',
#axis.text.y = element_blank(),
axis.title=element_text(size=8),
aspect.ratio=1)
ggsave('../data/101_realdiet100.pdf' )
