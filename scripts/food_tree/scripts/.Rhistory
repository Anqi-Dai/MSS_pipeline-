units = c("mm"),
dpi = 400, device = 'pdf')
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tblr')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 170,
height = 60,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 160,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 50,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'h',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'l)
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'l')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'b')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 't')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'v',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 't')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tb')
pca
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 150,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 50,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/S8_narcotics_PCA_084_Jan24.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
meta <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', ''))
meta
View(meta)
meta
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1)
View(cts)
View(meta)
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1) %>%
filter(str_detect(clade_name, 's__')) %>%
rename_all(~ gsub("_metaphlan3_profile", "", .)) %>%
select(-NCBI_tax_id)
View(cts)
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
cts_all <- cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
spread(key = 'clade_name', value = 'perc', fill = 0) %>%
column_to_rownames('sampleid')
meta <- diversity(cts_all, index = 'inv')
library(vegan)
library(ggpubr)
library(ggpubr)
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
meta <- diversity(cts_all, index = 'inv')
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv')
View(meta)
pheno <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', ''))
pheno
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv')
View(meta)
View(pheno)
pheno <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', '')) %>%
mutate(sampleid = str_replace(sampleid, '_humann3',''))
pheno
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)
View(meta)
meta
meta %>%
filter(day == 'D7')
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'jitter') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'jitter') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot',
ylab = 'Simpson reciprocal diversity', xlab = '') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
ggsave('../data/05_d7_alpha.pdf', width = 6)
ggsave('../data/05_d7_alpha.pdf', height = 6)
ggsave('../data/05_d7_alpha.pdf', height = 4)
ggsave('../data/05_d7_alpha.pdf', height = 4, width = 5)
View(meta)
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)   %>%
rename(simpson_reciprocal = inv)
?write_excel_csv
meta %>% write_excel_csv2('../data/05_meta_with_alpha.csv')
install.packages("xlsx")
library("xlsx")
library("xlsx")
library(xlsx)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vegan)
library(ggpubr)
library(xlsx)
install.packages("xlsx")
library(xlsx)
install.packages('openxlsx')
library(openxlsx)
library(tidyverse)
library(vegan)
library(ggpubr)
library(openxlsx)
pheno <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', '')) %>%
mutate(sampleid = str_replace(sampleid, '_humann3',''))
pheno
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1) %>%
filter(str_detect(clade_name, 's__')) %>%
rename_all(~ gsub("_metaphlan3_profile", "", .)) %>%
select(-NCBI_tax_id)
cts_all <- cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
spread(key = 'clade_name', value = 'perc', fill = 0) %>%
column_to_rownames('sampleid')
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)   %>%
rename(simpson_reciprocal = inv)
write.xlsx(meta, '../data/05_meta_with_alpha.csv')
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot',
ylab = 'Simpson reciprocal diversity', xlab = '',
title = 'D7') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1) %>%
filter(str_detect(clade_name, 's__')) %>%
rename_all(~ gsub("_metaphlan3_profile", "", .)) %>%
select(-NCBI_tax_id)
cts_all <- cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
spread(key = 'clade_name', value = 'perc', fill = 0) %>%
column_to_rownames('sampleid')
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)   %>%
rename(simpson_reciprocal = inv)
write.xlsx(meta, '../data/05_meta_with_alpha.csv')
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'simpson_reciprocal', add = 'dotplot',
ylab = 'Simpson reciprocal diversity', xlab = '',
title = 'D7') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
ggsave('../data/05_d7_alpha.pdf', height = 4, width = 5)
write.xlsx(meta, '../data/05_meta_with_alpha.xlsx')
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv')
View(tb)
tb
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1])
tb
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442'))
View(tb)
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1])
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1])
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1])
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442'))
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442'))
tb
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442'))
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])
tb
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3',''))
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(meta)
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(meta) %>%
filter(day == 'D7')
tb
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(pheno) %>%
filter(day == 'D7')
tb
View(tb)
tb
tb
tb %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO')
tb %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',)
tb %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',) +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442'))
tb %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',) +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=T)
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(pheno) %>%
filter(day == 'D7')
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(pheno) %>%
filter(day == 'D7')
tb %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',) +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=T)
tb
tb %>%
filter(str_detect(KO, 'Lactobacillus_johnsonii')) %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',) +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=T)
tb %>%
filter(str_detect(KO, 'Lactobacillus_johnsonii')) %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',
xlab = '', ylab = 'Counts per million') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=T)
ggsave('../data/05_K01442_Lactobacillus_johnsonii.pdf', height = 4, width = 5)
write.xlsx(tb, '../data/05_K01442_spp_data.xlsx')
tb <- read_tsv('../data/humann3_KO_cpm_joined_stratified.tsv') %>%
rename(KO = names(.)[1]) %>%
filter(str_detect(KO, 'K01442')) %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])  %>%
mutate(sampleid = str_replace(sampleid, '_humann3','')) %>%
left_join(pheno) %>%
filter(day == 'D7')
tb %>%
#filter(str_detect(KO, 'Lactobacillus_johnsonii')) %>%
ggboxplot(x = 'grp', y = 'cpm', facet.by = 'KO',add = 'dotplot',
xlab = '', ylab = 'Counts per million') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=T)
ggsave('../data/05_K01442_Lactobacillus_johnsonii.pdf', height = 4, width = 5)
write.xlsx(tb, '../data/05_K01442_spp_data.xlsx')
View(tb)
