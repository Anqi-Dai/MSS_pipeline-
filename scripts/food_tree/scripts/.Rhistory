)
plot <- ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = c(.5,6),
axis.text.y = element_text(size=10),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
cola_sugar
bars
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugar content', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugar content','Total'))) %>%
# there is something about the sugar in ginger ale and I need to do something
mutate(gram = if_else(description == 'Soft drink, ginger ale' & grp == 'Sugar content', 2.1185367*cola_sugar, gram))
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- ggbarplot(bars, "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = c(.5,6),
axis.text.y = element_text(size=10),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
bars
?str_wrap
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugar content', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugar content','Total'))) %>%
# there is something about the sugar in ginger ale and I need to do something
mutate(gram = if_else(description == 'Soft drink, ginger ale' & grp == 'Sugar content', 2.1185367*cola_sugar, gram)) %>%
mutate(description = str_wrap(description, indent = 4, width = 30))
bars
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugar content', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugar content','Total'))) %>%
# there is something about the sugar in ginger ale and I need to do something
mutate(gram = if_else(description == 'Soft drink, ginger ale' & grp == 'Sugar content', 2.1185367*cola_sugar, gram)) %>%
mutate(description = str_wrap(description, indent = 4, width = 30))
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- ggbarplot(bars, "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = c(.5,6),
axis.text.y = element_text(size=10),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
View(key)
# how to sort the bars
bars %>%
filter(grp == 'Total')
# how to sort the bars
order_ <= bars %>%
filter(grp == 'Total') %>%
arrange(gram) %>%
pull(description)
# how to sort the bars
order_ <- bars %>%
filter(grp == 'Total') %>%
arrange(gram) %>%
pull(description)
# how to sort the bars
order_ <- bars %>%
filter(grp == 'Total') %>%
arrange(gram) %>%
pull(description)
order_
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = c(.5,6),
axis.text.y = element_text(size=10),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
#legend.position = c(.5,6),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#db2589" ,"#ffbcdc"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
#legend.position = c(.5,6),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
#legend.position = c(.5,6),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
legend.position = c(.5,2),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
legend.position = c(.5,5),
legend.title= element_blank())
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
legend.position = c(.5,5),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
legend.position = c(1,5),
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
# the percentage of sugar in cola
cola_sugar <- 0.7714132/0.8257381
library(cowplot)
title <- ggdraw() +
draw_label(
"Fig S8",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
plot <- bars %>%
mutate(description = factor(description, levels = order_)) %>%
ggbarplot( "description", "gram",
xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c( "#ffbcdc", "#db2589"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(
axis.text.y = element_text(size=10),
legend.position = 'bottom',
legend.title= element_blank())
combined <- plot_grid(
title, plot,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)+theme(plot.margin = unit(c(1,3,6,1), "cm"))
ggsave('../data/S8_top10_eaten_foods_of_sweets_099.pdf',  width = 210, height = 297, units = "mm", device = 'pdf', plot = combined, dpi = 300)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
meta <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', ''))
meta
full <- read_tsv('../data/humann3_pathabundance_cpm_unstratified.tsv')  %>%
rename(pathway = names(.)[1])
day_pheno <- meta %>%
split(., list(.$day))
day_pheno %>%
imap(function(.x, .y){
select(.data = .x, grp) %>%
t() %>%
write.table(str_glue('../data/lefse/{.y}.txt'), sep = '\t', quote = F, row.names = T, col.names = F)
})
day_pheno_pcts <- day_pheno %>%
map(~ pull(.data = ., sampleid) ) %>%
imap(~ full %>% select(pathway, matches(.x)) %>%
write_tsv(str_glue('../data/lefse/{.y}_pcts.tsv')))
fns <- list.files('../data/lefse/', pattern = 'lefse_ready_pcts.tsv$')
cmds <- tibble(
fns = fns
) %>%
mutate(format_cmd = str_glue('format_input.py {fns}  {fns}.in -c 1 -u 2')) %>%
mutate(run_cmd = str_glue('run_lefse.py {fns}.in  {fns}.res')) %>%
mutate(plot_cmd = str_glue('plot_res.py {fns}.res {fns}.pdf --format pdf  --feature_font_size 4 --width 10 --dpi 300 --title {fns}')) %>%
select(-fns) %>%
gather() %>%
select(value) %>%
write_csv('../data/lefse/lefse_run_cmd.sh', col_names = F)
View(meta)
knitr::opts_chunk$set(echo = TRUE)
serpath <- '/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/'
res <- read_csv(file = file.path(serpath, '08_shotgun_KO.csv'))
View(res)
knitr::opts_chunk$set(echo = TRUE)
ba <- read_excel('../data/KO_BAs.xlsx') %>%
mutate(ECnum = str_replace(EC, 'EC:',''))
library(tidyverse)
library(readxl)
library(ggpubr)
ba <- read_excel('../data/KO_BAs.xlsx') %>%
mutate(ECnum = str_replace(EC, 'EC:',''))
pheno <- read_csv('/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/all_BAs_conc.csv')
list.files('/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/')
oriana_all <- read_csv('/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/all_BAs_conc.csv') %>%
select(sampleid) %>%
mutate(fid = if_else(str_detect(sampleid, '^FMT'), str_replace(sampleid, '\\.', '_'), sampleid))
View(oriana_all)
oba <- tibble(
fn = list.files('../data/KO/', full.names = T)
) %>%
mutate(fid = str_replace(fn, '../data/KO//', ''),
fid = str_replace(fid, '_humann3_KO_cpm.tsv', '')) %>%
filter(fid %in% oriana_all$fid)
onset <- read_csv('/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/cohort_BAs_later.csv')
View(oba)
# make a meta table for my own sanity
meta <- oba %>%
inner_join(oriana_all) %>%
inner_join(pheno %>%
select(BatchID, DiseaseGroup, sampleid, mrn)) %>%
mutate(in_onset = if_else(sampleid %in% onset$sampleid, T, F),
in_peri = if_else(sampleid %in% perien$sampleid, T, F),
urso_expo = if_else(sampleid %in% include$sampleid, T, F)) %>%
select(-fn)
ofn <- oba %>%
pull(fn)
oriana_all <- read_csv('/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/all_BAs_conc.csv') %>%
select(sampleid) %>%
mutate(fid = if_else(str_detect(sampleid, '^FMT'), str_replace(sampleid, '\\.', '_'), sampleid))
View(oriana_all)
res <- ofn %>%
set_names(ofn) %>%
map(~ read_tsv(.) %>%
#filter(!str_detect(`# Gene Family`, '\\|')) %>%
rename(KOID = `# Gene Family`,
cpm = names(.)[2]) ) %>%
bind_rows(.id = 'fn')
View(res)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(tidybayes)
library(cowplot)
theme_set(theme_pubr(base_size = 8))
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
res <- read_csv('../data/172_spearman_all.csv')
View(res)
library(tidyverse)
library(ggpubr)
library(tidybayes)
library(cowplot)
theme_set(theme_pubr(base_size = 8))
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
corre <- res %>%
ggbarplot(x = 'genus', y = 'rho',
#sort.val = "asc",
fill = "grp",
color = "white",
palette = "jco",
sort.by.groups = FALSE,
x.text.angle = 45,
ylab = "",
xlab = FALSE) +
theme(axis.text = element_text(size = 10))
corre
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(tidybayes)
library(cowplot)
theme_set(theme_pubr(base_size = 8))
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
res <- read_csv('../data/172_spearman_all.csv')
