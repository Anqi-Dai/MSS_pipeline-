select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_macro_prior <- prior_draws(model_alpha_macro) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_ave_fat * mean_macro$ave_fat+
b_ave_Protein * mean_macro$ave_Protein+
b_ave_Sugars * mean_macro$ave_Sugars+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# the posterior
model_alpha_macro
colnames(full)
View(mean_ave_macro_prior)
alpha_macro <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
ave_fat +
ave_Protein +
ave_Sugars +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_macro <- c(
# for the macro nutrients
prior(normal(0, 0.5), class = 'b', coef = "ave_fiber"),
prior(normal(0, 0.5), class = 'b', coef = "ave_fat"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Protein"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Sugars"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.1), class = 'Intercept'))
# vet the prior
model_alpha_macro  <- brm( alpha_macro,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_macro,
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_macro_prior <- prior_draws(model_alpha_macro) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_ave_fat * mean_macro$ave_fat+
b_ave_Protein * mean_macro$ave_Protein+
b_ave_Sugars * mean_macro$ave_Sugars+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# the posterior
model_alpha_macro
colnames(full)
alpha_macro <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
ave_fat +
ave_Protein +
ave_Sugars +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_macro <- c(
# for the macro nutrients
prior(normal(0, 0.5), class = 'b', coef = "ave_fiber"),
prior(normal(0, 0.5), class = 'b', coef = "ave_fat"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Protein"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Sugars"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.1), class = 'Intercept'))
# vet the prior
model_alpha_macro  <- brm( alpha_macro,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_macro,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_macro_prior <- prior_draws(model_alpha_macro) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_ave_fat * mean_macro$ave_fat+
b_ave_Protein * mean_macro$ave_Protein+
b_ave_Sugars * mean_macro$ave_Sugars+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# the posterior
model_alpha_macro
colnames(full)
# plot the above model post coeff
post_coeff <- posterior_samples(model_alpha_macro, '^b_') %>%
select(starts_with('b_ave')) %>%
gather('item', 'coeff') %>%
mutate(item = str_replace(item, 'b_ave_','')) %>%
mutate(item = case_when(
item ==  'fiber' ~ 'Fibers',
item == 'fat' ~ 'Fat',
TRUE ~ item
))  %>%
mutate(item = fct_reorder(item, coeff, .fun=median, .desc = F))
post_coeff %>%
ggplot(aes(x = coeff, y = item)) +
stat_pointinterval(.width = c(.66, .95)) +
geom_vline(xintercept = 0, col = 'red', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Macronutrients') +
theme_classic() +
theme(legend.position = 'none') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../figs/paper/078_macronutrients_alpha_model_coeff_forest.eps',
width = 80,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
# the binary vars
coeff_bi <- posterior_samples(model_alpha_macro, '^b_')  %>%
select(!starts_with('b_ave')) %>%
select(-b_Intercept) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure'
)) %>%
mutate(item = factor(item, levels = c('b_empiF','b_empiT','b_inten_non','b_inten_re','b_inten_ab','b_enF','b_enT','b_tpnF','b_tpnT'))) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'red', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Factor variables') +
theme_classic() +
theme(legend.position = 'none',
aspect.ratio=1)
ggsave('../figs/paper/078_macronutrients_alpha_model_coeff_forest_binary.eps',
width = 80,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
alpha_fiber <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_fiber <- c(
# for the macro nutrients
prior(normal(0, 0.5), class = 'b', coef = "ave_fiber"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.1), class = 'Intercept'))
# vet the prior
model_alpha_fiber  <- brm( alpha_fiber,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_fiber,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_fiber_prior <- prior_draws(model_alpha_fiber) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
View(mean_ave_fiber_prior)
alpha_fiber <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_fiber <- c(
# for the macro nutrients
prior(normal(0, 1), class = 'b', coef = "ave_fiber"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.1), class = 'Intercept'))
# vet the prior
model_alpha_fiber  <- brm( alpha_fiber,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_fiber,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_fiber_prior <- prior_draws(model_alpha_fiber) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
alpha_fiber <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_fiber <- c(
# for the macro nutrients
prior(normal(0, 1), class = 'b', coef = "ave_fiber"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.5), class = 'Intercept'))
# vet the prior
model_alpha_fiber  <- brm( alpha_fiber,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_fiber,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_fiber_prior <- prior_draws(model_alpha_fiber) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# plot the above model post coeff
post_coeff <- posterior_samples(model_alpha_fiber, '^b_') %>%
select(starts_with('b_ave')) %>%
gather('item', 'coeff') %>%
mutate(item = str_replace(item, 'b_ave_','')) %>%
mutate(item = case_when(
item ==  'fiber' ~ 'Fibers',
TRUE ~ item
))  %>%
mutate(item = fct_reorder(item, coeff, .fun=median, .desc = F))
post_coeff %>%
ggplot(aes(x = coeff, y = item)) +
stat_pointinterval(.width = c(.66, .95)) +
geom_vline(xintercept = 0, col = 'red', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Macronutrients') +
theme_classic() +
theme(legend.position = 'none') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../figs/paper/078_fiber_alpha_model_coeff_forest.eps',
width = 80,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
alpha_macro <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
ave_fat +
ave_Protein +
ave_Sugars +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_macro <- c(
# for the macro nutrients
prior(normal(0, 0.5), class = 'b', coef = "ave_fiber"),
prior(normal(0, 0.5), class = 'b', coef = "ave_fat"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Protein"),
prior(normal(0, 0.5), class = 'b', coef = "ave_Sugars"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.5), class = 'Intercept'))
# vet the prior
model_alpha_macro  <- brm( alpha_macro,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_macro,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_macro_prior <- prior_draws(model_alpha_macro) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_ave_fat * mean_macro$ave_fat+
b_ave_Protein * mean_macro$ave_Protein+
b_ave_Sugars * mean_macro$ave_Sugars+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# the posterior
model_alpha_macro
colnames(full)
View(mean_ave_macro_prior)
alpha_macro <- log(simpson_reciprocal) ~ 1 +
ave_fiber +
ave_fat +
ave_Protein +
ave_Sugars +
inten_non + inten_ab + inten_re +
EN +
TPN +
empirical +
(1 | mrn) +
(1 | timebin)
priors_alpha_macro <- c(
# for the macro nutrients
prior(normal(0, 0.4), class = 'b', coef = "ave_fiber"),
prior(normal(0, 0.4), class = 'b', coef = "ave_fat"),
prior(normal(0, 0.4), class = 'b', coef = "ave_Protein"),
prior(normal(0, 0.4), class = 'b', coef = "ave_Sugars"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPNTRUE"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "ENTRUE"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "empiricalTRUE"),
# for the intensity
prior(normal(0, 0.1), class = 'b', coef = "inten_re"),
prior(normal(0, 0.1), class = 'b', coef = "inten_ab"),
prior(normal(0, 0.1), class = 'b', coef = "inten_non"),
# for the intercept
prior(normal(2, 0.5), class = 'Intercept'))
# vet the prior
model_alpha_macro  <- brm( alpha_macro,
data = full,
warmup = 1000, iter = 3000,
prior = priors_alpha_macro,
control = list(adapt_delta = 0.99),
cores = ncores,
chains = 2,
seed = 123, sample_prior = T)
mean_macro <-  full %>%
select(starts_with('ave_')) %>%
summarise_all(funs(mean))
mean_ave_macro_prior <- prior_draws(model_alpha_macro) %>%
mutate(mean_div = Intercept +
b_ave_fiber * mean_macro$ave_fiber+
b_ave_fat * mean_macro$ave_fat+
b_ave_Protein * mean_macro$ave_Protein+
b_ave_Sugars * mean_macro$ave_Sugars+
b_inten_re ) %>%
select(mean_div) %>%
mutate(grp = 'mean_macro') %>%
rename(prior_res = mean_div) %>%
select(grp, prior_res)
# the posterior
model_alpha_macro
colnames(full)
# plot the above model post coeff
post_coeff <- posterior_samples(model_alpha_macro, '^b_') %>%
select(starts_with('b_ave')) %>%
gather('item', 'coeff') %>%
mutate(item = str_replace(item, 'b_ave_','')) %>%
mutate(item = case_when(
item ==  'fiber' ~ 'Fibers',
item == 'fat' ~ 'Fat',
TRUE ~ item
))  %>%
mutate(item = fct_reorder(item, coeff, .fun=median, .desc = F))
post_coeff %>%
ggplot(aes(x = coeff, y = item)) +
stat_pointinterval(.width = c(.66, .95)) +
geom_vline(xintercept = 0, col = 'red', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Macronutrients') +
theme_classic() +
theme(legend.position = 'none') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../figs/paper/078_macronutrients_alpha_model_coeff_forest.eps',
width = 80,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
# the binary vars
coeff_bi <- posterior_samples(model_alpha_macro, '^b_')  %>%
select(!starts_with('b_ave')) %>%
select(-b_Intercept) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure'
)) %>%
mutate(item = factor(item, levels = c('b_empiF','b_empiT','b_inten_non','b_inten_re','b_inten_ab','b_enF','b_enT','b_tpnF','b_tpnT'))) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'red', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Factor variables') +
theme_classic() +
theme(legend.position = 'none',
aspect.ratio=1)
ggsave('../figs/paper/078_macronutrients_alpha_model_coeff_forest_binary.eps',
width = 80,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
