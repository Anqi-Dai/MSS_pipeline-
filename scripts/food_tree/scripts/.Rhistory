their <- read_csv('../data/their_results_kraken.csv', na = 'missing')
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv', na = 'NA')
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv') %>%
gather
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv') %>%
gather('column','value', names(.)[2]:names(.)[ncol(.)])
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv') %>%
gather('column','value', names(.)[2]:names(.)[ncol(.)])
their <- read_csv('../data/their_results_kraken.csv')
their <- read_csv('../data/their_results_kraken.csv', col_select = c('taxa', str_detect(., 'Kraken')))
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv', col_select = c('taxa', str_detect(names(.), 'Kraken')))
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv')  %>%
select( str_detect(colnames(.), 'Kraken'))
their <- read_csv('../data/their_results_kraken.csv')
colnames(their)
their <- read_csv('../data/their_results_kraken.csv')
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv')  %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)])
their
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv')  %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
mutate(perc = if_else(is.na(perc), 0, perc))
archaea_k
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, 'Sample'))
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample'))
View(m15_k)
m15_k
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(str_replace(sampleid, '_.+$',''))
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''))
their_k <- their %>%
filter(Kraken == '% Archaea')
their
their_k <- their %>%
filter(KRAKEN == '% Archaea')
View(their_k)
their_k
their %>%
filter(KRAKEN == '% Archaea')
their %>%
filter(KRAKEN == '% Archaea')
their_k <- their %>%
filter(KRAKEN == '% Archaea') %>%
rename(their = perc)
both_k <- m15_k %>%
left_join(their_K)
both_k <- m15_k %>%
left_join(their_k)
View(both_k)
their_k
both_k <- m15_k %>%
full_join(their_k)
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
both_k <- m15_k %>%
full_join(their_k)
their_k
their_k
their_k <- their %>%
filter(KRAKEN == '% Archaea') %>%
rename(their = perc) %>%
mutate(sampleid = case_when(
sampleid == '60I' ~ 'FMT0060I',
sampleid == '64B' ~ 'FMT0064B',
sampleid == '132D' ~ 'FMT0132D',
sampleid == '187E' ~ 'FMT0187E',
sampleid == '221G' ~ 'FMT0221G',
sampleid == '1909' ~ '1909L',
TRUE ~ sampleid
))
both_k <- m15_k %>%
full_join(their_k)
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their))
m15_k %>%
full_join(their_k %>%
select(sampleid, their))
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their))
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their))
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their)) %>%
mutate(their = if_else(is.na(their), 0, their))
library(ggpubr)
both_k
both_k %>%
ggscatter(x = 'perc', y = 'their')
both_k %>%
ggscatter(x = 'perc', y = 'their',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n"))
both_k %>%
ggscatter(x = 'perc', y = 'their',
xlab = 'Our Kraken2 run results', ylab = 'Their Kraken2 run results',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n"))
both_k %>%
ggscatter(x = 'perc', y = 'their',
xlab = 'Our Kraken2 run results', ylab = 'Their Kraken2 run results',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n"))
both_k %>%
ggscatter(x = 'perc', y = 'their',
xlab = 'Our Kraken2 Archaea percentage', ylab = 'Their Kraken2 Archaea percentage',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n"))
View(archaea_k)
archaea_k
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others'))
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggboxplot(y = 'perc')
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggboxplot(y = 'perc') +
scale_y_log10()
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggboxplot(y = 'perc') +
scale_y_sqrt()
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc') +
scale_y_sqrt()
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot') +
scale_y_sqrt()
View(their)
View(kraken)
View(archaea_perc)
View(archaea)
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea'))
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample'))
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea'))
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample'))
m15_s
# to look at the archaea at species level
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__'))
View(m15_s)
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') &
!str_detect(taxa, 'x__'))
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') &
!str_detect(taxa, 'X__'))
View(m15_s)
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$'))
m15_s %>% count(sampleid)
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
# to look at the archaea at species level
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
# to look at the archaea at species level
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
filter(!str_detect(spp, 'x__'))
View(their)
# the identified species (perc > 0)
their_s <- their %>%
filter(perc > 0)
View(their_s)
their_s
# the identified species (perc > 0)
their_s <- their %>%
filter(perc > 0 & str_detect(KRAKEN, '(S)'))
View(their_s)
m15_s
our_s <- m15_s %>%
filter(perc > 0)
View(our_s)
View(archaea)
View(kraken)
View(archaea)
View(our_s)
View(our_s)
View(our_s)
View(our_s)
View(archaea)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
fns <- list.files('../data/archaea/', full.names = T, pattern = 'out$')
test <- read_delim(fns[1])
kraken <- fns %>%
set_names(fns) %>%
map(~ read_delim(., col_names = F, col_types = 'cd')  %>%
select(taxa = X1, perc = X2)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(
sampleid = str_extract(sampleid, '//.+_'),
sampleid = str_replace(sampleid, '//',''),
sampleid = str_replace(sampleid, '_*+$',''))
kraken %>%
count(sampleid)
archaea_k <- kraken %>%
filter(str_detect(taxa, 'k__Archaea$'))
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea'))
View(archaea)
fns
kraken %>%
count(sampleid)
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea'))
all <- tibble(fn = fns)
View(all)
archaea
library(vdbR)
get_table_from_database('shotgun_lookup_ad')
connect_database()
get_table_from_database('shotgun_lookup_ad')
ids <- kraken %>%
distinct(sampleid)
View(ids)
View(shotgun_lookup_ad)
ids
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_extract(sampleid, 'Sample_.+_'))
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_replace(sampleid, 'Sample_', ''))
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_replace(sampleid, 'Sample_', ''),
fid = str_replace(sampleid, '_IGO.+$', ''))
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_replace(sampleid, 'Sample_', ''),
fid = str_replace(fid, '_IGO.+$', ''))
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_replace(sampleid, 'Sample_', ''),
fid = str_replace(fid, '_IGO.+$', '')) %>%
inner_join(shotgun_lookup_ad %>% select(fid, cleaned_sampleid = sampleid))
fns <- list.files('../data/archaea/', full.names = T, pattern = 'out$')
all <- tibble(fn = fns)
test <- read_delim(fns[1])
kraken <- fns %>%
set_names(fns) %>%
map(~ read_delim(., col_names = F, col_types = 'cd')  %>%
select(taxa = X1, perc = X2)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(
sampleid = str_extract(sampleid, '//.+_'),
sampleid = str_replace(sampleid, '//',''),
sampleid = str_replace(sampleid, '_*+$',''))
ids <- kraken %>%
distinct(sampleid) %>%
mutate(fid = str_replace(sampleid, 'Sample_', ''),
fid = str_replace(fid, '_IGO.+$', '')) %>%
inner_join(shotgun_lookup_ad %>% select(fid, cleaned_sampleid = sampleid))
archaea_k <- kraken %>%
filter(str_detect(taxa, 'k__Archaea$'))
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea')) %>%
left_join(ids)
View(archaea)
archaea <- kraken %>%
filter(str_detect(taxa, 'k__Archaea')) %>%
left_join(ids) %>%
select(-fid)
archaea %>% write_csv('../data/kraken_shotgun_archaea_perc.csv')
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv')  %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
mutate(perc = if_else(is.na(perc), 0, perc))
View(their)
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
View(m15_k)
# look at the kraken results
their <- read_csv('../data/their_results_kraken.csv')  %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
mutate(perc = if_else(is.na(perc), 0, perc))
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
their_k <- their %>%
filter(KRAKEN == '% Archaea') %>%
rename(their = perc) %>%
mutate(sampleid = case_when(
sampleid == '60I' ~ 'FMT0060I',
sampleid == '64B' ~ 'FMT0064B',
sampleid == '132D' ~ 'FMT0132D',
sampleid == '187E' ~ 'FMT0187E',
sampleid == '221G' ~ 'FMT0221G',
sampleid == '1909' ~ '1909L',
TRUE ~ sampleid
))
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their)) %>%
mutate(their = if_else(is.na(their), 0, their))
both_k %>%
ggscatter(x = 'perc', y = 'their',
xlab = 'Our Kraken2 Archaea percentage', ylab = 'Their Kraken2 Archaea percentage',
title = 'Pearson correlation of the kingdom of Archaea percentage',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n"))
View(both_k)
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot') +
scale_y_sqrt()
# to look at the archaea at species level
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
filter(!str_detect(spp, 'x__'))
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
View(m15_s)
our_s <- m15_s %>%
filter(perc > 0)
View(our_s)
# to look at the archaea at species level
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
filter(!str_detect(spp, 'x__')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
# the identified species (perc > 0)
their_s <- their %>%
filter(perc > 0 & str_detect(KRAKEN, '(S)'))
View(their_s)
our_s <- m15_s %>%
filter(perc > 0)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
archaea <- read_csv('../data/kraken_shotgun_archaea_perc.csv')
View(archaea)
archaea
# the sampleid column is the "sampleid" extracted from the file name.
# the cleaned_sampleid is the actual sampleid
archaea <- read_csv('../data/kraken_shotgun_archaea_perc.csv')
archaea_k <- archaea %>%
filter(str_detect(taxa, 'k__Archaea$'))
# look at the kindom level archeae of the 15 samples
# their_results_kraken.csv is a table I manually cleaned from the excel file they shared
their <- read_csv('../data/their_results_kraken.csv')  %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
mutate(perc = if_else(is.na(perc), 0, perc))
m15_k <- archaea_k %>%
filter(!str_detect(sampleid, '^Sample')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
their_k <- their %>%
filter(KRAKEN == '% Archaea') %>%
rename(their = perc) %>%
mutate(sampleid = case_when(
sampleid == '60I' ~ 'FMT0060I',
sampleid == '64B' ~ 'FMT0064B',
sampleid == '132D' ~ 'FMT0132D',
sampleid == '187E' ~ 'FMT0187E',
sampleid == '221G' ~ 'FMT0221G',
sampleid == '1909' ~ '1909L',
TRUE ~ sampleid
))
both_k <- m15_k %>%
full_join(their_k %>%
select(sampleid, their)) %>%
mutate(their = if_else(is.na(their), 0, their))
# to compare the archaea kindom perc of the 15 samples between their and our kraken results and
# also show pearson correlation
both_k %>%
ggscatter(x = 'perc', y = 'their',
xlab = 'Our Kraken2 Archaea percentage', ylab = 'Their Kraken2 Archaea percentage',
title = 'Pearson correlation of the kingdom of Archaea percentage',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n"))
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot') +
scale_y_sqrt()
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot', xlab = '') +
scale_y_sqrt()
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot', xlab = '', ylab = 'Archaea kingdom percentage') +
scale_y_sqrt()
archaea_k %>% distinct(sampleid)
# to look at all the archaea percentage data of the 800+ samples we ran
archaea_k %>%
mutate(grp = if_else(!str_detect(sampleid, '^Sample'), 'Marina', 'others')) %>%
ggviolin(y = 'perc', add = 'boxplot', xlab = '', ylab = 'Archaea kingdom percentage',
title = '873 shotgun samples') +
scale_y_sqrt()
m15_s <- archaea %>%
filter(!str_detect(sampleid, '^Sample') & str_detect(taxa, 's__') ) %>%
mutate(spp = str_extract(taxa, 's__.+$')) %>%
filter(!str_detect(spp, 'x__')) %>%
mutate(sampleid = str_replace(sampleid, '_.+$',''),
sampleid = str_replace(sampleid, '^X',''))
View(m15_s)
our_s <- m15_s %>%
filter(perc > 0)
install.packages("kableExtra")
library(kableExtra)
our_s %>%
kbl() %>%
kable_styling()
our_s %>%
kbl(caption = 'Identified Archaea species in our kraken run') %>%
kable_styling()
their_s %>%
kbl(caption = 'Identified Archaea species in their kraken run') %>%
kable_styling()
source('create_new_postgres_user.R');
# (run this script and look down below to check who changed and who didn't  )
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
library(DBI)
source('create_new_postgres_user.R');
knitr::opts_chunk$set(echo = TRUE,
fig.width = 3,
fig.height = 3,
fig.align = 'center')
library(rethinking)
### process dataframe
encode_ordinal <- function(x, order = unique(x)) {
x <- as.numeric(factor(x, levels = order, exclude = NULL))
x
}
df$pid_encoded <- encode_ordinal(df$pid)
ggplot(df, aes(x = sum_sugar, y = iRep_zscore)) + geom_point() +
theme_classic()+
xlab('Sum of sugar (g) standardized') +
ylab('iRep zscore') +
ggtitle(paste0('Sum of sugar intake vs irep zscore \nsamples=',nrow(df))) +
theme(plot.title = element_text(size = 10, face = "bold")) +
stat_smooth(method = "lm",formula = y~x) +
stat_fit_glance(method = 'lm',
method.args = list(formula = y ~ x),
geom = 'text',
aes(label = paste("p-value=", signif(..p.value.., digits = 3),
sep = "")),
label.x = 3, label.y = 3, size = 4)
knitr::opts_chunk$set(echo = TRUE)
them <- read_csv('../data/sum of sugar intake vs max zscore family(E,E).csv')
library(tidyverse)
