distinct(sampleid) %>%
pull(sampleid)
samps <- samples_castori_ag %>%
filter(mrn %in% target) %>%
distinct(sampleid, mrn)
# get the entercoccus relab of these samples
cts <- get_counts_subset(sam)
ptb <- read_csv('../data/cleaned_patients/diet_patients_97.csv')
cts_ <- cts %>%
left_join(asv_annotation_blast_ag %>%
select(asv_key, genus)) %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(count_relative)) %>%
filter(genus == 'Enterococcus')  %>%
inner_join(qpcr %>%
select(sampleid = sample_id, copies_16s_per_g)) %>%
mutate(entero_copy = copies_16s_per_g*relab) %>%
inner_join(samples_castori_ag %>%
select(sampleid, datecollection)) %>%
inner_join(samps) %>%
inner_join(ptb %>%
select(mrn, hct)) %>%
mutate(sdrt = datecollection - hct) %>%
filter(sdrt < 54)
entero %>%
ggplot(aes(x = sdrt, y = ave_irpe )) +
geom_point() +
geom_point(data = cts_, aes(x = sdrt, y = entero_copy, col = 'red')) +
facet_wrap(~mrn)
# the patients that have both the irep and qpcr results
both <- intersect(cts_$mrn, entero$mrn)
absl <- both %>%
set_names(both) %>%
imap(function(.x, .y){
# set the min and max in the x axis to be the min and max of the global values
xmax = max(max(entero %>%
filter(mrn == .x) %>% pull(sdrt)), max(cts_ %>%
filter(mrn == .x) %>% pull(sdrt))) + 2
xmin = min(min(entero %>%
filter(mrn == .x) %>% pull(sdrt)), min(cts_ %>%
filter(mrn == .x) %>% pull(sdrt))) -2
irep = entero %>%
filter(mrn == .x) %>%
ggplot(aes(x = sdrt, y = ave_irpe )) +
geom_point() +
labs(title = str_glue('{}')) +
xlim(xmin, xmax) +
labs(x = '',
y = 'average irep values')
copies = cts_ %>%
filter(mrn == .x) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'day relative to transplant',
y = 'Enterococcus copy\nnumbers')
res = cowplot::plot_grid(irep, copies, axis = 'tblr', align = 'hv', ncol = 1)
#ggsave(str_glue('../data/{.y}.pdf'), width = 5, height = 4)
})
seq(1, length(absl)) %>%
set_names(seq(1, length(absl))) %>%
imap(~ ggsave(str_glue('../data/Patient{.y}.pdf'), width = 5, height = 4, plot = absl[[.x]]))
# customize patient 11
# use the global highest irep value for the highest in the y axis.
irep_highest <- max(entero$ave_irpe) + 0.05
irep_q25 <- quantile(x = entero$ave_irpe, 0.25)
irep_q50 <- quantile(x = entero$ave_irpe, 0.5)
irep_q75 <- quantile(x = entero$ave_irpe, 0.75)
p11 <- names(absl)[11]
xmax = 15
xmin = -5
quantile_annot_df <- tibble(
quant = c('25%','50%','75%'),
height = c(irep_q25, irep_q50, irep_q75)
)
irep = entero %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = ave_irpe )) +
geom_point() +
labs(title = str_glue('{}')) +
geom_hline(yintercept = irep_q25, linetype = 'dashed') +
#geom_text(data = quantile_annot_df, mapping = aes(x = 14, y = height, label = quant), nudge_y = 0.02, size = 2.5) +
geom_hline(yintercept = irep_q50, linetype = 'dashed') +
geom_hline(yintercept = irep_q75, linetype = 'dashed') +
xlim(xmin, xmax) +
ylim(1, irep_highest) +
labs(x = '',
y = 'Average replication rate')+
theme_classic()+
theme(aspect.ratio=1,
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
panel.grid.major.x = element_line(color = "grey85"),
plot.margin = margin(b=-0.8,unit="cm"))
copies = cts_ %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
geom_line(aes(x = sdrt, y = entero_copy), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Enterococcus copy\nnumbers') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
# a violin plot to show all the entero irep distribution
entero_box <- ggboxplot(entero,  y = "ave_irpe", add = 'jitter',
xlab = '', ylab = 'All Enterococcus replication rate')+
theme_classic() +
ylim(1, irep_highest)+
theme(aspect.ratio=4,
plot.margin = margin(l=-0.8,unit="cm"),
axis.ticks.x=element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
)
irep_p11 <- plot_grid(irep, copies,entero_box, byrow = F,
nrow = 2, axis = 'ltbr', align = 'hv', rel_heights = c(2,1))
ggsave('../figs/paper/075_irep_p11_enterococcus.pdf', width = 120,
height = 140, units = 'mm', dpi = 400, plot = irep_p11)
irep_p11
View(cts_)
View(entero)
View(dtb)
dtb
# a plot to show the fruit intake over time for this patient
# by day
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15)
View(fruit)
fruit
# a plot to show the fruit intake over time for this patient
# by day
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15) %>%
mutate(Food_code = as.character(Food_code) ) %>%
filter(str_detect(Food_code, '^6'))
View(fruit)
fruit
# a plot to show the fruit intake over time for this patient
# by day
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15) %>%
mutate(Food_code = as.character(Food_code) ) %>%
filter(str_detect(Food_code, '^6')) %>%
group_by(fdrt) %>%
summarise(fruitsum = sum(dehydrated_weight))
fruit
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = '') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
fruit_time
p11_ver <- plot_grid(irep, copies,fruit_time, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(2,1, 1))
p11_ver
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15) %>%
mutate(Food_code = as.character(Food_code) ) %>%
filter(str_detect(Food_code, '^6'))
p11_ver
# customize patient 11
# use the global highest irep value for the highest in the y axis.
irep_highest <- max(entero$ave_irpe) + 0.05
irep_q25 <- quantile(x = entero$ave_irpe, 0.25)
irep_q50 <- quantile(x = entero$ave_irpe, 0.5)
irep_q75 <- quantile(x = entero$ave_irpe, 0.75)
p11 <- names(absl)[11]
xmax = 15
xmin = -5
quantile_annot_df <- tibble(
quant = c('25%','50%','75%'),
height = c(irep_q25, irep_q50, irep_q75)
)
irep = entero %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = ave_irpe )) +
geom_point() +
labs(title = str_glue('{}')) +
geom_hline(yintercept = irep_q25, linetype = 'dashed') +
#geom_text(data = quantile_annot_df, mapping = aes(x = 14, y = height, label = quant), nudge_y = 0.02, size = 2.5) +
geom_hline(yintercept = irep_q50, linetype = 'dashed') +
geom_hline(yintercept = irep_q75, linetype = 'dashed') +
xlim(xmin, xmax) +
ylim(1, irep_highest) +
labs(x = '',
y = 'Average replication rate')+
theme_classic()+
theme(aspect.ratio=1,
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
panel.grid.major.x = element_line(color = "grey85"),
plot.margin = margin(b=-0.8,unit="cm"))
copies = cts_ %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
geom_line(aes(x = sdrt, y = entero_copy), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Enterococcus copy\nnumbers') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
# a violin plot to show all the entero irep distribution
entero_box <- ggboxplot(entero,  y = "ave_irpe", add = 'jitter',
xlab = '', ylab = 'All Enterococcus replication rate')+
theme_classic() +
ylim(1, irep_highest)+
theme(aspect.ratio=4,
plot.margin = margin(l=-0.8,unit="cm"),
axis.ticks.x=element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
)
# a plot to show the fruit intake over time for this patient
# by day
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15) %>%
mutate(Food_code = as.character(Food_code) ) %>%
filter(str_detect(Food_code, '^6')) %>%
group_by(fdrt) %>%
summarise(fruitsum = sum(dehydrated_weight))
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(2,1, 1))
p11_ver
# customize patient 11
# use the global highest irep value for the highest in the y axis.
irep_highest <- max(entero$ave_irpe) + 0.05
irep_q25 <- quantile(x = entero$ave_irpe, 0.25)
irep_q50 <- quantile(x = entero$ave_irpe, 0.5)
irep_q75 <- quantile(x = entero$ave_irpe, 0.75)
p11 <- names(absl)[11]
xmax = 15
xmin = -5
quantile_annot_df <- tibble(
quant = c('25%','50%','75%'),
height = c(irep_q25, irep_q50, irep_q75)
)
irep = entero %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = ave_irpe )) +
geom_point() +
labs(title = str_glue('{}')) +
geom_hline(yintercept = irep_q25, linetype = 'dashed') +
#geom_text(data = quantile_annot_df, mapping = aes(x = 14, y = height, label = quant), nudge_y = 0.02, size = 2.5) +
geom_hline(yintercept = irep_q50, linetype = 'dashed') +
geom_hline(yintercept = irep_q75, linetype = 'dashed') +
xlim(xmin, xmax) +
ylim(1, irep_highest) +
labs(x = '',
y = 'Average replication rate')+
theme_classic()+
theme(aspect.ratio=1,
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
panel.grid.major.x = element_line(color = "grey85"),
plot.margin = margin(b=-0.8,unit="cm"))
copies = cts_ %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
geom_line(aes(x = sdrt, y = entero_copy), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Enterococcus copy\nnumbers') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
# a violin plot to show all the entero irep distribution
entero_box <- ggboxplot(entero,  y = "ave_irpe", add = 'jitter',
xlab = '', ylab = 'All Enterococcus replication rate')+
theme_classic() +
ylim(1, irep_highest)+
theme(aspect.ratio=4,
plot.margin = margin(l=-0.8,unit="cm"),
axis.ticks.x=element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
)
# a plot to show the fruit intake over time for this patient
# by day
fruit <- dtb %>%
filter(mrn == p11 & fdrt %in% -4:15) %>%
mutate(Food_code = as.character(Food_code) ) %>%
filter(str_detect(Food_code, '^6')) %>%
group_by(fdrt) %>%
summarise(fruitsum = sum(dehydrated_weight))
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.5,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,1, 1))
p11_ver
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.6,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
copies = cts_ %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
geom_line(aes(x = sdrt, y = entero_copy), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Enterococcus copy\nnumbers') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 1, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
copies = cts_ %>%
filter(sdrt %in% -5:15) %>%
filter(mrn == p11) %>%
ggplot(aes(x = sdrt, y = entero_copy )) +
geom_point() +
geom_line(aes(x = sdrt, y = entero_copy), linetype = 'solid', size = 0.5, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Enterococcus copy\nnumbers') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 0.5, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = 'Day relative to transplant',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
# a violin plot to show all the entero irep distribution
entero_box <- ggboxplot(entero,  y = "ave_irpe", add = 'jitter',
xlab = '', ylab = 'All Enterococcus replication rate')+
theme_classic() +
ylim(1, irep_highest)+
theme(aspect.ratio=5,
plot.margin = margin(l=-0.8,unit="cm"),
axis.ticks.x=element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
)
entero_box
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 0.5, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = '',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
# a violin plot to show all the entero irep distribution
entero_box <- ggboxplot(entero,  y = "ave_irpe", add = 'jitter',
xlab = '', ylab = 'All Enterococcus replication rate')+
theme_classic() +
ylim(1, irep_highest)+
theme(aspect.ratio=5,
plot.margin = margin(l=-0.8,unit="cm"),
axis.ticks.x=element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank() )
irep_p11 <- plot_grid(p11_ver,entero_box,
nrow = 1)
irep_p11
ggsave('../figs/paper/075_irep_p11_enterococcus.pdf', width = 120,
height = 140, units = 'mm', dpi = 400, plot = irep_p11)
ggsave('../figs/paper/075_irep_p11_enterococcus.pdf', width = 140,
height = 140, units = 'mm', dpi = 400, plot = irep_p11)
ggsave('../figs/paper/075_irep_p11_enterococcus.pdf', width = 140,
height = 120, units = 'mm', dpi = 400, plot = irep_p11)
irep_p11 <- plot_grid(p11_ver,entero_box,
nrow = 1, rel_widths = c(1.5,1))
irep_p11
irep_p11 <- plot_grid(p11_ver,entero_box,
nrow = 1, rel_widths = c(2,1))
ggsave('../figs/paper/075_irep_p11_enterococcus.pdf', width = 140,
height = 120, units = 'mm', dpi = 400, plot = irep_p11)
fruit_time <- fruit %>%
ggplot(aes(x = fdrt, y = fruitsum )) +
geom_point() +
geom_line(aes(x = fdrt, y = fruitsum), linetype = 'solid', size = 0.5, col = 'black') +
# scale_y_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
#          labels = scales::trans_format("log10", scales::math_format(10^.x))) +
xlim(xmin, xmax) +
labs(x = '',
y = 'Fruit intake') +
theme_classic() +
theme(aspect.ratio=1/2.8,
plot.margin = margin(l=-0.8,unit="cm"),
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
panel.grid.major.x = element_line(colour = "grey85"))
p11_ver <- plot_grid(fruit_time, irep, copies, byrow = F,
nrow = 3, axis = 'ltbr', align = 'hv', rel_heights = c(1,2, 1))
p11_ver
