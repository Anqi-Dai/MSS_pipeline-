group_by(Food_code) %>%
summarise(maxfc = max(perdayfc))
View(maxeachfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
summarise(maxfc = max(perdayfc))
perdaycode_wo_0
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
View(perdaycode_wo_0)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30))
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
summarise(maxfc = max(perdayfc))
perdaycode_wo_0
View(DTB)
perdaycode_wo_0
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
count
maxeachfc <- perdaycode_wo_0 %>%
#group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
maxeachfc <- perdaycode_wo_0 %>%
#group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
perdaycode_wo_0
perdaycode_wo_0
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
perdaycode_wo_0 %>%  ungroup()
?slice_max
perdaycode_wo_0 %>%  ungroup()
View(perdaycode_wo_0)
perdaycode_wo_0 %>%  ungroup()
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc )
View(maxeachfc)
another <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
summarise(max_ = max(perdayfc))
View(another)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename()
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
meta
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta )
summary(mod_fg9)
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch1'))
summary(mod_fg9)
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
knitr::opts_chunk$set(echo = TRUE)
DTB <- read_csv('../data/152_combined_DTB.csv')
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
outliers_wo_0 <- perdaycode_wo_0 %>%
group_by(Food_code) %>%
summarise(Q3 = quantile(perdayfc, probs = 0.75),
IQR = IQR(perdayfc)) %>%
mutate(outlierval = Q3 + 1.5*IQR )
whichoutlier <- perdaycode_wo_0 %>%
left_join(outliers_wo_0 %>% select(Food_code, outlierval), by = "Food_code") %>%
mutate(ifoutlier = if_else(perdayfc > outlierval, T, F)) %>%
ungroup()
# summarize at the foodcode level what is per for the outliers
howmuchoutlier <- whichoutlier %>%
count(Food_code, ifoutlier) %>%
add_count(Food_code, wt = n, name = 'totalperfc') %>%
mutate(perc = round(n/totalperfc*100, 2)) %>%
filter(ifoutlier == 'TRUE')
# to look at the first 10 foodcode with 25% outliers
top10 <- howmuchoutlier %>%
arrange(desc(perc)) %>%
slice_max(order_by = perc, n = 10) %>%
pull(Food_code)
# what are the per day records of the outlier days
whateat <- whichoutlier %>%
filter(Food_code %in% top10) %>%
left_join(DTB %>% distinct(Food_code, description)) %>%
arrange(desc(ifoutlier))
# this patient had a lot of things on day -3
ptb <- read_csv('../data/156_transplant_data.csv')
pt_ <- whateat %>%
slice(1) %>% pull(mrn)
whatmrn <- DTB %>%
filter(mrn == pt_ & fdrt == -3)
# so the patient had 2 fruit scone that day one for lunch and one for dinner
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
maxeachfc
# and the max of this maxfc
max_max <- maxeachfc %>%
slice_max(n = 1, order_by = maxfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
maxeachfc
View(perdaycode_wo_0)
View(DTB)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
DTB <- read_csv('../data/152_combined_DTB.csv')
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
perdaycode_wo_0
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()
perdaycode_wo_0
perdaycode_wo_0
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()
perdaycode_wo_0
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()
DTB <- read_csv('../data/152_combined_DTB.csv')
View(DTB)
DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()
View(perdaycode_wo_0)
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()%>%
mutate(description = str_sub(description, 1, 30))
perdaycode_wo_0
perdaycode_wo_0 %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()%>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = fct_reorder(description, .fun = median))
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()%>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = fct_reorder(description, perdayfc,.fun = median))
perdaycode_wo_0 %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>% ungroup()%>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = fct_reorder(description, perdayfc,.fun = median, .desc = T))
perdaycode_wo_0 %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
ggsave('../data/167_allfc_box.pdf', width = 6, height = 18)
# do a boxplot of the fc that the max per day intake is > 100 grams
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
View(maxeachfc)
max100 <- maxeachfc %>% filter(dailytotal > 100)
View(max100)
max100 <- maxeachfc %>% filter(dailytotal > 100) %>% pull(Food_code)
perdaycode_wo_0 %>%
filter(Food_code %in% max100) %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
ggsave('../data/167_allfc_box.pdf', width = 6, height = 18)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
max100 <- maxeachfc %>% filter(dailytotal > 100) %>% pull(Food_code)
perdaycode_wo_0 %>%
filter(Food_code %in% max100) %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
ggsave('../data/167_allfc_box.pdf', width = 6, height = 18)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
max100 <- maxeachfc %>% filter(dailytotal > 100) %>% pull(Food_code)
perdaycode_wo_0 %>%
filter(Food_code %in% max100) %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
ggsave('../data/167_allfc_box.pdf', width = 6, height = 18)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
max100 <- maxeachfc %>% filter(dailytotal > 100) %>% pull(Food_code)
perdaycode_wo_0 %>%
filter(Food_code %in% max100) %>%
ggboxplot(x = 'description', y = 'perdayfc',  orientation = "horizontal")
ggsave('../data/167_allfc_box.pdf', width = 6, height = 18)
perdaycode_wo_0 %>%
filter(Food_code %in% max100)
# to look at the unit table with these food codes and specifically pay attention to the ones with different units
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
# to look at the unit table with these food codes and specifically pay attention to the ones with different units
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
View(unit)
# to look at the unit table with these food codes and specifically pay attention to the ones with different units
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
# to look at the unit table with these food codes and specifically pay attention to the ones with different units
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
# to look at the unit table with these food codes and specifically pay attention to the ones with different units
unit <- read_csv('../data/148_both_batches_UNIT_table_EN_exclu.csv')
look <- unit %>%
filter(Food_code %in% max100)
View(look)
unit
look <- unit %>%
filter(Food_code %in% max100) %>%
distinct(Unit, Food_code, cal_psu, .keep_all = T) %>%
```
look <- unit %>%
filter(Food_code %in% max100) %>%
distinct(Unit, Food_code, cal_psu, .keep_all = T)
look <- unit %>%
filter(Food_code %in% max100) %>%
distinct(Unit, Food_code, cal_psu, .keep_all = T)
library(kableExtra)
look %>%
split(.$Food_code) %>%
map(function(df){
df %>% arrange(Unit) %>%
kbl() %>% kable_paper("hover", full_width = F)
})
look %>%
split(.$Food_code) %>%
map(function(df){
df %>% arrange(Unit) %>%
kbl() %>% kable_paper("hover", full_width = F)
})
look %>% arrange(Unit) %>%
kbl() %>% kable_paper("hover", full_width = F)
look %>% arrange(Food_code, Unit) %>% write_csv('../data/167_look_max100.csv')
library(openxlsx)
library(openxlsx)
output <- split(look, look$Food_code)
wb <- createWorkbook()
for (i in 1:length(output)) {
addWorksheet(wb, sheetName=names(output[i]))
writeData(wb, sheet=names(output[i]), x=output[[i]]) # Note [[]]
}
saveWorkbook(wb, "../data/167_look_max100.xlsx", overwrite = TRUE)
library(openxlsx)
output <- look %>% arrange(Food_code, Unit) %>% split(.$Food_code)
wb <- createWorkbook()
for (i in 1:length(output)) {
addWorksheet(wb, sheetName=names(output[i]))
writeData(wb, sheet=names(output[i]), x=output[[i]]) # Note [[]]
}
saveWorkbook(wb, "../data/167_look_max100.xlsx", overwrite = TRUE)
View(maxeachfc)
View(unit)
