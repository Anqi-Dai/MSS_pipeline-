distinct(sampleid, .keep_all = T)
rfiles <- asv_alpha_diversity_ag %>%
filter(sampleid %in% s11$sampleid) %>%
distinct(sampleid, .keep_all = T) %>%
mutate(R1 = str_glue('{oligos_id}_R1.fastq.gz'),
R2 = str_glue('{oligos_id}_R2.fastq.gz')) %>%
mutate(p1 = str_glue('{path_pool}/{R1}'),
p2 = str_glue('{path_pool}/{R2}'))
rfiles %>%
select(p1, p2) %>%
gather() %>%
mutate(cmd = str_glue('scp daia1@lilac.mskcc.org:{value} .')) %>%
select(cmd) %>%
write_csv('../data/dl_r7.sh', col_names = F)
# the sra table
sra_r <- tibble(
sample_name = rfiles$sampleid,
library_ID = rfiles$sampleid,
title = 'Stool sample of allo-HCT patient',
library_strategy = 'amplicon',
library_source = 'GENOMIC',
library_selection = 'PCR',
library_layout ='paired',
platform= 'ILLUMINA',
instrument_model= 'Illumina MiSeq',
design_description='PCR amplification of 16S V4-V5 regions; Bead-beating, phenol chloroform DNA extraction',
filetype= 'fastq',
filename=rfiles$R1,
filename2=rfiles$R2
)
sra_r %>%
write_tsv('../data/rob/r_sra.tsv')
s11 <- bind_rows(need %>% select(sampleid),missing %>% select(sampleid) )  %>%
mutate(pid = str_replace(sampleid, 'A|B|C|D','')) %>%
filter(! sampleid %in% missing$sampleid)
View(s11)
s11 <- bind_rows(need %>% select(sampleid),missing %>% select(sampleid) )  %>%
mutate(pid = str_replace(sampleid, 'A|B|C|D','')) %>%
filter(! sampleid %in% missing$sampleid) %>%
inner_join(samples_castori_ag %>% select(sampleid, datecollection))
r_s <- tibble(
Sample_name = s11$sampleid,
Organism = 'human gut metagenome',
host = 'Homo sapiens',
isolation_source = 'stool',
collection_date = s11$datecollection,
geo_loc_name = 'USA: New York',
lat_lon = '40.7641 N 73.9568 W',
patient_id = s11$pid
)
r_s %>%
write_tsv('../data/rob/biosample_att.tsv')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv')
View(duke)
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv')
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
View(asv_alpha_diversity_ag)
already <- duke %>%
inner_join(asv_alpha_diversity_ag)
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligoid')
duke
asv_alpha_diversity_ag
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id')
View(already)
View(duke)
View(already)
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id)
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid) %>%
distinct(oligos_id)
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
# missing
missing <- duke %>%
filter(!oligos_id %in% asv_alpha_diversity_ag$oligos_id)
2678-1769
View(missing)
missing
missing %>%
count(submitted_for_sequencing)
find <- missing %>%
filter(submitted_for_sequencing == 'yes')
View(find)
find
find %>%
count(notes)
View(asv_alpha_diversity_ag)
View(duke)
asv_alpha_diversity_ag
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094+1095|pool1096+1097'))
View(three)
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097'))
View(three)
View(three)
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097|pool1100'))
View(find)
dir.create('../data/duke')
three %>%
write_csv('../data/duke/pool1094+1095_and_pool1096+1097_and_pool1100.csv')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
# total: 2678
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
# already 1769
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
# missing
missing <- duke %>%
filter(!oligos_id %in% asv_alpha_diversity_ag$oligos_id)
find <- missing %>%
filter(submitted_for_sequencing == 'yes')
find %>%
count(notes)
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097|pool1100'))
dir.create('../data/duke')
three %>%
write_csv('../data/duke/pool1094+1095_and_pool1096+1097_and_pool1100.csv')
View(missing)
View(missing)
View(find)
View(three)
three %>%
mutate(sid = str_replace(sampleid, '\\.','_'))
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find)
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find, by = 'sampleid')
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = sampleid))
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = oligos_id))
find
three
three
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = sampleid))
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = sampleid), by = 'sid')
three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = oligos_id), by = 'sid')
first <-three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
inner_join(find %>% rename(sid = oligos_id), by = 'sid')
View(first)
first <-three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
right_join(find %>% rename(sid = oligos_id), by = 'sid')
View(first)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
# all the irep values I got
fns <- list.files('../data/growth/irep/updated_irep/', full.names = T, pattern = '.tsv')
irep <- fns %>%
set_names(fns) %>%
purrr::map(~  read_tsv(file = ., n_max = 1 , col_types = 'cc',  skip = 2, col_names = c('bin','iRep')) %>%  select(iRep) ) %>%
bind_rows(.id = 'fn') %>%
mutate(fn = str_replace(fn, '_irep.tsv$',''),
fn = str_replace(fn, '../data/growth/irep/updated_irep//','')) %>%
separate(fn, into = c('sampleid','samplebin'), sep = '__concat__', remove = T) %>%
mutate(iRep = as.numeric(iRep)) %>%
mutate(samplebin = str_replace(samplebin, '_irep_dastool.tsv','')) %>%
mutate(sbid = str_glue('{sampleid}__{samplebin}'))
full <- read_tsv('../data/growth/bhatpipeline/binning_table_all_full.tsv')
tb <- read_tsv('../data/growth/bhatpipeline/binning_table_all_simple.tsv') %>%
rename_all(~ gsub("\\.", "_", .)) %>%
mutate(fpmbp = `# contigs (>= 0 bp)`/Size_Mb) %>%
filter(Completeness >= 75 & fpmbp <= 175 & Contamination <= 2) %>%
mutate(Sample = str_replace(Sample, '__concat',''),
sbid = str_glue('{Sample}__{Bin}')) %>%
inner_join(irep, by  = 'sbid') %>%
relocate(iRep, .after = 'Bin') %>%
relocate(best_species, .after = 'iRep') %>%
filter(!is.na(iRep)) %>%
arrange(Sample,Bin,  best_species) %>%
# if there are multiple get the average
group_by(Sample, best_species, best_level) %>%
summarise(aveirep = mean(iRep)) %>%
filter(best_species != 'Unclassified')
# save a copy of the high quality bins from the growth samples
bins <-  read_tsv('../data/growth/bhatpipeline/binning_table_all_simple.tsv') %>%
rename_all(~ gsub("\\.", "_", .)) %>%
mutate(fpmbp = `# contigs (>= 0 bp)`/Size_Mb) %>%
filter(Completeness >= 75 & fpmbp <= 175 & Contamination <= 2) %>%
mutate(Sample = str_replace(Sample, '__concat',''),
sbid = str_glue('{Sample}__{Bin}')) %>%
filter(best_species != 'Unclassified') %>%
arrange(Sample,Bin,  best_species) %>%
relocate(best_species, .after = 'Bin')
bins %>%
distinct(Sample,  best_species)
# check the one best species that have multiple irep
tb %>%
count(Sample, best_species, sort = T)
# combined %>%
#   mutate(gt15 = if_else(iRep > 1.5, T, F)) %>%
#   count(gt15) %>%
#   mutate(perc = n/sum(n)*100)
View(bins)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
# total: 2678
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
# already 1769
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
# missing
missing <- duke %>%
filter(!oligos_id %in% asv_alpha_diversity_ag$oligos_id)
find <- missing %>%
filter(submitted_for_sequencing == 'yes')
find %>%
count(notes)
first <-three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
right_join(find %>% rename(sid = oligos_id), by = 'sid')
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097|pool1100'))
first <-three %>%
mutate(sid = str_replace(sampleid, '\\.','_')) %>%
right_join(find %>% rename(sid = oligos_id), by = 'sid')
# total: 2678
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
# already 1769
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
# missing
missing <- duke %>%
filter(!oligos_id %in% asv_alpha_diversity_ag$oligos_id)
find <- missing %>%
filter(submitted_for_sequencing == 'yes')
find %>%
count(notes)
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097|pool1100'))
View(three)
library(tidyverse)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
# total: 2678
duke <- read_csv('../data/duke_samples_for_angel_02-22-2022 (1).csv') %>%
rename(oligos_id = oligoid)
# already 1769
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
# missing
missing <- duke %>%
filter(!oligos_id %in% asv_alpha_diversity_ag$oligos_id)
find <- missing %>%
filter(submitted_for_sequencing == 'yes')
find %>%
count(notes)
# the three pools
three <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1094\\+1095|pool1096\\+1097|pool1100'))
View(find)
View(find)
View(three)
threeduke <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100'))
View(threeduke)
threeduke
threeduke <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, oligos_id)
View(find)
find
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)
View(find)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, oligos_id)
View(two)
View(threeduke)
View(asv_alpha_diversity_ag)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, oligos_id) %>%
distinct()
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)  %>%
mutate(sid = str_replace_all(oligos_id, '\|\\\\',''))
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)  %>%
mutate(sid = str_replace_all(oligos_id, '-|\\\\',''))
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)  %>%
mutate(sid = str_replace_all(oligos_id, '-|\\\\','\\.'))
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)  %>%
mutate(sid = str_replace_all(oligos_id, '-|/','\\.'))
select(sampleid %>%
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct()
two <- asv_alpha_diversity_ag %>%
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct()
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct()
View(two)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct() %>%
rename(sid = sampleid)
length(intersect(two$sid, find$sid))
setdiff(intersect(two$sid, find$sid))
setdiff(intersect(two$sid, find$sid))
setdiff(two$sid, find$sid)
setdiff(two$sid, find$sid)
setdiff( find$sid, two$sid)
find <- missing %>%
filter(submitted_for_sequencing == 'yes') %>%
select(sampleid, sampleid_clean, oligos_id, notes , experiment)  %>%
mutate(sid = str_replace_all(oligos_id, '-|/|_','\\.'))
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct() %>%
rename(sid = sampleid)
length(intersect(two$sid, find$sid))
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct() %>%
rename(sid = sampleid)
length(intersect(two$sid, find$sid))
setdiff( find$sid, two$sid)
318-90
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid) %>%
distinct() %>%
rename(sid = sampleid)
length(intersect(two$sid, find$sid))
setdiff( find$sid, two$sid)
find
# the 228 that don't know what the pool or where the samples are
where <- find %>%
filter(!sid %in% two$sid)
# the 228 that don't know what the pool or where the samples are
where <- find %>%
filter(!sid %in% two$sid)
View(where)
where %>%
write_csv('../data/duke/where_the_228.csv')
View(missing)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, path_pool) %>%
distinct(sampleid, .keep_all = T) %>%
rename(sid = sampleid)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, path_pool) %>%
distinct(sampleid, .keep_all = T) %>%
rename(sid = sampleid)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, path_pool) %>%
distinct(sampleid, .keep_all = T) %>%
rename(sid = sampleid)
two <- asv_alpha_diversity_ag %>%
filter(str_detect(path_pool, 'pool1096\\+1097|pool1100')) %>%
select(sampleid, path_pool) %>%
distinct(sampleid, .keep_all = T) %>%
rename(sid = sampleid)
View(two)
length(intersect(two$sid, find$sid))
View(two)
two %>%
write_csv('../data/duke/two_pools_90_path.csv')
# already 1769
already <- duke %>%
inner_join(asv_alpha_diversity_ag, by = 'oligos_id') %>%
distinct(oligos_id, .keep_all = T)
View(already)
already %>%
select(oligos_id, path_pool ) %>%
write_csv('../data/duke/already_1769_path.csv')
knitr::opts_chunk$set(echo = TRUE)
dtb <- read_csv('../data/cleaned_diet_data/FINAL_97_with_code_all_foods_drt_with_EN_finalized.csv')
View(dtb)
View(dtb)
dtb %>%
select(-mrn)
dtb %>%
select(-mrn) %>%
distinct(Food_NSC, .keep_all = T)
send <- dtb %>%
select(-mrn) %>%
distinct(Food_NSC, .keep_all = T)
View(send)
send %>% write_csv('../data/subset_unique_food_nsc.csv')
knitr::opts_chunk$set(echo = TRUE)
# to combine them together
acc1 <- read_csv('../data/rob/already_161.csv')
View(acc1)
total <- read_csv('../data/save/all_biosample_table_20220226.csv')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx')
acc2 <- read_tsv('../data/rob/metadata-11152272-sra_7.tsv')
View(acc2)
View(acc1)
acc2 <- read_tsv('../data/rob/metadata-11152272-sra_7.tsv') %>%
select(Accession = accession, sampleid = library_ID)
all <- bind_rows(acc1, acc2)
View(all)
all %>% write_csv('../data/rob/final_168_acc.csv')
View(all)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted')
# 172
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
# 172
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
sam <- read_csv('../data/shotgun_samples_16sQPCR.csv')
View(sam)
# the shotgun sampleids
serpath <- '/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/'
fid <- read_csv(file = file.path(serpath, '10_shotgun_metaphlan.csv'))
# the shotgun sampleids
serpath <- '/Volumes/vandenbrinklab/oriana/Study ideas/bile_acids/final_datasets/'
fid <- read_csv(file = file.path(serpath, '10_shotgun_metaphlan.csv'))
View(fid)
fid %>%
distinct(fid)
View(sam)
fid <- read_csv(file = file.path(serpath, '10_shotgun_metaphlan.csv')) %>%
inner_join(sam)
fid %>%
distinct(fid)
fid %>%
distinct(fid)
fid <- read_csv(file = file.path(serpath, '10_shotgun_metaphlan.csv')) %>%
inner_join(sam) %>%
mutate(R1 = str_glue('/home/daia1/my_workdir/samples/{fid}_knead_paired_1.fastq.gz'),
R2 = str_glue('/home/daia1/my_workdir/samples/{fid}_knead_paired_2.fastq.gz'))
View(fid)
fid %>%
distinct(R1, R2)
fid %>%
distinct(fid, R1, R2)
fid %>%
distinct(fid, R1, R2) %>%
write_csv('../data/Oriana_qpcr_157.csv')
