rename(fg1_name = fg1_dom) %>%
left_join(key )
color_key <- df %>%
ungroup() %>%
distinct(shortname, color) %>%
select(shortname, color) %>%
#mutate(shortname = factor(shortname)) %>%
#arrange(shortname) %>%
deframe()
fig1_umap <- df %>%
arrange(desc(n)) %>%
ggscatter(x = 'taxumap1', y = 'taxumap2', color = 'shortname', alpha = 0.5,size = 3 , shape = 16,
xlab = 'TaxUMAP1', ylab = 'TaxUMAP2') +
scale_color_manual(values = color_key) +
theme_classic() +
#lemon::coord_capped_cart(bottom = 'both', left = 'both') +
theme(legend.position = "none",
line = element_blank(),
legend.title = element_blank(),
axis.title=element_blank(),
axis.text= element_blank(),
axis.ticks = element_blank(),
aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(alpha=1)))
umap_faith <- another %>%
arrange(desc(n)) %>%
mutate(log10faith = log10(faith_pd + 1)) %>%
ggscatter(x = 'taxumap1', y = 'taxumap2', color = 'faith_pd', alpha = 0.3,size = 3 , shape = 16,
xlab = '', ylab = '') +
scale_color_viridis() +
theme_classic() +
#lemon::coord_capped_cart(bottom = 'both', left = 'both') +
theme(legend.position = 'none',
line = element_blank(),
legend.title = element_blank(),
axis.title=element_blank(),
axis.text= element_blank(),
axis.ticks = element_blank(),
aspect.ratio=1)
umap_faith
bot <- plot_grid(day_cal, m_panel, diet_alpha, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1,1.4,1),
#rel_heights = c(1,1),
labels = c('D','E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
fig1_umap <- df %>%
arrange(desc(n)) %>%
ggscatter(x = 'taxumap1', y = 'taxumap2', color = 'shortname', alpha = 0.3,size = 3 , shape = 16,
xlab = 'TaxUMAP1', ylab = 'TaxUMAP2') +
scale_color_manual(values = color_key) +
theme_classic() +
#lemon::coord_capped_cart(bottom = 'both', left = 'both') +
theme(legend.position = "none",
line = element_blank(),
legend.title = element_blank(),
axis.title=element_blank(),
axis.text= element_blank(),
axis.ticks = element_blank(),
aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(alpha=1)))
View(day_calori)
# make a combined version of the faith and the day_cal
food <- day_calori %>%
full_join(faith)
View(food)
food
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value', facet.by = 'type',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=2)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value', facet.by = 'type',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=2)
# make a combined version of the faith and the day_cal
food <- day_calori %>%
full_join(faith)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=2)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = 'none',
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
strip.text = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
# make a combined version of the faith and the day_cal
food <- day_calori %>%
full_join(faith)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = 'Daily caloric intake',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
strip.text = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = 'Daily caloric intake',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme_classic() +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
strip.text = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
food2 <- food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = 'Daily caloric intake',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme_classic() +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
strip.text = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
bot <- plot_grid(food2, m_panel, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1.4,1),
#rel_heights = c(1,1),
labels = c('E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
stool_alpha <- meta %>%
ggscatter(x = 'sdrt', y = 'simpson_reciprocal', alpha = alpha_val, size = point_size,
xlab = 'Day relative to HCT', shape = 'triangle',
ylab = expression(Microbiome~alpha~diversity),
title = expression(Microbiome~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = stool_line_color, fill = "darkblue", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
stool_alpha
bot <- plot_grid(food2, m_panel, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1.4,1),
#rel_heights = c(1,1),
labels = c('E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
fg_all <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
mutate(fgrp1 = as.numeric(fgrp1)) %>%
group_by(mrn, fdrt, fgrp1) %>%
summarise(eachsum = sum(dehydrated_weight)) %>%
left_join(key)
fg_panel <- fg_all %>%
ggscatter(x = 'fdrt', y = 'eachsum', alpha = 0.005, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Grams',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1))  +
facet_wrap(~ shortname,
scales = 'free_y',
nrow = 3, ) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=6),
strip.background = element_blank(),
strip.text.x = element_text(size = stip_txt_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
fg_panel
bot <- plot_grid(food2, m_panel, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1.4,1),
#rel_heights = c(1,1),
labels = c('E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
stool_alpha <- meta %>%
ggscatter(x = 'sdrt', y = 'simpson_reciprocal', alpha = alpha_val, size = point_size,
xlab = 'Day relative to HCT', shape = 'triangle',
ylab = expression(Microbiome~alpha~diversity),
title = expression(Microbiome~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = stool_line_color, fill = "darkblue", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=2)
stool_alpha
bot <- plot_grid(food2, m_panel, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1.4,1),
#rel_heights = c(1,1),
labels = c('E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
alpha_val
food2 <- food %>%
gather('type', 'value', daycal:faith_pd) %>%
mutate(value = value/1000) %>%
ggscatter('fdrt', 'value',
alpha = 0.02,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = 'Daily caloric intake',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
facet_grid(type ~ .) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme_classic() +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
strip.background = element_blank(),
strip.text = element_blank(),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
bot <- plot_grid(food2, m_panel, fg_panel,  stool_alpha,
nrow = 1,
align = 'hv',
rel_widths =  c(1,1.2,1.4,1),
#rel_heights = c(1,1),
labels = c('E','F', 'G', "H"),
axis = 'tblr')
top <- plot_grid(tree, fig1_umap, umap_faith,
labels = c('B', "C", "D"),
nrow = 1, rel_widths = c(1.5,1, 1), axis = 'lbrt', align = 'hv')
# assemble all
f1 <-  plot_grid(top, bot,
rel_heights = c(1,1),
nrow = 2)
ggsave('../figs/paper/F1_overview_072_raw.pdf',
width = 220,
height = 140,
#height = 60,
units = c("mm"),
dpi = 400, plot = f1)
# another version with the legend
another %>%
arrange(desc(n)) %>%
mutate(log10faith = log10(faith_pd + 1)) %>%
ggscatter(x = 'taxumap1', y = 'taxumap2', color = 'faith_pd', alpha = 0.3,size = 3 , shape = 16,
xlab = '', ylab = '') +
scale_color_viridis() +
theme_classic() +
#lemon::coord_capped_cart(bottom = 'both', left = 'both') +
theme(line = element_blank(),
legend.title = element_blank(),
axis.title=element_blank(),
axis.text= element_blank(),
axis.ticks = element_blank(),
aspect.ratio=1)
# another version with the legend
umap_faith_legend <- another %>%
arrange(desc(n)) %>%
mutate(log10faith = log10(faith_pd + 1)) %>%
ggscatter(x = 'taxumap1', y = 'taxumap2', color = 'faith_pd', alpha = 0.3,size = 3 , shape = 16,
xlab = '', ylab = '') +
scale_color_viridis() +
theme_classic() +
#lemon::coord_capped_cart(bottom = 'both', left = 'both') +
theme(line = element_blank(),
legend.title = element_blank(),
axis.title=element_blank(),
axis.text= element_blank(),
axis.ticks = element_blank(),
aspect.ratio=1)
ggsave('../data/072_umap_faith_legend.pdf')
ggsave('../data/072_umap_faith_legend.pdf', plot = umap_faith_legend)
