fg_legume+
fg_veggie+
TPN+
EN+
(1 | mrn) +
(1 | timebin)
get_prior(div_model,data = meta )
meta <- read_csv('../data/153_combined_META.csv') %>%
mutate(timebin = cut_width(sdrt, 7, boundary=0, closed = 'left')) %>%
mutate(intensity = factor(intensity, levels = c('nonablative','reduced','ablative'))) %>%
mutate(mrn = factor(mrn)) %>%
mutate(fg_egg = fg_egg/100,
fg_fruit = fg_fruit/100,
fg_grain = fg_grain/100,
fg_legume = fg_legume/100,
fg_meat = fg_meat/100,
fg_milk = fg_milk/100,
fg_oils = fg_oils/100,
fg_sweets = fg_sweets/100,
fg_veggie = fg_veggie/100) %>%
mutate(abx = if_else(empirical == 'TRUE', 1, 0),
TPN = if_else(TPN == 'TRUE', 1, 0),
EN = if_else(EN == 'TRUE', 1, 0)) %>%
mutate(      fg_fruit_e= fg_fruit*abx,
fg_meat_e=fg_meat*abx,
fg_milk_e=fg_milk*abx,
fg_oils_e=fg_oils*abx,
fg_egg_e=fg_egg*abx,
fg_grain_e=fg_grain*abx,
fg_sweets_e=fg_sweets*abx,
fg_legume_e=fg_legume*abx,
fg_veggie_e = fg_veggie*abx)
div_priors_smaller <- c(# for the food group variables
prior(normal(0, 0.1), class = 'b', coef = "fg_egg"),
prior(normal(0, 0.1), class = 'b', coef = "fg_fruit"),
prior(normal(0, 0.1), class = 'b', coef = "fg_grain"),
prior(normal(0, 0.1), class = 'b', coef = "fg_legume"),
prior(normal(0, 0.1), class = 'b', coef = "fg_meat"),
prior(normal(0, 0.1), class = 'b', coef = "fg_milk"),
prior(normal(0, 0.1), class = 'b', coef = "fg_oils"),
prior(normal(0, 0.1), class = 'b', coef = "fg_sweets"),
prior(normal(0, 0.1), class = 'b', coef = "fg_veggie"),
# interaction terms
prior(normal(0, 0.1), class = 'b', coef = "fg_egg_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_fruit_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_grain_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_legume_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_meat_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_milk_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_oils_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_sweets_e"),
prior(normal(0, 0.1), class = 'b', coef = "fg_veggie_e"),
# for the TPN
prior(normal(0, 0.1), class = 'b', coef = "TPN"),
# for the EN
prior(normal(0, 0.1), class = 'b', coef = "EN"),
# for the empirical
prior(normal(0, 0.5), class = 'b', coef = "abx"),
# for the intensity
prior(normal( 2, .1), class = 'b', coef = "intensityablative"),
prior(normal( 2, .1), class = 'b', coef = "intensityreduced"),
prior(normal( 2, .1), class = 'b', coef = "intensitynonablative")
)
fitPrior <- brm(div_model, data=meta,
family = 'gaussian',
prior=div_priors_smaller,
sample_prior = "only")
# the below is the posterior predictive check
prior_c <- pp_check(fitPrior, type = "scatter_avg", ndraws = 100)$data
set.seed(123)
prior_pred <- pp_check(fitPrior, type = "boxplot", nreps = 10, notch = FALSE, alpha = 0) +
labs(y = 'log(microbiome alpha diversity)') +
scale_color_discrete(labels=c('observed distribution', 'simulated from prior predictive distribution')) +
theme(legend.position = 'bottom', legend.title = element_blank())
prior_pred
set.seed(123)
prior_pred <- pp_check(fitPrior, type = "boxplot", nreps = 10, notch = FALSE, alpha = 0) +
labs(y = 'log(microbiome alpha diversity)') +
scale_color_discrete(labels=c('observed distribution', 'simulated from prior predictive distribution')) +
theme(legend.position = 'bottom', legend.title = element_blank())
prior_pred
set.seed(123)
prior_pred <- pp_check(fitPrior, type = "boxplot", nreps = 10, notch = FALSE, alpha = 0) +
labs(y = 'log(microbiome alpha diversity)') +
scale_color_discrete(labels=c('observed distribution', 'simulated from prior predictive distribution')) +
theme(legend.position = 'bottom', legend.title = element_blank())
prior_pred
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,3,5,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,3,7,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.05, 1)
) +theme(plot.margin = unit(c(1,3,7,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,3,7,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label_y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label_y = 0,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
#label_y = 0,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
?ggarrange
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 0,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 0.5,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 0.9,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig. S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig. S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
post_pred <- pp_check(fit, type = "boxplot", nreps = 10, notch = FALSE, alpha = 0)+
labs(y = 'log(microbiome alpha diversity)') +
scale_color_discrete(labels=c('observed distribution', 'simulated from posterior predictive distribution')) +
theme(legend.position = 'bottom', legend.title = element_blank())
post_pred
fg_pt <- read_rds('../data/176_fg_intensity.rds')
S3 <- ggarrange(post_pred, fg_pt,
labels = c("A", "B"), align = "v",
label.y = 1,
ncol = 1, nrow = 2)
title <- ggdraw() +
draw_label(
"Fig. S3",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
combined <- plot_grid(
title, S3,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(2,3,6,3), "cm"))
ggsave('../data/S3_postp_check_and_intensity_173.pdf',
width = 210, height = 297, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
