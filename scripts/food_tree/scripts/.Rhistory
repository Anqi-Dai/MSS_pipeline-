}) %>%
set_names(stb_loop_sum %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid') %>%
spread(key = 'sampleid', value = 'ave_gram', fill = 0)
p1d <- p1d[, colSums(p1d != 0) > 0]
p2d <- apply(stb_loop_sum, 1, function(Row){
df = dtb %>%
filter(mrn == Row[['mrn']]) %>%
filter(fdrt %in% c(Row[['p1d']], Row[['p2d']])) %>%
group_by(nutrient) %>%
summarise(ave_gram = sum(gram)/2)
}) %>%
set_names(stb_loop_sum %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid') %>%
spread(key = 'sampleid', value = 'ave_gram', fill = 0)
p2d <- p2d[, colSums(p2d != 0) > 0]
p3d <- apply(stb_loop_sum, 1, function(Row){
df = dtb %>%
filter(mrn == Row[['mrn']]) %>%
filter(fdrt %in% c(Row[['p1d']], Row[['p2d']], Row[['p3d']])) %>%
group_by(nutrient) %>%
summarise(ave_gram = sum(gram)/3)
}) %>%
set_names(stb_loop_sum %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid') %>%
spread(key = 'sampleid', value = 'ave_gram', fill = 0)
p3d <- p3d[, colSums(p3d != 0) > 0]
p4d <- apply(stb_loop_sum, 1, function(Row){
df = dtb %>%
filter(mrn == Row[['mrn']]) %>%
filter(fdrt %in% c(Row[['p1d']], Row[['p2d']], Row[['p3d']], Row[['p4d']])) %>%
group_by(nutrient) %>%
summarise(ave_gram = sum(gram)/4)
}) %>%
set_names(stb_loop_sum %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid') %>%
spread(key = 'sampleid', value = 'ave_gram', fill = 0)
p4d <- p4d[, colSums(p4d != 0) > 0]
p5d <- apply(stb_loop_sum, 1, function(Row){
df = dtb %>%
filter(mrn == Row[['mrn']]) %>%
filter(fdrt %in% c(Row[['p1d']], Row[['p2d']], Row[['p3d']], Row[['p4d']], Row[['p5d']])) %>%
group_by(nutrient) %>%
summarise(ave_gram = sum(gram)/5)
}) %>%
set_names(stb_loop_sum %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid') %>%
spread(key = 'sampleid', value = 'ave_gram', fill = 0)
View(pt_fdrt)
View(p1d)
p5d <- p5d[, colSums(p5d != 0) > 0]
# output the macronutrients cts table (need to be in a similar format to fit my previously written snakemake rules)
dcts <- list(p1d = p1d,
p2d = p2d,
p3d = p3d,
p4d = p4d,
p5d = p5d)
for (i in 1:length(dcts)){
dcts[[i]] %>%
write_tsv(str_glue('../data/finalized/paired/pNday/allstool_{names(dcts)[i]}_diet_macro_dehydrated_weight_per_pt.tsv'))
}
knitr::opts_chunk$set(echo = TRUE)
library(vdbR)
connect_database(config_file = '~/dbConfig.txt')
get_table_from_database('asv_annotation_blast_ag')
stb <- read_csv('../data/152_combined_STB.csv')
stb
cts <- get_counts_subset(stb$sampleid)
cts_genus <- cts %>%
inner_join(asv_annotation_blast_ag %>%  select(asv_key, genus), by  = 'asv_key') %>%
group_by(sampleid, genus) %>%
summarise(relab = sum(count_relative))
cts_spread <- cts_genus %>%
spread('genus', 'relab', fill = 0)
cts_genus %>%
write_csv('../data/022_ALL173_stool_samples_genus_counts.csv')
p5d_samples
# the genus counts data would be :
cts_long <- read_csv('../data/022_ALL173_stool_samples_genus_counts.csv') %>%
filter(sampleid %in% p5d_samples)
# the genus counts data would be :
cts_long <- read_csv('../data/022_ALL173_stool_samples_genus_counts.csv') %>%
filter(sampleid %in% p5d_samples)
# since the samples in the diet counts are different so need to subset according to each
p1d_scts <- cts_long %>%
filter(sampleid %in% colnames(p1d)[2:ncol(p1d)]) %>%
spread('sampleid', 'relab', fill = 0)
p2d_scts <- cts_long %>%
filter(sampleid %in% colnames(p2d)[2:ncol(p2d)]) %>%
spread('sampleid', 'relab', fill = 0)
p3d_scts <- cts_long %>%
filter(sampleid %in% colnames(p3d)[2:ncol(p3d)]) %>%
spread('sampleid', 'relab', fill = 0)
p4d_scts <- cts_long %>%
filter(sampleid %in% colnames(p4d)[2:ncol(p4d)]) %>%
spread('sampleid', 'relab', fill = 0)
p5d_scts <- cts_long %>%
filter(sampleid %in% colnames(p5d)[2:ncol(p5d)]) %>%
spread('sampleid', 'relab', fill = 0)
scts <- list(
p1d_scts = p1d_scts,
p2d_scts = p2d_scts,
p3d_scts = p3d_scts,
p4d_scts = p4d_scts,
p5d_scts = p5d_scts
)
for (i in 1:length(scts)){
scts[[i]] %>%
write_tsv(str_glue('../data/finalized/paired/pNday/allstool_{names(scts)[i]}_stool_relab_species.tsv'))
}
# use 091 to produce the p1d...p5d macronutrients table
# use 022 to produce the p1d...p5d genus counts table
# use the snakefile to calculate the pcoa
# the below is the results from all of the patients
fns_both <- tibble(
sfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_scts_stool_relab_species_braycurtis_pcoa$', full.names = T),
dfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_diet_macro_dehydrated_weight_per_pt_bc_pcoa$', full.names = T)
) %>%
mutate(ID = str_replace(sfolder, '_scts_stool_relab_species_braycurtis_pcoa', ''),
ID = str_replace(ID, '../data/finalized/paired/pNday//allstool_','')) %>%
mutate(sfn = str_glue('{sfolder}/ordination.txt'),
dfn = str_glue('{dfolder}/ordination.txt'))
View(fns_both)
# use 091 to produce the p1d...p5d macronutrients table
# use 022 to produce the p1d...p5d genus counts table
# use the snakefile to calculate the pcoa
# the below is the results from all of the patients
fns_both <- tibble(
sfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_scts_stool_relab_species_braycurtis_pcoa$', full.names = T),
dfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_diet_macro_dehydrated_weight_per_pt_bc_pcoa$', full.names = T)
) %>%
mutate(ID = str_replace(sfolder, '_scts_stool_relab_species_braycurtis_pcoa', ''),
ID = str_replace(ID, '../data/finalized/paired/pNday//allstool_','')) %>%
mutate(sfn = str_glue('{sfolder}/ordination.txt'),
dfn = str_glue('{dfolder}/ordination.txt'))
# sum of squares
procrustes_Nday <- map2_dfc(fns_both$dfn, fns_both$sfn, function(dfn, sfn){
dpcoa = read_tsv(dfn, skip = 9, col_names = F)  %>%
filter(! X1 %in% c('Biplot','Site constraints')) %>%
column_to_rownames('X1') %>%
as.matrix()
spcoa = read_tsv(sfn, skip = 9, col_names = F)  %>%
filter(! X1 %in% c('Biplot','Site constraints')) %>%
column_to_rownames('X1') %>%
as.matrix()
procrustes_res = procrustes(X = dpcoa, Y = spcoa)
return( procrustes_res$ss)
}) %>%
gather(key = 'pNd', value = 'ss') %>%
mutate(pNd = fns_both$ID)
# convert it to a score so that the p2d is the highest
procrustes_Nday_score <- procrustes_Nday %>%
mutate(score = min(.$ss) - ss)
procrustes_Nday_score %>%
write_csv('../data/163_macro_procrustes_Nday_score.csv')
# use 091 to produce the p1d...p5d macronutrients table
# use 022 to produce the p1d...p5d genus counts table
# use the snakefile to calculate the pcoa
# the below is the results from all of the patients
fns_both <- tibble(
sfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_scts_stool_relab_species_braycurtis_pcoa$', full.names = T),
dfolder = list.files('../data/finalized/paired/pNday/', pattern = 'allstool_p.d_diet_macro_dehydrated_weight_per_pt_bc_pcoa$', full.names = T)
) %>%
mutate(ID = str_replace(sfolder, '_scts_stool_relab_species_braycurtis_pcoa', ''),
ID = str_replace(ID, '../data/finalized/paired/pNday//allstool_','')) %>%
mutate(sfn = str_glue('{sfolder}/ordination.txt'),
dfn = str_glue('{dfolder}/ordination.txt'))
# sum of squares
procrustes_Nday <- map2_dfc(fns_both$dfn, fns_both$sfn, function(dfn, sfn){
dpcoa = read_tsv(dfn, skip = 9, col_names = F)  %>%
filter(! X1 %in% c('Biplot','Site constraints')) %>%
column_to_rownames('X1') %>%
as.matrix()
spcoa = read_tsv(sfn, skip = 9, col_names = F)  %>%
filter(! X1 %in% c('Biplot','Site constraints')) %>%
column_to_rownames('X1') %>%
as.matrix()
procrustes_res = procrustes(X = dpcoa, Y = spcoa)
return( procrustes_res$ss)
}) %>%
gather(key = 'pNd', value = 'ss') %>%
mutate(pNd = fns_both$ID)
# convert it to a score so that the p2d is the highest
procrustes_Nday_score <- procrustes_Nday %>%
mutate(score = min(.$ss) - ss)
procrustes_Nday_score %>%
write_csv('../data/163_macro_procrustes_Nday_score.csv')
View(procrustes_Nday_score)
procrustes_Nday_score
f2a <- procrustes_Nday_score %>%
mutate(pNd = str_extract(pNd, '\\d'),
grp = 'Macronutrients') %>%
ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
#scale_color_manual(values = c('black','gray60')) +
theme_classic()  +
theme(aspect.ratio=1,
legend.position = 'none',
axis.text=element_text(size=8),
legend.title  = element_blank(),
axis.title=element_text(size=8),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
f2a <- procrustes_Nday_score %>%
mutate(pNd = str_extract(pNd, '\\d'),
grp = 'Macronutrients') %>%
ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
scale_color_manual(values = c('black')) +
theme_classic()  +
theme(aspect.ratio=1,
legend.position = 'none',
axis.text=element_text(size=8),
legend.title  = element_blank(),
axis.title=element_text(size=8),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
library(tidyverse)
library(ggpubr)
axis_text_size <- 10
axis_title_size <- 10
f2a <- procrustes_Nday_score %>%
mutate(pNd = str_extract(pNd, '\\d'),
grp = 'Macronutrients') %>%
ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
scale_color_manual(values = c('black')) +
theme_classic()  +
theme(aspect.ratio=1,
legend.position = 'none',
axis.text=element_text(size=axis_text_size),
legend.title  = element_blank(),
axis.title=element_text(size=axis_text_size),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
knitr::opts_chunk$set(echo = TRUE)
STB <- read_csv('../data/152_combined_STB.csv')
# get the relab of the blautia and enterococcus of those
cts_genus2 <- read_csv('../data/150_b2_stool_samples_genus_counts.csv')
cts_genus1 <- read_csv('../data/cleaned_stool/022_ALL_stool_samples_genus_counts.csv')
zero_transform <- log10(0 + 2*10^-6)
genera2 <- bind_rows(cts_genus1, cts_genus2) %>%
filter(genus %in% c('Enterococcus','Blautia')) %>%
mutate(relablog = log10(relab + 2*10^-6)) %>%
select(sampleid, genus, relablog) %>%
spread('genus', 'relablog', fill = zero_transform) %>%
right_join(STB %>% select(sampleid, simpson_reciprocal, intensity)) %>%
mutate(Enterococcus = if_else(is.na(Enterococcus), zero_transform, Enterococcus),
Blautia = if_else(is.na(Blautia), zero_transform, Blautia))
STB <- read_csv('../data/152_combined_STB.csv')
# get the relab of the blautia and enterococcus of those
cts_genus2 <- read_csv('../data/150_b2_stool_samples_genus_counts.csv')
cts_genus1 <- read_csv('../data/cleaned_stool/022_ALL_stool_samples_genus_counts.csv')
zero_transform <- log10(0 + 2*10^-6)
genera2 <- bind_rows(cts_genus1, cts_genus2) %>%
filter(genus %in% c('Enterococcus','Blautia')) %>%
mutate(relablog = log10(relab + 2*10^-6)) %>%
select(sampleid, genus, relablog) %>%
spread('genus', 'relablog', fill = zero_transform) %>%
right_join(STB %>% select(sampleid, simpson_reciprocal, intensity)) %>%
mutate(Enterococcus = if_else(is.na(Enterococcus), zero_transform, Enterococcus),
Blautia = if_else(is.na(Blautia), zero_transform, Blautia))
STB <- read_csv('../data/152_combined_STB.csv')
# get the relab of the blautia and enterococcus of those
cts_genus2 <- read_csv('../data/150_b2_stool_samples_genus_counts.csv')
cts_genus1 <- read_csv('../data/cleaned_stool/022_ALL_stool_samples_genus_counts.csv')
zero_transform <- log10(0 + 2*10^-6)
genera2 <- bind_rows(cts_genus1, cts_genus2) %>%
filter(genus %in% c('Enterococcus','Blautia')) %>%
mutate(relablog = log10(relab + 2*10^-6)) %>%
select(sampleid, genus, relablog) %>%
spread('genus', 'relablog', fill = zero_transform) %>%
right_join(STB %>% select(sampleid, simpson_reciprocal, intensity)) %>%
mutate(Enterococcus = if_else(is.na(Enterococcus), zero_transform, Enterococcus),
Blautia = if_else(is.na(Blautia), zero_transform, Blautia))
# get the p2d ave of the cal and 5 macro
DTB <- read_csv('../data/152_combined_DTB.csv')
# the daily caloric intake :
all_daily_pt <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(total_daily = sum(Calories_kcal))
# the previous two days average for each stool sample
stb_pair <- STB %>%
select(mrn, sdrt) %>%
transmute(mrn = mrn,
p1d = sdrt-1,
p2d = sdrt-2)
mean_p2d_cal <-  function(mrn_, p1d_, p2d_){
df = all_daily_pt %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_cal = sum(total_daily)/2)
return(df)
}
mean_p2d_df_cal <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_cal(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
nutrients <- DTB %>%
select(mrn, fdrt, Protein_g:Sugars_g) %>%
gather('type','gram', Protein_g:Sugars_g) %>%
group_by(mrn, fdrt, type) %>%
summarise(total_daily = sum(gram)) %>%
split(.$type)
mean_p2d_fiber <-  function(mrn_, p1d_, p2d_){
df = nutrients$Fibers_g %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_fiber = sum(total_daily)/2)
return(df)
}
mean_p2d_carb <-  function(mrn_, p1d_, p2d_){
df = nutrients$Carbohydrates_g %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_carb = sum(total_daily)/2)
return(df)
}
mean_p2d_fat <-  function(mrn_, p1d_, p2d_){
df = nutrients$Fat_g %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_fat = sum(total_daily)/2)
return(df)
}
mean_p2d_Protein <-  function(mrn_, p1d_, p2d_){
df = nutrients$Protein_g %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_Protein = sum(total_daily)/2)
return(df)
}
mean_p2d_Sugars <-  function(mrn_, p1d_, p2d_){
df = nutrients$Sugars_g %>%
filter(mrn == mrn_) %>%
filter(fdrt %in% c(p1d_, p2d_  )) %>%
group_by(mrn) %>%
summarise(ave_Sugars = sum(total_daily)/2)
return(df)
}
mean_p2d_fiber <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_fiber(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
mean_p2d_fat <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_fat(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
mean_p2d_Protein <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_Protein(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
mean_p2d_Sugars <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_Sugars(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
mean_p2d_carb <- pmap(stb_pair, function(mrn, p1d, p2d){
mean_p2d_carb(mrn, p1d, p2d)
}) %>%
set_names(STB %>% pull(sampleid)) %>%
bind_rows(.id = 'sampleid')
p2d_diet <- mean_p2d_df_cal %>%
full_join(mean_p2d_fiber, by = c("sampleid", "mrn")) %>%
full_join(mean_p2d_fat, by = c("sampleid", "mrn")) %>%
full_join(mean_p2d_Protein, by = c("sampleid", "mrn")) %>%
full_join(mean_p2d_Sugars, by = c("sampleid", "mrn")) %>%
full_join(mean_p2d_carb, by = c("sampleid", "mrn"))
dtb <- read_csv('../data/152_combined_DTB.csv')
library(tidyverse)
library(ggpubr)
library(vegan)
library(vdbR)
connect_database()
dtb <- read_csv('../data/152_combined_DTB.csv')
dtb <- read_csv('../data/152_combined_DTB.csv')
# the weight need to be relative so needs to normalize them
fc_table <- dtb %>%
select(mrn, fdrt, Food_code, dehydrated_weight) %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(total = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(index_column = str_glue('P{mrn}_{fdrt}')) %>%
select(index_column, Food_code, total)
fc_total <- fc_table %>%
group_by(index_column) %>%
summarise(daily_total = sum(total))
fc_df <- fc_table %>%
left_join(fc_total) %>%
mutate(daily_relative = total/daily_total) %>%
select(index_column,Food_code, daily_relative ) %>%
spread('Food_code', 'daily_relative', fill = 0)
fc_df %>% write_csv('../data/162_food_code_relative.csv')
dtb %>% distinct(mrn)
actual_foodids <- colnames(fc_df)[2:length(colnames(fc_df))]
final.table <- read_csv('../data/source/final_table_for_writing_out_to_newick.csv') %>%
mutate(FoodID = as.character(FoodID))
food_taxa <- final.table %>%
filter(FoodID %in% actual_foodids) %>%
select(ASV = FoodID, Kingdom = L1, Phylum = L2, Class = L3, Order = L4)
actual_foodids <- colnames(fc_df)[2:length(colnames(fc_df))]
final.table <- read_csv('../data/source/final_table_for_writing_out_to_newick.csv') %>%
mutate(FoodID = as.character(FoodID))
food_taxa <- final.table %>%
filter(FoodID %in% actual_foodids) %>%
select(ASV = FoodID, Kingdom = L1, Phylum = L2, Class = L3, Order = L4)
food_taxa %>% write_csv('../data/162_food_taxa.csv')
top2level <- food_taxa %>%
distinct(Kingdom, Phylum)
dtb %>% distinct(mrn)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv')
View(OUT)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
filter(taxumap1 > 15)
OUT <- read_csv('../data/taxumap_embedding.csv')
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
filter(taxumap1 > 15)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
filter(taxumap1 > 15)  %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
fg_daily <- dtb %>%
group_by(mrn, fdrt ) %>%
summarise(daily_total = sum(dehydrated_weight))
fg_sum <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
group_by(mrn, fdrt , fgrp1) %>%
summarise(daily_fg = sum(dehydrated_weight)) %>%
left_join(fg_daily) %>%
mutate(fg_relab = daily_fg/daily_total) %>%
ungroup() %>%
left_join(key) %>%
group_by(mrn, fdrt) %>%
arrange(desc(fg_relab)) %>%
slice(1)
fg_sum <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
group_by(mrn, fdrt , fgrp1) %>%
summarise(daily_fg = sum(dehydrated_weight)) %>%
left_join(fg_daily) %>%
mutate(fg_relab = daily_fg/daily_total) %>%
ungroup() %>%
group_by(mrn, fdrt) %>%
arrange(desc(fg_relab)) %>%
slice(1)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
look <- OUT  %>%
filter(taxumap1 > 15)  %>%
inner_join(fg_sum)
View(look)
look <- OUT  %>%
filter(taxumap1 > 15)  %>%
inner_join(fg_sum) %>% inner_join(dtb %>% distinct(mrn, batch))
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
look <- OUT  %>%
filter(taxumap1 > 15)  %>%
inner_join(fg_sum) %>% inner_join(dtb %>% distinct(mrn, batch))
View(look)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
look <- OUT  %>%
filter(taxumap1 > 15)  %>%
inner_join(fg_sum) %>% inner_join(dtb %>% distinct(mrn, batch))
View(food_taxa)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
look <- OUT  %>%
filter(taxumap1 > 8)  %>%
inner_join(fg_sum) %>% inner_join(dtb %>% distinct(mrn, batch))
View(look)
# find out why the few dots are on that far island
OUT <- read_csv('../data/taxumap_embedding.csv') %>%
separate(index_column, into = c('mrn','fdrt'), sep = '_') %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')),
fdrt = as.numeric(fdrt))
look <- OUT  %>%
filter(taxumap1 > 23)  %>%
inner_join(fg_sum) %>% inner_join(dtb %>% distinct(mrn, batch))
