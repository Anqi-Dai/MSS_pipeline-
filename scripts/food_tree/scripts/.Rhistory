axis.title=element_text(size=axis_title_size),
#panel.grid.major = element_line( colour = "gray50"),
#panel.grid.minor = element_line( colour = "gray50"),
legend.position = 'top',
legend.key = element_rect( colour = "gray50"),
panel.background=element_rect(colour="black"))
genus_macro_fat_main %>% write_rds('../data/090_genus_macro_fat_main.rds')
ggsave('../figs/paper/078_heatmap_genus_36_macro_fat_ggplot.pdf', width = 10, height = 3, plot = genus_macro_fat_main)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(cowplot)
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1.2, 1),
align = 'v', axis = 'tl')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 180,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 200,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 220,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
col_key <- post_res_genera %>%
ungroup() %>%
distinct(color) %>%
pull(color)
names(col_key) <- col_key
genus_text_color <- ifelse(sort(target_genera, decreasing = F) %in% c('Blautia','Enterococcus'), 'red', 'black')
genus_macro_fat_main <- ggplot(post_res_genera, aes(x = genus, y = item)) +
geom_tile(aes(fill = color,  x = genus, y =  item), alpha = 0.5, color='white', width=0.95, height=0.95) +
geom_text(aes(label = mark, x = genus,y =  item),
nudge_y = -0.1, nudge_x = 0,size = 5) +
scale_fill_manual(values = col_key, labels = c('Less than 75% CI crosses 0', '75% CI < 0 negative','75% CI > 0 positive')) +
theme_pubr() +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_text(angle=50, hjust=1, size=11, colour = genus_text_color),
axis.text.y=element_text(size=11),
axis.title=element_text(size=axis_title_size),
#panel.grid.major = element_line( colour = "gray50"),
#panel.grid.minor = element_line( colour = "gray50"),
legend.position = 'top',
legend.key = element_rect( colour = "gray50"))
genus_macro_fat_main %>% write_rds('../data/090_genus_macro_fat_main.rds')
ggsave('../figs/paper/078_heatmap_genus_36_macro_fat_ggplot.pdf', width = 10, height = 3, plot = genus_macro_fat_main)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(cowplot)
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1.2, 1),
align = 'v', axis = 'tl')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
col_key <- post_res_genera %>%
ungroup() %>%
distinct(color) %>%
pull(color)
names(col_key) <- col_key
genus_text_color <- ifelse(sort(target_genera, decreasing = F) %in% c('Blautia','Enterococcus'), 'red', 'black')
genus_macro_fat_main <- ggplot(post_res_genera, aes(x = genus, y = item)) +
geom_tile(aes(fill = color,  x = genus, y =  item), alpha = 0.5, color='white', width=0.95, height=0.95) +
geom_text(aes(label = mark, x = genus,y =  item),
nudge_y = -0.1, nudge_x = 0,size = 5) +
scale_fill_manual(values = col_key, labels = c('Less than 75% CI crosses 0', '75% CI < 0 negative','75% CI > 0 positive')) +
theme_pubr() +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_text(angle=50, hjust=1, size=11, colour = genus_text_color),
axis.text.y=element_text(size=11),
axis.title=element_text(size=axis_title_size),
#panel.grid.major = element_line( colour = "gray50"),
#panel.grid.minor = element_line( colour = "gray50"),
legend.position = 'top',
legend.key = element_rect( colour = "gray50"),
panel.background=element_rect(colour="black"))
genus_macro_fat_main %>% write_rds('../data/090_genus_macro_fat_main.rds')
ggsave('../figs/paper/078_heatmap_genus_36_macro_fat_ggplot.pdf', width = 10, height = 3, plot = genus_macro_fat_main)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(cowplot)
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1.2, 1),
align = 'v', axis = 'tl')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1.2, 1),
align = 'v', axis = 'l')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'h', axis = 'l')
genus
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'h', axis = 'l')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'h', axis = 'tblr')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tb')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tb')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tbl')
alpha
alpha_main <- read_rds('../data/090_macronutrients_alpha_main.rds')
alpha_factor <- read_rds('../data/090_macronutrients_alpha_factor.rds')
alpha <-  plot_grid(  alpha_main,alpha_factor,
nrow = 1, labels = c('A','B'), rel_widths = c(1, 1), align = 'hv', axis = 'tblr')
alpha
genus_main <- read_rds('../data/090_genus_macro_fat_main.rds')
genus_factor <- read_rds('../data/090_genus_macro_fat_factor.rds')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'hv', axis = 'ltb')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'hv', axis = 'ltb')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'hv', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'hv', axis = 'ltb')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'v', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'hv', axis = 'lb')
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'v', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
genus
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'hv', axis = 'lb')
genus
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'h', axis = 'lb')
genus
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'v', axis = 'lb')
genus
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'v', axis = 'l')
genus
genus <-  plot_grid(  genus_main,genus_factor,
nrow = 2, labels = c('C','D'),
rel_heights  = c(1, 1),
align = 'v', axis = 'lb')
genus
macro <- plot_grid(  alpha, genus,
nrow = 2,
rel_heights  = c(1, 2),
align = 'v', axis = 'tblr')
ggsave('../figs/paper/S4_macronutrients_alpha_and_genus_093_Jan24.pdf',
width = 240,
height = 220,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
knitr::opts_chunk$set(echo = TRUE)
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
# the three datasets split to each patient
dtb <- read_csv('../data/cleaned_diet_data/FINAL_97_with_code_all_foods_drt_with_EN_finalized.csv')
stool <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')%>%
split(.$mrn)
# scale the faith pd and the day cal by dividing by 1000 and then revert this to the original scale by the axis representation
day_calori <- dtb %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))%>%
split(.$mrn)
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P',''))) %>%
split(.$mrn)
# keep the patients that have stool data
mrns <- names(meta)
# the range of the value
# use the same y axis scale
range(read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv')$faith_pd)
range(stool$simpson_reciprocal)
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
library(ggpubr)
library(tidyverse)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
scale_factor <- 50
every_pt_list <-  mrns %>%
set_names(mrns) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "Daily calories, Faith div",
limits = c(0, 2400),
sec.axis = sec_axis(~./scale_factor, name = expression(Fecal~alpha~diversity)),  limits = c(0, 2.6)) +
labs(x = 'Transplant day', y = '') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.title.y.right = element_text(color = stool_line_color),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
aspect.ratio=1)
})
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
scale_factor <- 50
every_pt_list <-  mrns %>%
set_names(mrns) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "Daily calories, Faith div",
limits = c(0, 2400),
sec.axis = sec_axis(~./scale_factor, name = expression(Fecal~alpha~diversity))) +
labs(x = 'Transplant day', y = '') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.title.y.right = element_text(color = stool_line_color),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
aspect.ratio=1)
})
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
whole_list <-  mrns %>%
set_names(mrns) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "", limits = c(0, 2400),
sec.axis = sec_axis(~./scale_factor)) +
labs(x = 'Transplant day', y = '') +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=5),
plot.title = element_text(size=axis_title_size),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
#axis.title.x = element_blank(),
axis.text.y = element_blank(),
axis.title.y.right = element_text(color = stool_line_color),
aspect.ratio=1)
})
# arrange the above into a facet-wrap
library(gridExtra)
n <- length(whole_list)
nCol <- 8
all <- do.call("grid.arrange", c(whole_list, ncol=nCol))
ggsave('../figs/paper/085_all_patients_timecourse.pdf',
width = 8,
height = 10,
plot = all)
# use one to be the example plot
example <- every_pt_list[[2]]
ggsave('../figs/paper/085_example_patient_timecourse.pdf',
width = 60,
height = 60,
units = c("mm"),
dpi = 400, device = 'pdf',
plot = example)
