item ==  'egg' ~ '3',
item ==  'legume' ~ '4',
item == 'grain' ~ '5',
item == 'fruit' ~ '6',
item == 'veggie' ~ '7',
item ==  'oils' ~ '8',
item ==  'sweets' ~ '9'
))  %>%
left_join(key) %>%
left_join(key %>% select(fgrp1, color, shortname))  %>%
mutate(shortname = fct_reorder(shortname, coeff, .fun=median, .desc = F))
fg_colors <- key %>%
select(shortname, color) %>%
deframe()
pca_fg <- post_coeff %>%
ggplot(aes(x = coeff, y = shortname, col = shortname)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = fg_colors) +
theme(axis.text=element_text(size=11),
axis.title=element_text(size=11),
aspect.ratio=1)
ggsave('../figs/paper/084_narcotics_model_fg_coeff.jpg', width = 5)
pca_fg
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure',
item == 'b_narcoticsTRUE' ~ 'narcotics exposure'
)) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
pca_bi <- coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Binary variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
axis.text=element_text(size=11),
axis.title=element_text(size=11),
aspect.ratio=1)
ggsave('../figs/paper/084_narcotics_model_binary.jpg', width = 5)
pca_bi
View(post_samples)
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept)
View(coeff_bi)
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure',
item == 'b_narcoticsTRUE' ~ 'narcotics exposure'
)) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure',
item == 'b_narcoticsTRUE' ~ 'narcotics exposure'
)) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
pca_bi <- coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Binary variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
axis.text=element_text(size=11),
axis.title=element_text(size=11),
aspect.ratio=1)
ggsave('../figs/paper/084_narcotics_model_binary.jpg', width = 5)
pca_bi
coeff_bi %>%
distinct(item_name)
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept)
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
select(starts_with('b_'))
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
select(starts_with('b_')) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure',
item == 'b_narcoticsTRUE' ~ 'narcotics exposure'
)) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
coeff_bi %>%
distinct(item_name)
pca_bi <- coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Binary variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
axis.text=element_text(size=11),
axis.title=element_text(size=11),
aspect.ratio=1)
ggsave('../figs/paper/084_narcotics_model_binary.jpg', width = 5)
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
select(starts_with('b_'))
coeff_bi <- post_samples %>%
select(!starts_with('b_fg')) %>%
select(-b_Intercept) %>%
select(starts_with('b_')) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_inten_non' ~ 'Intensity: nonablative',
item == 'b_inten_ab' ~ 'Intensity: ablative',
item ==  'b_inten_re' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure',
item == 'b_narcoticsTRUE' ~ 'narcotics exposure'
)) %>%
mutate(item_name = fct_reorder(item_name, coeff, .fun=median, .desc = F))
coeff_bi %>%
distinct(item_name)
pca_bi <- coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
labs(x = 'Regression coefficients',
y = 'Binary variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
axis.text=element_text(size=11),
axis.title=element_text(size=11),
aspect.ratio=1)
ggsave('../figs/paper/084_narcotics_model_binary.jpg', width = 5)
pca_bi
pca_bi
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tblr')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.eps',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'eps')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.jpg',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'jpg')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tblr')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 170,
height = 60,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 160,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 50,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 80,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf')
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'h',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tbl')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'l)
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'l')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'b')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 't')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'v',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 't')
pca
# combine them together to make one supplementary figure
pca <- cowplot::plot_grid(pca_fg, pca_bi,
nrow = 1,
align = 'hv',
#rel_widths =  c(1,1),
#rel_heights = c(1,1),
labels = c('A','B'),
axis = 'tb')
pca
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 150,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 50,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 90,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/084_narcotics_PCA_model_coeff_forest.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
ggsave('../figs/paper/S8_narcotics_PCA_084_Jan24.pdf',
width = 190,
height = 70,
#height = 60,
units = c("mm"),
dpi = 400, device = 'pdf', plot = pca)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
meta <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', ''))
meta
View(meta)
meta
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1)
View(cts)
View(meta)
cts <- read_tsv('../data/lefse/shotgun_taxa/merged_abundance_table_metaphlan3.txt', skip = 1) %>%
filter(str_detect(clade_name, 's__')) %>%
rename_all(~ gsub("_metaphlan3_profile", "", .)) %>%
select(-NCBI_tax_id)
View(cts)
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
cts_all <- cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
spread(key = 'clade_name', value = 'perc', fill = 0) %>%
column_to_rownames('sampleid')
meta <- diversity(cts_all, index = 'inv')
library(vegan)
library(ggpubr)
library(ggpubr)
cts %>%
gather('sampleid', 'perc', names(.)[2]:names(.)[ncol(.)]) %>%
write_csv('../data/05_all_shotgun_metaphlan_spp.csv')
meta <- diversity(cts_all, index = 'inv')
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv')
View(meta)
pheno <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', ''))
pheno
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv')
View(meta)
View(pheno)
pheno <- read_csv('../data/phenon.csv', col_names = c('sampleid','pheno')) %>%
mutate(sampleid = str_replace(sampleid, '_IGO.+$',''),
sampleid = str_glue('{sampleid}_humann3')) %>%
separate(pheno, into = c('day','grp'), sep = '_C_') %>%
mutate(grp = str_replace(grp, '_0.+$', '')) %>%
mutate(sampleid = str_replace(sampleid, '_humann3',''))
pheno
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)
View(meta)
meta
meta %>%
filter(day == 'D7')
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'jitter') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'jitter') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
meta %>%
filter(day == 'D7') %>%
ggboxplot(x = 'grp', y = 'inv', add = 'dotplot',
ylab = 'Simpson reciprocal diversity', xlab = '') +
stat_compare_means(comparisons= list(c('BM', 'BMT')),
label= "p.value",
method= 'wilcox.test',
correct=F)
ggsave('../data/05_d7_alpha.pdf', width = 6)
ggsave('../data/05_d7_alpha.pdf', height = 6)
ggsave('../data/05_d7_alpha.pdf', height = 4)
ggsave('../data/05_d7_alpha.pdf', height = 4, width = 5)
View(meta)
meta <- diversity(cts_all, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(pheno)   %>%
rename(simpson_reciprocal = inv)
?write_excel_csv
meta %>% write_excel_csv2('../data/05_meta_with_alpha.csv')
install.packages("xlsx")
library("xlsx")
library("xlsx")
library(xlsx)
