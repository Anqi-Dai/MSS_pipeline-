genus_fg_extra %>% write_rds('../data/120_F2E_extra_genera.rds')
ggsave('../data/120_F2E_extra_genera.pdf', width =  80,plot = genus_fg_extra,
height = 70,
units = c("mm"),
dpi = 400)
genus_fg_extra
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(cowplot)
axis_text_size <- 10
axis_title_size <- 10
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(cowplot)
axis_text_size <- 10
axis_title_size <- 10
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
procrustes_Nday_score <- read_csv('../data/022_procrustes_Nday_score.csv')
macro_pro <- read_csv('../data/091_macro_procrustes_Nday_score.csv')
two_score <- bind_rows(
procrustes_Nday_score %>% mutate(grp = 'Food group based'),
macro_pro %>% mutate(grp = 'Macronutrient based')
)
f2a <- two_score %>%
mutate(pNd = str_extract(pNd, '\\d')) %>%
arrange(desc(grp)) %>%
ggplot(aes(x = pNd, y = score, group = grp, color = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
scale_color_manual(values = c('black','gray60')) +
theme_classic()  +
theme(aspect.ratio=1,
#legend.position = 'none',
axis.text=element_text(size=axis_text_size),
legend.title  = element_blank(),
axis.title=element_text(size=axis_text_size),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
p <- '../figs/paper/cartoon_of_model.png'
diagram <- ggdraw() +
draw_image(magick::image_read(p),   scale = 0.9)
diagram
f2c <- read_rds('../data/068_div_post_ridge.rds')
#f2d <- read_rds('../data/068_only3_sim.rds')
#f2e <- read_rds('../data/087_entero_genus_fg_main.rds')
#f2e <- read_rds('../data/120_F2E_extra_genera.rds')
f2c
f2c
f2c
f2c
times <- read_csv('../data/Supplementary_table1_main_model_all_params_coeff_068.csv')
View(times)
knitr::opts_chunk$set(echo = TRUE, message = F)
# make
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
View(post_all)
colnames(post_all)
times <- post_all %>% select(starts_with('r_timebin'))
View(times)
times <- post_all %>% select(starts_with('r_timebin')) %>% gather
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
times
f2time <- times %>%
#left_join(percs) %>%
mutate(shortname = factor(shortname, levels = fg_order)) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
#stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
#geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
#geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = '',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time <- times %>%
#left_join(percs) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
#stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
#geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
#geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = '',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
library(tidybayes)
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
#left_join(percs) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
#stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
#geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
#geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = '',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
times
times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\)'))
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\)'),
weeks = str_replace(weeks, '^\\[', 'Day '))
View(f2time)
f2time %>%
distinct(weeks) %>%
arrange(weeks)
times <- post_all %>% select(starts_with('r_timebin'))
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
f2time %>%
distinct(weeks) %>%
arrange(weeks)
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '))
f2time %>%
distinct(weeks) %>%
arrange(weeks)
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$',''))
f2time %>%
distinct(weeks) %>%
arrange(weeks)
?reverse
?reversed
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]'))))
f2time %>%
distinct(weeks) %>%
arrange(weeks)
library(tidybayes)
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
#left_join(percs) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
#stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
#geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
#geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = '',
y = '',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
f2time
View(post_all)
colnames(post_all)
library(tidybayes)
post_all <-  read_csv('../data/068_div_model_fg_post.csv')
times <- post_all %>% select(starts_with('r_timebin')) %>% gather('weeks','coeff')
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
#left_join(percs) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
#stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
#geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
#geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
#scale_fill_manual(values = c("gray80", "skyblue")) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
colnames(post_all)
f2time
times
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc') %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%'))
f2time <- times %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
left_join(percs)
View(f2time)
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc')
View(percs)
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%'))
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%'))
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%'))
f2time <- times %>%
left_join(percs)
f2time <- times %>%
left_join(percs) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
ggplot(aes(x = coeff, y = weeks)) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = shortname, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = shortname, label = negative, color =after_stat(x > 0))) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
f2time <- times %>%
left_join(percs) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
ggplot(aes(x = coeff, y = weeks, fill = after_stat(x > 0))) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = weeks, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = weeks, label = negative, color =after_stat(x > 0))) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%')) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]'))))
f2time <- times %>%
left_join(percs) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
ggplot(aes(x = coeff, y = weeks, fill = after_stat(x > 0))) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = weeks, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = weeks, label = negative, color =after_stat(x > 0))) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
f2time <- times %>%
left_join(percs) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
ggplot(aes(x = coeff, y = weeks, fill = after_stat(x > 0))) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = weeks, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = weeks, label = negative, color =after_stat(x > 0))) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%')) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]'))))
percs <- times %>%
count(weeks, coeff > 0) %>%
mutate(perc =round(n/4000*100,1))  %>% select(-n) %>%
spread('coeff > 0', 'perc', fill = 0) %>%
rename(positive = 'TRUE', negative = 'FALSE') %>%
mutate(neg_num = negative) %>%
mutate(pos_x = 0.8, neg_x = -0.9) %>%
mutate(positive = str_glue('{positive}%'),
negative = str_glue('{negative}%')) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]'))))
f2time <- times %>%
left_join(percs) %>%
mutate(weeks = str_extract(weeks, '\\[.+\\,'),
weeks = str_replace(weeks, '^\\[', 'Day '),
weeks = str_replace(weeks, ',$','')) %>%
mutate(weeks = factor(weeks, levels = rev(c('Day [-14,-7)','Day [-7,0)', 'Day [0,7)', 'Day [7,14)', 'Day [14,21)','Day [21,28)', 'Day [28,35)', 'Day [35,42)', 'Day [42,49)', 'Day [49,56]')))) %>%
ggplot(aes(x = coeff, y = weeks, fill = after_stat(x > 0))) +
stat_pointinterval(.width = c( .95, .95), size = 0.1) +
stat_halfeye() +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
geom_text(data = percs, aes(x = pos_x, y = weeks, label = positive, color = after_stat(x > 0))) +
geom_text(data = percs, aes(x = neg_x, y = weeks, label = negative, color =after_stat(x > 0))) +
labs(x = 'Random intercepts for different weeks stool samples were collected',
y = 'Weeks relative to transplant',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none') +
scale_color_manual(values = c( "#00BFC4", "#F8766D")) +
scale_fill_manual(values = c( "#00BFC4", "#F8766D")) +
theme(axis.text=element_text(size=axis_text_size, color  = 'black'),
axis.title=element_text(size=axis_text_size),
aspect.ratio=1)
f2time
coeff_bi <- post_all %>%
select(starts_with('b_')) %>%
select(!starts_with('b_fg')) %>%
gather('item', 'coeff') %>%
mutate(item_name = case_when(
item ==  'b_intensitynonablative' ~ 'Intensity: nonablative',
item == 'b_intensityablative' ~ 'Intensity: ablative',
item ==  'b_intensityreduced' ~ 'Intensity: reduced',
item ==  'b_empiricalTRUE' ~ 'Empirical abx exposure',
item == 'b_TPNTRUE' ~ 'TPN exposure',
item ==  'b_ENTRUE' ~ 'EN exposure'
)) %>%
mutate(item_name = factor(item_name, levels = c('Intensity: nonablative', 'Intensity: reduced',
'Intensity: ablative', 'TPN exposure','EN exposure',
'Empirical abx exposure'))) %>%
mutate(grp = if_else(str_detect(item_name, 'Intensity'), 'Patient level', 'Sample level'))
# modify it to be the look that we have discussed
diversity_factor <- coeff_bi %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
facet_wrap(grp~ . , scales = 'free', dir = 'v') +
labs(x = 'Coefficients',
y = 'Factor variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
strip.background = element_blank(),
strip.text = element_blank(),
aspect.ratio=1/2)
diversity_factor %>%
write_rds('../data/068_diversity_factor_forest.rds')
coeff_bi %>%
filter(item == 'b_ENTRUE') %>%
count(coeff < 0) %>%
mutate(perc = n / sum(n)*100)
coeff_bi %>%
filter(!str_detect(item, 'intensity')) %>%
ggplot(aes(x = coeff, y = item_name)) +
stat_pointinterval(.width = c(.66, .95)) +
#scale_color_manual(values = c('#EC0000','#00468B')) +
geom_vline(xintercept = 0, col = 'black', linetype = 'dashed') +
facet_wrap(grp ~ . , scales = 'free', dir = 'v') +
labs(x = 'Coefficients',
y = 'Factor variables',
title = 'Diversity') +
theme_classic() +
theme(legend.position = 'none',
strip.background = element_blank(),
strip.text = element_blank(),
aspect.ratio=1)
ggsave('../data/068_only_abx_diversity_bi.pdf', width = 3.5, height = 3)
diversity_factor
diversity_factor
coeff_bi <- post_all %>%
select(starts_with('b_')) %>%
select(!starts_with('b_fg')) %>%
gather('item', 'coeff')
View(coeff_bi)
