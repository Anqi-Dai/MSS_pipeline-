legend.title = element_blank())
ggdotchart(top3grp, x = "description", y = "gram_per_meal",
xlab = '',
ylab = 'Per meal average consumption (gram)',
add = "segments",
group = "fg1_full_name", color = "fg1_full_name",
palette = c('#7D3C98','#db2589', '#229954'),
rotate = TRUE,
sorting = "none",
#y.text.col = TRUE ,
ggtheme = theme_pubr()
) +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title = element_blank())
top3grp <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1,1)) %>%
filter(fgrp1 %in% c('9','6','7')) %>%
group_by(Food_code, description, fgrp1) %>%
summarise(total_per_code = sum(dehydrated_weight)) %>%
group_by(fgrp1) %>%
arrange(desc(total_per_code), .by_group = T)  %>%
top_n(10) %>%
left_join(key) %>%
ungroup() %>%
mutate(gram_per_meal = total_per_code/n_meal) %>%
mutate(fg1_full_name = case_when(
fgrp1 == '6' ~ 'Fruits',
fgrp1 == '7' ~ 'Vegetables',
fgrp1 == '9' ~ 'Sugars, Sweets & Beverages'
)) %>%
mutate(fg1_full_name = factor(fg1_full_name, levels = c('Fruits','Sugars, Sweets & Beverages', 'Vegetables'))) %>%
group_by(fg1_full_name) %>%
arrange(desc(gram_per_meal), .by_group = T)
ggdotchart(top3grp, x = "description", y = "gram_per_meal",
xlab = '',
ylab = 'Per meal average consumption (gram)',
add = "segments",
group = "fg1_full_name", color = "fg1_full_name",
palette = c('#7D3C98','#db2589', '#229954'),
rotate = TRUE,
sorting = "none",
#y.text.col = TRUE ,
ggtheme = theme_pubr()
) +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title = element_blank())
top3grp <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1,1)) %>%
filter(fgrp1 %in% c('9','6','7')) %>%
group_by(Food_code, description, fgrp1) %>%
summarise(total_per_code = sum(dehydrated_weight)) %>%
group_by(fgrp1) %>%
arrange(desc(total_per_code), .by_group = T)  %>%
top_n(10) %>%
left_join(key) %>%
ungroup() %>%
mutate(gram_per_meal = total_per_code/n_meal) %>%
mutate(fg1_full_name = case_when(
fgrp1 == '6' ~ 'Fruits',
fgrp1 == '7' ~ 'Vegetables',
fgrp1 == '9' ~ 'Sugars, Sweets & Beverages'
)) %>%
mutate(fg1_full_name = factor(fg1_full_name, levels = c('Fruits','Sugars, Sweets & Beverages', 'Vegetables'))) %>%
group_by(fg1_full_name) %>%
arrange(gram_per_meal, .by_group = T)
ggdotchart(top3grp, x = "description", y = "gram_per_meal",
xlab = '',
ylab = 'Per meal average consumption (gram)',
add = "segments",
group = "fg1_full_name", color = "fg1_full_name",
palette = c('#7D3C98','#db2589', '#229954'),
rotate = TRUE,
sorting = "none",
#y.text.col = TRUE ,
ggtheme = theme_pubr()
) +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title = element_blank())
# or I just calculate the sugar in percent in those food code
top3grp_sugar <- dtb %>%
mutate(fgrp1 = str_sub(Food_code, 1,1)) %>%
filter(fgrp1 %in% c('9','6','7')) %>%
group_by(Food_code, description, fgrp1) %>%
summarise(total_sugar_per_code = sum(Sugars_g)) %>%
ungroup() %>%
mutate(gram_sugar_per_meal = total_sugar_per_code/n_meal) %>%
inner_join(top3grp) %>%
mutate(sugar_perc_per_meal = gram_sugar_per_meal/gram_per_meal*100) %>%
mutate(description = factor(description, levels = top3grp$description))
ggdotchart(top3grp_sugar, x = "description", y = "sugar_perc_per_meal",
xlab = '',
ylab = 'Per meal average consumption of sugar in percent',
add = "segments",
group = "fg1_full_name", color = "fg1_full_name",
palette = c('#7D3C98','#db2589', '#229954'),
rotate = TRUE,
sorting = "none",
#y.text.col = TRUE ,
ggtheme = theme_pubr()
) +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title = element_blank())
top3grp_sugar
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal )
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal)
View(bars)
bars %>%
ggplot( aes(x=description, y=gram, fill=grp)) +
geom_bar(stat="identity", position=position_dodge())+
geom_text(aes(label=gram), vjust=1.6, color="white",
position = position_dodge(0.9), size=3.5)+
scale_fill_brewer(palette="Paired")+
theme_minimal()
ggbarplot(bars, "description", "gram",
fill = "grp", color = "grp", palette = "Paired",
label = TRUE,
position = position_dodge(0.9))
ggbarplot(bars, "description", "gram",
fill = "grp", color = "grp", palette = "Paired",
label = TRUE,
position = position_dodge(0.9)) +
coord_flip()
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal)
ggbarplot(bars, "description", "gram",
fill = "grp", color = "grp", palette = "Paired",
position = position_dodge(0.9)) +
coord_flip()
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = factor(grp, levels = c('gram_sugar_per_meal','gram_per_meal')))
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = factor(grp, levels = c('gram_sugar_per_meal','gram_per_meal')))
ggbarplot(bars, "description", "gram",
fill = "grp", color = "grp", palette = "Paired",
position = position_dodge(0.9)) +
coord_flip()
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = factor(grp, levels = c('gram_sugar_per_meal','gram_per_meal')))
ggbarplot(bars, "description", "gram",
fill = "grp", color = "grp", palette = "Paired",
position = position_dodge(0.9)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = factor(grp, levels = c('gram_sugar_per_meal','gram_per_meal')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = "Paired",
position = position_dodge(0.9)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
RColorBrewer::brewer.pal(6, 'Paired')
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = factor(grp, levels = c('gram_sugar_per_meal','gram_per_meal')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
position = position_dodge(0.9)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
View(dtb)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
position = position_dodge(0.9)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
position = position_dodge(1.9)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
position = position_dodge(1.1)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
position = position_dodge(0.8)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.5,
position = position_dodge(0.8)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.8,
position = position_dodge(0.8)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip()
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.title= element_blank())
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 9)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = )
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# the Soft drink, cola thing
fix <- dtb %>%
filter(description == 'Soft drink, cola')
View(fix)
fix
# the Soft drink, cola thing
fix <- dtb %>%
filter(description == 'Soft drink, cola') %>%
filter(Sugars_g > dehydrated_weight)
fix <- dtb %>%
filter(description == 'Soft drink, cola')
# the Soft drink, cola thing
fix <- dtb %>%
filter(description == 'Soft drink, cola') %>%
filter(Sugars_g > dehydrated_weight)
View(fix)
fix %>%
write_csv('../data/099_soft_drink_cola.csv')
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"#E31A1C"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
# how about I plot it in bar plot and so I can have the sugar in gram per meal in the same bar to show the perc
bars <- top3grp_sugar %>%
select(description, fg1_full_name,gram_sugar_per_meal, gram_per_meal ) %>%
gather('grp','gram',gram_sugar_per_meal: gram_per_meal) %>%
mutate(grp = if_else(grp == 'gram_sugar_per_meal', 'Sugars', 'Total') ) %>%
mutate(grp = factor(grp, levels = c('Sugars','Total')))
ggbarplot(bars, "description", "gram",xlab = '',ylab = 'Per meal average consumption (gram)',
fill = "grp", color = "grp", palette = c("#FB9A99" ,"gray"),
width = 0.7,
position = position_dodge(0.8)) +
coord_flip() +
theme(legend.position = 'bottom',
axis.text.y = element_text(size=11, colour = x_txt_col),
legend.title= element_blank())
ggsave('../figs/paper/S7_top10_eaten_foods_of_3__and_sugar_099.pdf', width = 8.3, height = 7)
knitr::opts_chunk$set(echo = TRUE, message = F)
# extract posterior samples for the coeff
post_samples  <- read_csv('../data/068_div_model_fg_post.csv')
# make the forest plot of the post coeff
# like the one on the ash abstract
post_coeff <- post_samples %>%
select(starts_with('b_fg')) %>%
gather('item', 'coeff') %>%
mutate(item = str_replace(item, 'b_fg_','')) %>%
mutate(fgrp1 = case_when(
item ==  'milk' ~ '1',
item == 'meat' ~ '2',
item ==  'egg' ~ '3',
item ==  'legume' ~ '4',
item == 'grain' ~ '5',
item == 'fruit' ~ '6',
item == 'veggie' ~ '7',
item ==  'oils' ~ '8',
item ==  'sweets' ~ '9'
))  %>%
left_join(key %>% select(fgrp1, color, shortname))  %>%
mutate(shortname = fct_reorder(shortname, coeff, .fun=median, .desc = F))
library(tidyverse)
library(brms)
library(ggpubr)
library(tidybayes)
library(cowplot)
dtb <- read_csv('../data/cleaned_diet_data/FINAL_97_with_code_all_foods_drt_with_EN_finalized.csv')
theme_set(theme_tidybayes() + panel_border())
ncores <- parallel::detectCores()
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
axis_text_size <- 10
axis_title_size <- 10
dtb %>%
distinct(mrn) %>%
write_csv('../data/nutrition_patients_97_mrns.csv', col_names = T)
# make the forest plot of the post coeff
# like the one on the ash abstract
post_coeff <- post_samples %>%
select(starts_with('b_fg')) %>%
gather('item', 'coeff') %>%
mutate(item = str_replace(item, 'b_fg_','')) %>%
mutate(fgrp1 = case_when(
item ==  'milk' ~ '1',
item == 'meat' ~ '2',
item ==  'egg' ~ '3',
item ==  'legume' ~ '4',
item == 'grain' ~ '5',
item == 'fruit' ~ '6',
item == 'veggie' ~ '7',
item ==  'oils' ~ '8',
item ==  'sweets' ~ '9'
))  %>%
left_join(key %>% select(fgrp1, color, shortname))  %>%
mutate(shortname = fct_reorder(shortname, coeff, .fun=median, .desc = F))
fg_labels <- levels(post_coeff$shortname)
cross0 <- post_coeff %>%
group_by(item) %>%
summarise(q2.5 = quantile(coeff, probs = 0.025),
q97.5 = quantile(coeff, probs = 0.975)) %>%
mutate(Cross = if_else(q2.5 > 0 | q97.5 < 0, F, T))
# to find the quantiles of the post_coeff
post_coeff %>%
group_by(item) %>%
tidybayes::median_qi(coeff, .width = c( .66, .95))
post_coeff %>%
group_by(item) %>%
summarise(q50 = median(coeff))
View(post_coeff)
post_coeff %>%
group_by(item) %>%
summarise(q50 = median(coeff))
post_coeff %>%
filter(item == 'fruit')
post_coeff %>%
filter(item == 'fruit') %>%
count(coeff < 0)
post_coeff %>%
filter(item == 'fruit') %>%
count(coeff < 0) %>%
mutate(perc = n/sum(n)*100)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')
# the current 92 mrns being use
fam <- read_csv('../data/cleaned_stool/ALL_stool_samples_family_counts.csv') %>%
filter(sampleid %in% meta$sampleid) %>%
mutate(family = str_extract(taxa_family, 'f__.+$')) %>%
mutate(family = str_replace(family, 'f__',''))
# find the two families relab for every stool sample
fam2 <- fam %>%
filter(family %in% c('Enterococcaceae','Enterobacteriaceae')) %>%
select(sampleid, family, relab) %>%
spread('family','relab')
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')  %>%
full_join(fam2)
# the patients that have the domination samples occur
target_fam <- c('Enterococcaceae','Enterobacteriaceae')
target_fam %>%
map(function(var){
mrns <- fam %>%
filter(family == var) %>%
filter(relab > 0.1) %>%
left_join(meta %>% select(mrn, sampleid, sdrt)) %>%
distinct(mrn) %>%
pull(mrn)
# visualize all the samples for these patients
mrn_samp <- meta %>%
filter(mrn %in% mrns)
mrn_samp %>%
ggdotchart(x = 'sdrt', y = var,  facet.by = 'mrn',  add = "segments",
sorting = 'none', font.label = list(size = 5, face = "plain"),
title = str_glue('{var}')) +
theme(axis.text.x = element_text(size=5, angle=90, hjust=1)) +
geom_hline(yintercept = 0.1, linetype = 'dashed', color = 'red') +
ggsave(str_glue('../figs/family_2_dom_{var}.jpg'), width = 15, height = 7)
})
