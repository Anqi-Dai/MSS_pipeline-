# summarize at the foodcode level what is per for the outliers
howmuchoutlier <- whichoutlier %>%
count(Food_code, ifoutlier) %>%
add_count(Food_code, wt = n, name = 'totalperfc') %>%
mutate(perc = round(n/totalperfc*100, 2)) %>%
filter(ifoutlier == 'TRUE')
View(howmuchoutlier)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn) %>%
summarise(perdayfc = sum(dehydrated_weight))
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~Food_code ) +
theme(text = element_text(size = 6))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn) %>%
summarise(perdayfc = sum(dehydrated_weight))
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~Food_code , scales = 'free_y') +
theme(text = element_text(size = 6))
ggsave('../data/166_perday_fc.pdf', width = 40, height = 60, limitsize = FALSE)
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~Food_code , scales = 'free_y') +
theme(text = element_text(size = 6))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
View(perdaycode)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 14))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 14))
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~description , scales = 'free_y') +
theme(text = element_text(size = 6))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 14))
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~description , scales = 'free_y') +
theme(text = element_text(size = 6))
ggsave('../data/166_perday_fc.pdf', width = 40, height = 40, limitsize = FALSE)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(Food_code = factor(Food_code))
summary(perdaycode$Food_code)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = fct_reorder(description, .fun = Food_code))
des_order <- DTB %>%
distinct(Food_code, description) %>%
arrange(Food_code)
View(des_order)
des_order <- DTB %>%
distinct(Food_code, description) %>%
mutate(description = str_sub(description, 1, 30))  %>%
arrange(Food_code) %>%
pull(description)
?factor
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
mutate(description = str_sub(description, 1, 30))  %>%
arrange(Food_code) %>%
pull(description)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = factor(description, levels = des_order))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
mutate(description = str_sub(description, 1, 40))  %>%
arrange(Food_code) %>%
pull(description)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 40)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
mutate(description = str_sub(description, 1, 45))  %>%
arrange(Food_code) %>%
pull(description)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 45)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
mutate(description = str_sub(description, 1, 60))  %>%
arrange(Food_code) %>%
pull(description)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 60)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
#mutate(description = str_sub(description, 1, 60))  %>%
arrange(Food_code) %>%
pull(description)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
#mutate(description = str_sub(description, 1, 60)) %>%
mutate(description = factor(description, levels = des_order))
des_order <- DTB %>%
distinct(Food_code, description) %>%
#mutate(description = str_sub(description, 1, 60))  %>%
arrange(Food_code)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30))
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30))
perdaycode %>%
gghistogram(x = 'perdayfc', fill = 'red') +
facet_wrap(~description , scales = 'free_y') +
theme(text = element_text(size = 6))
ggsave('../data/166_perday_fc.pdf', width = 40, height = 40, limitsize = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
DTB <- read_csv('../data/152_combined_DTB.csv')
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn) %>%
summarise(perdayfc = sum(dehydrated_weight))
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code) %>%
summarise(maxfc = max(perdayfc))
View(maxeachfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
summarise(maxfc = max(perdayfc))
perdaycode_wo_0
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
View(perdaycode_wo_0)
perdaycode <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight)) %>%
ungroup() %>%
mutate(description = str_sub(description, 1, 30))
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
summarise(maxfc = max(perdayfc))
perdaycode_wo_0
View(DTB)
perdaycode_wo_0
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
maxeachfc <- perdaycode_wo_0 %>%
group_by(Food_code, description) %>%
count
maxeachfc <- perdaycode_wo_0 %>%
#group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
maxeachfc <- perdaycode_wo_0 %>%
#group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc) %>%
ungroup()
perdaycode_wo_0
perdaycode_wo_0
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc)
perdaycode_wo_0 %>%  ungroup()
?slice_max
perdaycode_wo_0 %>%  ungroup()
View(perdaycode_wo_0)
perdaycode_wo_0 %>%  ungroup()
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc )
View(maxeachfc)
another <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
summarise(max_ = max(perdayfc))
View(another)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename()
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F)
maxeachfc
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
meta
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta )
summary(mod_fg9)
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch1'))
summary(mod_fg9)
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
meta <- read_csv('../data/153_combined_META.csv')
library(lmerTest)
mod_fg9 <-  lmer(log(simpson_reciprocal) ~
fg_fruit+
fg_meat+
fg_milk+
fg_oils+
fg_egg+
fg_grain+
fg_sweets+
fg_legume+
fg_veggie+
# ave_cal +
empirical +
intensity +
TPN +
EN +
(1 | mrn) +
(1 | timebin), REML = F, data = meta %>% filter(batch == 'batch2'))
summary(mod_fg9)
knitr::opts_chunk$set(echo = TRUE)
DTB <- read_csv('../data/152_combined_DTB.csv')
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
# to look at the outlier that is defined as Q3 + 1.5 IQR
perdaycode_wo_0 <- DTB %>%
group_by(Food_code, fdrt, mrn, description) %>%
summarise(perdayfc = sum(dehydrated_weight))
outliers_wo_0 <- perdaycode_wo_0 %>%
group_by(Food_code) %>%
summarise(Q3 = quantile(perdayfc, probs = 0.75),
IQR = IQR(perdayfc)) %>%
mutate(outlierval = Q3 + 1.5*IQR )
whichoutlier <- perdaycode_wo_0 %>%
left_join(outliers_wo_0 %>% select(Food_code, outlierval), by = "Food_code") %>%
mutate(ifoutlier = if_else(perdayfc > outlierval, T, F)) %>%
ungroup()
# summarize at the foodcode level what is per for the outliers
howmuchoutlier <- whichoutlier %>%
count(Food_code, ifoutlier) %>%
add_count(Food_code, wt = n, name = 'totalperfc') %>%
mutate(perc = round(n/totalperfc*100, 2)) %>%
filter(ifoutlier == 'TRUE')
# to look at the first 10 foodcode with 25% outliers
top10 <- howmuchoutlier %>%
arrange(desc(perc)) %>%
slice_max(order_by = perc, n = 10) %>%
pull(Food_code)
# what are the per day records of the outlier days
whateat <- whichoutlier %>%
filter(Food_code %in% top10) %>%
left_join(DTB %>% distinct(Food_code, description)) %>%
arrange(desc(ifoutlier))
# this patient had a lot of things on day -3
ptb <- read_csv('../data/156_transplant_data.csv')
pt_ <- whateat %>%
slice(1) %>% pull(mrn)
whatmrn <- DTB %>%
filter(mrn == pt_ & fdrt == -3)
# so the patient had 2 fruit scone that day one for lunch and one for dinner
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
maxeachfc
# and the max of this maxfc
max_max <- maxeachfc %>%
slice_max(n = 1, order_by = maxfc)
maxeachfc <- perdaycode_wo_0 %>%  ungroup() %>%
group_by(Food_code, description) %>%
slice_max(n = 1, order_by = perdayfc , with_ties = F) %>%
rename(dailytotal = perdayfc) %>%
arrange(desc(dailytotal))
maxeachfc
View(perdaycode_wo_0)
View(DTB)
