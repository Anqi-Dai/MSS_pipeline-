)
all <- plot_grid(plotlist =   whole_list[1:60],
ncol = 3)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# to put those to two pages, and each page is A4 size
title <- ggdraw() +
draw_label(
"Fig. S2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[1:60],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
whole_list <-  pids %>%
set_names(pids) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "", limits = c(0, 4600),
sec.axis = sec_axis(~./scale_factor)) +
labs(x = 'Transplant day', y = '', title = str_glue('{.x}')) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=5),
plot.title = element_text(size=axis_text_size),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
axis.title.x = element_blank(),
axis.text.y = element_blank(),
axis.title.y.right = element_text(color = stool_line_color),
aspect.ratio=1/2)
})
# arrange the above into a facet-wrap
# to put those to two pages, and each page is A4 size
title <- ggdraw() +
draw_label(
"Fig. S2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[1:60],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
axis_text_size
axis_text_size
axis_text_size
axis_text_size
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
whole_list <-  pids %>%
set_names(pids) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "", limits = c(0, 4600),
sec.axis = sec_axis(~./scale_factor)) +
labs(x = 'Transplant day', y = '', title = str_glue('{.x}')) +
theme(axis.text=element_text(size=7),
axis.title=element_text(size=5),
plot.title = element_text(size=axis_text_size),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
axis.title.x = element_blank(),
axis.text.y = element_blank(),
axis.title.y.right = element_text(color = stool_line_color),
aspect.ratio=1/2)
})
# arrange the above into a facet-wrap
# to put those to two pages, and each page is A4 size
title <- ggdraw() +
draw_label(
"Fig. S2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[1:60],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# to put those to two pages, and each page is A4 size
title <- ggdraw() +
draw_label(
"Fig. S2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[1:40],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# to put the stool data in the same dimension as the diet data use a scaling factor to bring them to same level when plotting the y but then show on the  y axis scale that they are different
whole_list <-  pids %>%
set_names(pids) %>%
map(function(.x) {
ggplot()  +
geom_line(data = day_calori[[.x]], aes(x = fdrt, y = daycal), linetype = 'solid', size = pt_line_size, col = diet_line_color) +
# the diet faith
geom_line(data = faith[[.x]], aes(x = fdrt, y = faith_pd), linetype = 'solid', size = pt_line_size, col = faith_line_color) +
# the stool data
geom_line(data = meta[[.x]], aes(x = sdrt, y = simpson_reciprocal*scale_factor), linetype = 'solid', size = pt_line_size, col = stool_line_color) +
theme_pubr() +
scale_y_continuous(name = "", limits = c(0, 4600),
sec.axis = sec_axis(~./scale_factor)) +
labs(x = 'Transplant day', y = '', title = str_glue('{.x}')) +
theme(axis.text=element_text(size=7),
axis.title=element_text(size=5),
plot.title = element_text(size=8),
axis.title.y = element_text(color = diet_line_color),
axis.line = element_line(colour = 'black', size = axis_line_thickness),
axis.ticks = element_line(colour = "black", size = axis_line_thickness),
axis.title.x = element_blank(),
axis.text.y = element_blank(),
axis.title.y.right = element_text(color = stool_line_color),
aspect.ratio=1/2)
})
# arrange the above into a facet-wrap
# to put those to two pages, and each page is A4 size
title <- ggdraw() +
draw_label(
"Fig. S2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[1:40],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,2,1), "cm"))
ggsave('../data/085_all_patients_timecourse.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 2:
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[41:80],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,2,1), "cm"))
ggsave('../data/085_all_patients_timecourse_2.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 3
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
# page 3
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[81:120],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,2,1), "cm"))
ggsave('../data/085_all_patients_timecourse_3.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[121:158],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,2,1), "cm"))
ggsave('../data/085_all_patients_timecourse_4.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[121:158],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,6,1), "cm"))
ggsave('../data/085_all_patients_timecourse_4.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[121:158],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,4,1), "cm"))
ggsave('../data/085_all_patients_timecourse_4.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
# page 4
title <- ggdraw() +
draw_label(
"Fig. S2 (Continued)",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
all <- plot_grid(plotlist =   whole_list[121:158],
ncol = 5)
combined <- plot_grid(
title, all,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,4.5,1), "cm"))
ggsave('../data/085_all_patients_timecourse_4.pdf',
width = 210,
height = 297,
units = c("mm"),
dpi = 300, plot = combined)
library(ggpubr)
library(tidyverse)
library(cowplot)
pt_line_size <- 0.2
alpha_val <- 1
point_size <- 0.5
diet_line_color <- '#E41A1C'
axis_text_size <- 5
axis_title_size <- 8
stool_line_color <- 'blue'
faith_line_color <- 'black'
axis_line_thickness <- 0.2
# the three datasets split to each patient
dtb <- read_csv('../data/152_combined_DTB.csv')
View(dtb)
#library(biostatR);
library(tidyverse)
library(tidycmprsk)
library(survival)
library(gtsummary)
library(ggsurvfit)
library(gtExtras)
# theme_set(mskRvis::theme_biostat()); mskRvis::set_msk_palette()
# theme_gtsummary_compact()
few <- read_csv('../data/156_extra_predictors.csv')
df_main <- read_csv('../data/df_main.csv') %>%
mutate(Source = source,
Intensity = factor(Intensity, levels=c("Nonablative","Reduced Intensity",'Ablative')),
Source = factor(Source,levels=c("unmodified","TCD","cord")) ) %>%
full_join(few ) %>%
mutate(TRMevent = factor(TRMevent),
GRMevent = factor(GRMevent)) %>%
# to divde the cal by 1000 for easier interpretation, and the other food related vars by 100
mutate(d_carb = d_carb/100,
d_fat = d_fat/100,
d_fiber = d_fiber/100,
d_protein = d_protein/100,
d_sugar = d_sugar/100,
daycal = daycal/1000,
daily_Eggs = daily_Eggs/100,
daily_Fruits = daily_Fruits/100,
daily_Grains = daily_Grains/100,
daily_Legumes = daily_Legumes/100,
daily_Meats = daily_Meats/100,
daily_Oils = daily_Oils/100,
daily_Sweets = daily_Sweets/100,
daily_Vegetables = daily_Vegetables/100,
daily_Milk = daily_Milk/100) %>%
mutate(d_carb_med = ifelse(d_carb > median(d_carb,na.rm=T),"Above median", "Below median"),
d_fat_med = ifelse(d_fat > median(d_fat,na.rm=T),"Above median", "Below median"),
d_fiber_med = ifelse(d_fiber > median(d_fiber,na.rm=T),"Above median", "Below median"),
d_protein_med = ifelse(d_protein > median(d_protein,na.rm=T),"Above median", "Below median"),
d_sugar_med = ifelse(d_sugar > median(d_sugar,na.rm=T),"Above median", "Below median"),
daycal_med = ifelse(daycal > median(daycal,na.rm=T),"Above median", "Below median"),
daily_Eggs_med = ifelse(daily_Eggs > median(daily_Eggs,na.rm=T),"Above median", "Below median"),
daily_Fruits_med = ifelse(daily_Fruits > median(daily_Fruits,na.rm=T),"Above median", "Below median"),
daily_Grains_med = ifelse(daily_Grains > median(daily_Grains,na.rm=T),"Above median", "Below median"),
daily_Legumes_med = ifelse(daily_Legumes > median(daily_Legumes,na.rm=T),"Above median", "Below median"),
daily_Meats_med = ifelse(daily_Meats > median(daily_Meats,na.rm=T),"Above median", "Below median"),
daily_Oils_med = ifelse(daily_Oils > median(daily_Oils,na.rm=T),"Above median", "Below median"),
daily_Sweets_med = ifelse(daily_Sweets > median(daily_Sweets,na.rm=T),"Above median", "Below median"),
daily_Vegetables_med = ifelse(daily_Vegetables > median(daily_Vegetables,na.rm=T),"Above median", "Below median"),
daily_Milk_med = ifelse(daily_Milk > median(daily_Milk,na.rm=T),"Above median", "Below median")
) %>%
# !!!!! remove the TCD patients for now
filter(source != 'TCD')
# the diversity close to the engraftment for the patients
# average food diversity between the period
colnames(df_main)
df_main %>% select(-mrn) %>%  summary
featlist <- c("d_carb_med",
"d_fat_med",
"d_fiber_med",
"d_protein_med",
"d_sugar_med",
"daycal_med",
"daily_Eggs_med",
"daily_Fruits_med",
"daily_Milk_med",
"daily_Grains_med",
"daily_Legumes_med",
"daily_Meats_med",
"daily_Oils_med",
"daily_Sweets_med",
"daily_Vegetables_med")
df_main %>% count(TRMevent, OSevent)  %>%
mutate(status = if_else(OSevent ==1, 'dead', 'alive')) %>%
select(-OSevent)
View(df_main)
colnames(df_main)
tt <- df_main %>%
select(d100_a_gvhd:d100_upper_gi_stage)
View(tt)
tt <- df_main %>%
select(d100_a_gvhd:d100_upper_gi_stage)
View(tt)
colnames(df_main)
