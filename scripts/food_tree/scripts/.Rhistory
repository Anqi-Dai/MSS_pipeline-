design_description='PCR amplification of 16S V4-V5 regions; Bead-beating, phenol chloroform DNA extraction',
filetype= 'fastq',
filename=hfiles$R1,
filename2=hfiles$R2
)
View(sra_h)
sra_h %>%
write_tsv('../data/hana/h_sra.tsv')
View(total)
View(joao)
length(intersect(h$sampleid, total$BioSample.name))
View(cleaned_sra)
View(biopro)
cleaned_sra
length(intersect(h$sampleid, total$BioSample.name))
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
filter(sampleid %in% h$sampleid)
View(h_already)
View(sra)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
filter(sampleid %in% h$sampleid)
sra
setdiff(h$sampleid, cleaned_sra$sampleid)
View(h_already)
# the samples we have the srr accession already
h_already <- sra %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra)
sra
# the samples we have the srr accession already
h_already <- sra %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra)
View(h_already)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T)
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T)
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra)
View(h_already)
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra)
sra
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra %>%
distinct(SRA.filename, .keep_all = T))
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra %>%
distinct(SRA.filename, .keep_all = T))
h_already
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra %>%
distinct(SRA.filename, .keep_all = T)) %>%
select(sampleid, Accession)
# the samples we have the srr accession already
h_already <- cleaned_sra %>%
distinct(sampleid, .keep_all = T) %>%
filter(sampleid %in% h$sampleid) %>%
inner_join(sra %>%
distinct(SRA.filename, .keep_all = T)) %>%
select(sampleid, Accession)
h_already %>%
write_csv('../data/hana/acc1_568.csv')
setdiff(h$sampleid, cleaned_sra$sampleid)
setdiff(h$sampleid, cleaned_sra$sampleid)
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid))
711-568
setdiff(h$sampleid, cleaned_sra$sampleid)
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid))
View(fastq2)
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T)
length(setdiff(h$sampleid, cleaned_sra$sampleid))
length(setdiff(h$sampleid, cleaned_sra$sampleid))
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T)
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T)
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T)
View(fastq2)
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T) %>%
mutate(R1 = str_glue('{oligos_id}_R1.fastq.gz'),
R2 = str_glue('{oligos_id}_R2.fastq.gz')) %>%
mutate(p1 = str_glue('{path_pool}/{R1}'),
p2 = str_glue('{path_pool}/{R2}'))
fastq2 %>%
select(p1, p2) %>%
gather() %>%
mutate(cmd = str_glue('scp daia1@lilac.mskcc.org:{value} .')) %>%
select(cmd) %>%
write_csv('../data/dl_h157.sh', col_names = F)
# the path of the files
fastq2 <- asv_alpha_diversity_ag %>%
filter(sampleid %in% setdiff(h$sampleid, cleaned_sra$sampleid)) %>%
distinct(sampleid, .keep_all = T) %>%
mutate(R1 = str_glue('{oligos_id}_R1.fastq.gz'),
R2 = str_glue('{oligos_id}_R2.fastq.gz')) %>%
mutate(p1 = str_glue('{path_pool}/{R1}'),
p2 = str_glue('{path_pool}/{R2}'))
fastq2 %>%
select(p1, p2) %>%
gather() %>%
mutate(cmd = str_glue('scp daia1@lilac.mskcc.org:{value} .')) %>%
select(cmd) %>%
write_csv('../data/dl_h157.sh', col_names = F)
View(fastq2)
# the biosample acc of these samples
h2 <- total %>%
filter(BioSample.name %in% fastq2$sampleid)
View(h2)
711-568
725-14-568
View(h2)
143+14
# the ones that we need to upload the corrct dada2 results fastqs
length(setdiff(h$sampleid, cleaned_sra$sampleid))
# Hana: total 725.  new biosample+sra : 14  alrady:568
# the biosample acc of these samples (143)
h2 <- total %>%
filter(BioSample.name %in% fastq2$sampleid)  %>%
distinct(BioSample.name, .keep_all = T)
# Hana: total 725.  new biosample+sra : 14  alrady:568
# the biosample acc of these samples (143)
h2 <- total %>%
filter(BioSample.name %in% fastq2$sampleid)  %>%
distinct(BioSample.name, .keep_all = T) %>%
rename(sampleid = BioSample.name) %>%
inner_join(fastq2)
View(h2)
sra_h2 <- tibble(
BioSample_accession = h2$Accession,
library_ID = h2$sampleid,
title = 'Stool sample of allo-HCT patient',
library_strategy = 'amplicon',
library_source = 'GENOMIC',
library_selection = 'PCR',
library_layout ='paired',
platform= 'ILLUMINA',
instrument_model= 'Illumina MiSeq',
design_description='PCR amplification of 16S V4-V5 regions; Bead-beating, phenol chloroform DNA extraction',
filetype= 'fastq',
filename=h2$R1,
filename2=h2$R2
)
View(sra_h2)
sra_h2 %>%
write_tsv('../data/hana/sra_143.tsv')
sra_h2 <- tibble(
biosample_accession = h2$Accession,
library_ID = h2$sampleid,
title = 'Stool sample of allo-HCT patient',
library_strategy = 'amplicon',
library_source = 'GENOMIC',
library_selection = 'PCR',
library_layout ='paired',
platform= 'ILLUMINA',
instrument_model= 'Illumina MiSeq',
design_description='PCR amplification of 16S V4-V5 regions; Bead-beating, phenol chloroform DNA extraction',
filetype= 'fastq',
filename=h2$R1,
filename2=h2$R2
)
sra_h2 %>%
write_tsv('../data/hana/sra_143.tsv')
View(h14)
# marina shotgun samples
ms <- read_csv('../data/marina/Doris_7_30_21_FINAL_unique_sampleids_SHOTGUN.csv')
View(ms)
View(marina)
View(shotgun_already)
# the files that I downloaded from lilac
fns <- list.files('../data/hana/fastqs/', full.names = T)
# the files that I downloaded from lilac
fns <- list.files('../data/hana/fastqs/')
# the files that I downloaded from lilac
fns <- tibble(fn = list.files('../data/hana/fastqs/'))
View(fns)
# the files that I downloaded from lilac
fns <- tibble(fn = list.files('../data/hana/fastqs/')) %>%
separate(fn , into = c('sampleid','pair'), sep = '_R')
View(fns)
fns
# the files that I downloaded from lilac
fns <- tibble(fn = list.files('../data/hana/fastqs/')) %>%
separate(fn , into = c('sampleid','pair'), sep = '_R') %>%
spread('pair', 'sampleid')
fns
# the files that I downloaded from lilac
fns <- tibble(fn = list.files('../data/hana/fastqs/')) %>%
separate(fn , into = c('sampleid','pair'), sep = '_R') %>%
spread('sampleid', 'pair')
fns %>%
count(sampleid)
fns %>%
count(sampleid, sort = F)
fns %>%
count(sampleid) %>%
arrange(n)
fns %>%
count(sampleid) %>%
arrange(n) %>%
filter(n == 1)
missing <- fns %>%
count(sampleid) %>%
arrange(n) %>%
filter(n == 1)
fns
fns %>%
filter(sampleid %in% missing$sampleid)
View(fastq2)
fastq2
fastq2
fns
missing
fns
fns %>%
filter(sampleid %in% missing$sampleid)
fastq2
re_dl <- fastq2 %>%
filter(sampleid %in% missing$sampleid)
re_dl
missing$sampleid
fastq2
re_dl <- fastq2 %>%
filter(oligos_id %in% missing$sampleid)
View(re_dl)
re_dl <- fastq2 %>%
filter(oligos_id %in% missing$sampleid) %>%
select(p2)
fns %>%
filter(sampleid %in% missing$sampleid)
fastq2 %>%
filter(oligos_id %in% missing$sampleid) %>%
select(p2)%>%
mutate(cmd = str_glue('scp daia1@lilac.mskcc.org:{p2} .')) %>%
select(cmd) %>%
write_csv('../data/dl_h5_2.sh', col_names = F)
View(h14)
vdb_users <- c("peledj",
"burgosdm",
"docampom",
"slingerj",
"nguyenc1",
"daia1",
"markeyk",
"armijog",
"miltiado",
"andrlovh",
"lindners",
"breretod",
"giardinp",
"khann2",
"zuanellc",
"hatfielp",
"clurmana",
"smithm4",
"adintorp",
"ngb",
"chens8",
"elkriefa",
"mab4025",
"harfordl",
"jesusfar",
"crossj",
'funnellt',
"watersn",
"maclachlan",
"feit1",
"MarcellL",
"rajs")
users <- tibble(user = vdb_users)
View(users)
users <- tibble(user = vdb_users) %>%
mutate(email = str_glue('{user}@mskcc.org'))
paste(users$email, sep = ' ')
paste0(users$email, sep = ' ')
users
users <- tibble(user = vdb_users) %>%
mutate(email = str_glue('{user}@mskcc.org')) %>%
summarize(text = str_c(email, collapse = ", "))
users
users$text
View(fastq2)
fastq2 %>%
filter(sampleid == '2057G')
fastq2 %>%
filter(sampleid == '2057G') %>%
pull(p2)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx')
View(rob)
rob
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA|attempted')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' | Directory.16S != 'attempted')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted')
View(asv_alpha_diversity_ag)
# are all these samples in the biosamples
length(intersect(rob$Sample.ID, total$BioSample.name))
nrow(rob)
# some don't have biosamples yet
add_bios <- setdiff(rob$Sample.ID, total$BioSample.name)
# some don't have biosamples yet
add_bios <- setdiff(rob$Sample.ID, total$BioSample.name)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
nrow(rob)
# are all these samples in the biosamples
length(intersect(rob$Sample.ID, total$BioSample.name))
add_bios
# how many files can I find
fs <- rob %>%
inner_join(asv_alpha_diversity_ag)
# how many files can I find
fs <- rob %>%
rename(sampleid = Sample.ID) %>%
inner_join(asv_alpha_diversity_ag)
View(fs)
rob
# how many files can I find
fs <- rob %>%
rename(sampleid = Sample.ID) %>%
inner_join(asv_alpha_diversity_ag)
View(fs)
# the 4 that can't find the sequencing data
missing <- rob %>%
rename(sampleid = Sample.ID) %>%
filter(!sampleid %in% asv_alpha_diversity_ag$sampleid)
View(missing)
missing
View(fs)
View(cleaned_sra)
cleaned_sra
# are all the other fastqs fine
need <- cleaned_sra %>%
inner_join(fs)
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx')
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted')
# 172
rob <- readxl::read_excel('../data/rob/jenq_454_lookup.xlsx') %>%
filter(Directory.16S != 'NA' & Directory.16S != 'attempted') %>%
distinct(Sample.ID, .keep_all = T)
# are all the other fastqs fine
already <- cleaned_sra %>%
inner_join(fs)
fs
fs
fs
# are all the other fastqs fine
need <- fs %>%
filter(!sampleid %in% cleaned_sra$sampleid)
View(need)
View(sra)
add_bios
# are all these samples in the biosamples
length(intersect(rob$Sample.ID, total$BioSample.name))
# the 161 already has cleaned sra
already_rob <- cleaned_sra %>%
inner_join(fs)
View(already_rob)
# the 161 already has cleaned sra
already_rob <- cleaned_sra %>%
inner_join(fs) %>%
inner_join(sra)
View(already_rob)
already_rob %>%
select(Accession, sampleid)
already_rob %>%
select(Accession, sampleid) %>%
write_csv('../data/rob/already_161.csv')
# the 14 that I uploaded earlier
# now the sra accession returned by ncbi
h14 <- read_tsv('../data/hana/hana_14_ncbi.tsv')
View(h14)
# the 14 that I uploaded earlier
# now the sra accession returned by ncbi
h14 <- read_tsv('../data/hana/hana_14_ncbi.tsv') %>%
select(accession, sampleid = sample_name)
h14
# the 14 that I uploaded earlier
# now the sra accession returned by ncbi
h14 <- read_tsv('../data/hana/hana_14_ncbi.tsv') %>%
select( sampleid = sample_name, Accession = accession)
h14
h14 %>% write_csv('../data/hana/acc2_14.csv')
length(intersect(marina$sampleid, cleaned_sra$sampleid))
find <- setdiff(marina$sampleid, cleaned_sra$sampleid)
length(intersect(marina$sampleid, cleaned_sra$sampleid))
find <- setdiff(marina$sampleid, cleaned_sra$sampleid)
marina <- read_csv('../data/marina/Doris_7_30_21_FINAL_unique_sampleids_16S.csv')
find <- setdiff(marina$sampleid, cleaned_sra$sampleid)
length(intersect(marina$sampleid, cleaned_sra$sampleid))
# for marina 16s
already_m <- cleaned_sra %>%
inner_join(marina)
View(already_m)
# to make a table with the sampleid and accession
# for marina 16s
already_m <- cleaned_sra %>%
inner_join(marina) %>%
distinct(sampleid, .keep_all = T)
# to make a table with the sampleid and accession
# for marina 16s
already_m <- cleaned_sra %>%
inner_join(marina) %>%
distinct(sampleid, .keep_all = T) %>%
inner_join(sra)
# to make a table with the sampleid and accession
# for marina 16s
already_m <- cleaned_sra %>%
inner_join(marina) %>%
distinct(sampleid, .keep_all = T) %>%
inner_join(sra) %>%
distinct(sampleid, .keep_all = T)
View(already_m)
already_m %>%
select(Accession, sampleid)
already_m %>%
select(Accession, sampleid) %>%
write_csv('../data/marina/already_1296.csv')
# the newly submitted 7
new7 <- read_tsv('../data/marina/metadata-11133079-sra-7.tsv')
View(new7)
new7
# the newly submitted 7
new7 <- read_tsv('../data/marina/metadata-11133079-sra-7.tsv') %>%
select(Accession = accession, sampleid = library_ID)
new7
already_m
# to make a table with the sampleid and accession
# for marina 16s
already_m <- cleaned_sra %>%
inner_join(marina) %>%
distinct(sampleid, .keep_all = T) %>%
inner_join(sra) %>%
distinct(sampleid, .keep_all = T) %>%
select(Accession, sampleid)
all_16s <- bind_rows(
new7, already_m
)
View(all_16s)
all_16s %>%
write_csv('../data/marina/all_16s_sra_acc_1303.csv')
# tables from these
dir.create('../data/save')
sra %>%
write_csv('../data/save/all_sra_table_20220226.csv')
cleaned_sra %>%
write_csv('../data/save/human_cleaned_sra_20200226.csv')
View(total)
cleaned_sra %>%
write_csv('../data/save/human_cleaned_sra_20220226.csv')
total %>%
write_csv('../data/save/all_biosample_table_20220226.csv')
