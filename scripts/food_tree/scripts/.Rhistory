map(function(small_df){
small_panel <- small_df %>%
mutate(simpson_reciprocal_nlog  = log(simpson_reciprocal)) %>%
rename(`log10(Blautia)` = Blautia,
`log10(Enterococcus)` = Enterococcus,
`log(Simpson reciprocal)` = simpson_reciprocal_nlog) %>%
dplyr::select(`log(Simpson reciprocal)`, `log10(Blautia)`, `log10(Enterococcus)`,  daycal:d_sugar ) %>%
mutate(daycal = daycal/1000) %>%  # now divide the value by 1000 to save some space in x axis text!!!
gather('yaxis', 'value', `log(Simpson reciprocal)`:`log10(Enterococcus)`) %>%
mutate(yaxis = factor(yaxis, levels = c('log(Simpson reciprocal)','log10(Blautia)','log10(Enterococcus)'))) %>%
gather('xaxis', 'number', daycal:d_sugar) %>%
mutate(xaxis = factor(xaxis, levels = c('daycal','d_carb','d_sugar','d_fiber','d_protein','d_fat'))) %>%
mutate(xaxis = if_else(str_detect(xaxis, '^d_'), str_replace(xaxis, 'd_',''), str_replace(xaxis, '^day','')),
xaxis = if_else(str_detect(xaxis, 'cal'), str_replace(xaxis, 'cal','calorie'), xaxis),
xaxis = str_to_title(xaxis),
xaxis = str_glue('{xaxis}')) %>%
mutate(xaxis = factor(xaxis, levels = c('Calorie','Carb','Sugar','Fiber','Protein','Fat')))
small_panel_split_each <- small_panel %>%  split(., list(.$xaxis, .$yaxis))
small_panel_split_each_fig <- small_panel_split_each %>%
imap(function(.x, .y){
res = summary(lm(value ~ number, data = .x ))
pval = round(res$coefficients[2, 'Pr(>|t|)'], 3)
ggscatter(data = .x,x = 'number', y = 'value', alpha = 0.1, xlab ='',
ylab = '',size = 1.2, pch = 19, title =  str_glue('{.y}\nP-val: {pval}'),
add = "reg.line",  # Add regressin line
add.params = list(color = "darkblue", fill = "gray59"), # Customize line
conf.int = TRUE, # Add confidence interval
) +
#facet_grid_sc(rows = vars(yaxis), cols = vars(xaxis), scales = list(y = scales_y, x = scales_x)) +
theme_classic(base_size = 11) +
theme(aspect.ratio = 1,
panel.background = element_rect(fill = "gray97"),
panel.grid.major = element_blank(),
#strip.background = element_blank(),
#strip.text = element_blank(),
panel.grid.minor = element_blank()
)
})
})
# assemble figure
ablatives <- split3[['ablative']]
g <- cowplot::plot_grid(ablatives[[1]],ablatives[[2]],ablatives[[3]],ablatives[[4]],ablatives[[5]],ablatives[[6]],ablatives[[7]],ablatives[[8]],ablatives[[9]],ablatives[[10]],ablatives[[11]],ablatives[[12]],ablatives[[13]],ablatives[[14]],ablatives[[15]],ablatives[[16]],ablatives[[17]],ablatives[[18]],
ncol = 6,
o = 'hv',labels = 'Ablative',label_y = -2,
#labels = 'AUTO',
axis = 'bltr')
ggsave(str_glue('../data/151_sameday__conditioning_ablative.jpg'), width = 12, height = 8,  plot = g)
nonablative <- split3[['nonablative']]
g <- cowplot::plot_grid(nonablative[[1]],nonablative[[2]],nonablative[[3]],nonablative[[4]],nonablative[[5]],nonablative[[6]],nonablative[[7]],nonablative[[8]],nonablative[[9]],nonablative[[10]],nonablative[[11]],nonablative[[12]],nonablative[[13]],nonablative[[14]],nonablative[[15]],nonablative[[16]],nonablative[[17]],nonablative[[18]],
ncol = 6,
o = 'hv',labels = 'Nonablative',label_y = -2,
#labels = 'AUTO',
axis = 'bltr')
ggsave(str_glue('../data/151_sameday__conditioning_nonablative.jpg'), width = 12, height = 8,  plot = g)
reduced <- split3[['reduced']]
g <- cowplot::plot_grid(reduced[[1]],reduced[[2]],reduced[[3]],reduced[[4]],reduced[[5]],reduced[[6]],reduced[[7]],reduced[[8]],reduced[[9]],reduced[[10]],reduced[[11]],reduced[[12]],reduced[[13]],reduced[[14]],reduced[[15]],reduced[[16]],reduced[[17]],reduced[[18]],
ncol = 6,
o = 'hv',labels = 'reduced',label_y = -2,
#labels = 'AUTO',
axis = 'bltr')
ggsave(str_glue('../data/151_sameday__conditioning_reduced.jpg'), width = 12, height = 8,  plot = g)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
dtb1 <- read_csv('../data/149_finalized_dtb1.csv')
View(dtb1)
# number of meals
s1 <-  dtb1 %>%
distinct(mrn, Meal, fdrt)
dtb2 <-read_csv('../data/149_finalized_dtb2.csv')
dtb2 %>%
distinct(mrn, Meal, fdrt)
knitr::opts_chunk$set(echo = TRUE)
dtb1 <- read_csv('../data/149_finalized_dtb1.csv')
# the macronutrients scatter plot
m_all <- dtb1 %>%
select(mrn, fdrt,Protein_g:Sodium_g ) %>%
gather('grp','gram', Protein_g:Sodium_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
View(dtb1)
# the macronutrients scatter plot
m_all <- dtb1 %>%
select(mrn, fdrt,Protein_g:Sugars_g ) %>%
gather('grp','gram', Protein_g:Sodium_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
# the macronutrients scatter plot
m_all <- dtb1 %>%
select(mrn, fdrt,Protein_g:Sugars_g ) %>%
gather('grp','gram', Protein_g:Sugars_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
# the macronutrients scatter plot
m_all <- dtb1 %>%
select(mrn, fdrt,Protein_g:Sugars_g ) %>%
gather('grp','gram', Protein_g:Sugars_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
m_panel <- m_all %>%
ggscatter(x = 'fdrt', y = 'eachsum', alpha = 0.005, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Grams',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1))  +
facet_wrap(~ grp, nrow = 3, scales = 'free_y') +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=6),
strip.background = element_blank(),
strip.text.x = element_text(size = stip_txt_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
library(tidyverse)
library(ggpubr)
library(cowplot)
library(ggimage)
library(lemon)
axis_text_size <- 8
axis_title_size <- 10
stip_txt_size <- 8
alpha_val <- 0.05
point_size <- 1.2
scatter_col <- 'gray14'
pick_point_size <- 1
pick_line_size <- 0.5
example_pt_line_size <- 0.3
diet_line_color <- '#E41A1C'
stool_line_color <- 'blue'
umap_pt_size <- 1
# the macronutrients scatter plot
m_all <- dtb1 %>%
select(mrn, fdrt,Protein_g:Sugars_g ) %>%
gather('grp','gram', Protein_g:Sugars_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
m_panel <- m_all %>%
ggscatter(x = 'fdrt', y = 'eachsum', alpha = 0.005, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Grams',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1))  +
facet_wrap(~ grp, nrow = 3, scales = 'free_y') +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=6),
strip.background = element_blank(),
strip.text.x = element_text(size = stip_txt_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
m_panel
day_calori <- dtb1 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=2)
day_cal
# this faith pd is recently calculated in 2021-07
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = expression(Diet~alpha~diversity),
xlab = 'Day relative to HCT',
title = expression(Diet~alpha~diversity),
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=2)
# this faith pd is recently calculated in 2021-07
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=2)
diet_alpha
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1/2)
diet_alpha
m_panel <- m_all %>%
ggscatter(x = 'fdrt', y = 'eachsum', alpha = 0.005, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Grams',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1))  +
facet_wrap(~ grp, nrow = 1, scales = 'free_y') +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=6),
strip.background = element_blank(),
strip.text.x = element_text(size = stip_txt_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
m_panel
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
day_cal
day_cal
ggsave('../data/072_daycal.png',width = 3, height = 3)
day_calori <- dtb1 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size, pch = 19,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../data/072_daycal.png',width = 3, height = 3)
day_calori <- dtb1 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size, pch = 16,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../data/072_daycal.png',width = 3, height = 3)
day_calori <- dtb1 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size, pch = 17,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../data/072_daycal.png',width = 3, height = 3)
day_calori <- dtb1 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size, pch = 16,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../data/072_daycal.png',width = 3, height = 3)
# this faith pd is recently calculated in 2021-07
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
ggsave('../data/072_alphadiet.png',width = 3, height = 3)
# this faith pd is recently calculated in 2021-07
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col, pch = 16,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
ggsave('../data/072_alphadiet.png',width = 3, height = 3)
knitr::opts_chunk$set(echo = TRUE)
dtb2 <- read_csv('../data/149_finalized_dtb2.csv')
dtb2 <- read_csv('../data/149_finalized_dtb2.csv')
day_calori <- dtb2 %>%
group_by(mrn, fdrt) %>%
summarise(daycal = sum(Calories_kcal))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
day_cal <- day_calori %>%
mutate(daycal = daycal/1000) %>%
ggscatter(x = 'fdrt', y = 'daycal', alpha = alpha_val, size = point_size, pch = 16,
xlab = 'Day relative to HCT',
ylab = 'Daily caloric intake',
title = 'Daily caloric intake',
color = scatter_col,
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
ggsave('../data/149_daycal.png',width = 3, height = 3)
faith2 <- read_tsv('../data/139_batch2_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
View(faith2)
faith2 <- read_tsv('../data/139_batch2_faith_pd/alpha-diversity.tsv')
faith2 <- read_tsv('../data/139_batch2_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = '_', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
faith2 <- read_tsv('../data/139_batch2_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = '_', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith2 %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col, pch = 16,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
ggsave('../data/072_alphadiet.png',width = 3, height = 3)
diet_alpha
faith2 <- read_tsv('../data/139_batch2_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = '_', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith2 %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col, pch = 16,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
ggsave('../data/149_alphadiet.png',width = 3, height = 3)
# this faith pd is recently calculated in 2021-07
faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>%
separate(...1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>%
mutate(mrn = as.numeric(str_replace(mrn, 'P','')))
# REMEMBER THAT IN AXIS LABLE YOU NEED TO TIMES THE 1000 BACK!!!!!!
diet_alpha <- faith %>%
mutate(faith_pd = faith_pd/1000) %>%
ggscatter('fdrt', 'faith_pd',
alpha = alpha_val,size = point_size,
color = scatter_col, pch = 16,
ylab = 'Diet alpha diversity',
xlab = 'Day relative to HCT',
title = 'Diet alpha diversity',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1)) +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
#plot.title = element_text(size=11, hjust = 0.5,  face = 'bold')
) +
theme(aspect.ratio=1)
ggsave('../data/072_alphadiet.png',width = 3, height = 3)
m_all <- dtb2 %>%
select(mrn, fdrt,Protein_g:Sugars_g ) %>%
gather('grp','gram', Protein_g:Sugars_g) %>%
mutate(grp = str_replace(grp, '_g$','')) %>%
group_by(mrn, fdrt, grp) %>%
summarise(eachsum = sum(gram))
m_panel <- m_all %>%
ggscatter(x = 'fdrt', y = 'eachsum', alpha = 0.005, size = point_size,
xlab = 'Day relative to HCT',
ylab = 'Grams',
add = "loess", conf.int = TRUE,
add.params = list(color = diet_line_color, fill = "hotpink", size = 1))  +
facet_wrap(~ grp, nrow = 1, scales = 'free_y') +
scale_x_continuous( breaks = seq(0, 50, 20)) +
theme(axis.text=element_text(size=6),
strip.background = element_blank(),
strip.text.x = element_text(size = stip_txt_size),
axis.title=element_text(size=axis_title_size),
plot.title = element_text(size=axis_title_size),
aspect.ratio=1)
m_panel
