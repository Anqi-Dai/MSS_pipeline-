ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
twoscore <- read_csv('../data/086_twoscore_procrustes.csv')
f2a <- twoscore %>%
mutate(pNd = str_extract(pNd, '\\d')) %>%
arrange(desc(grp)) %>%
mutate(pNd =  factor(pNd)) %>%
ggplot(aes(x = pNd, y = score, group = grp, linetype = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
scale_linetype_manual(values = c('solid','dashed')) +
theme_classic()  +
theme(aspect.ratio=1/2,
legend.position = c(0.75,0.4),
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_text_size),
legend.title = element_blank(),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
twoscore <- read_csv('../data/086_twoscore_procrustes.csv')
f2a <- twoscore %>%
mutate(pNd = str_extract(pNd, '\\d')) %>%
arrange(desc(grp)) %>%
mutate(pNd =  factor(pNd)) %>%
ggplot(aes(x = pNd, y = score, group = grp, linetype = grp)) +
geom_line(size = 0.3) +
geom_point(size = 1.3) +
labs(x = 'Number of previous days\nof dietary intake',y = 'Procrustes score') +
scale_linetype_manual(values = c('solid','dashed')) +
theme_classic()  +
theme(aspect.ratio=1/2,
legend.position = c(0.75,0.4),
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_text_size),
legend.title = element_blank(),
axis.text.x = element_text(angle=0, hjust=0.5))
f2a
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 4.1),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 3.5),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 3.2),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 3.4),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 3.5),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
title <- ggdraw() +
draw_label(
"Fig 2",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
plot.margin = margin(0, 0, 0, 7)
)
left <- plot_grid(f2a, NA, macro_side,
labels = c('A', NA, NA),label_y = 1,
rel_heights = c(1,-.35, 3.2),
ncol = 1)
right <- plot_grid(diagram,NA, fg_side,
labels = c('B',NA, 'E'),label_y = .8,
rel_heights = c(1,-.6,5),
ncol = 1)
f2 <-  plot_grid(left,right,
rel_widths = c(1,1.2),
nrow = 1)
combined <- plot_grid(
title, f2,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,2,1,1), "cm"))
ggsave('../data/F2_model_results_176.pdf',
width = 210, height = 197, units = "mm", device = 'pdf',
#plot = combined,
dpi = 300)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(scales)
library(tidybayes)
library(cowplot)
theme_set(theme_pubr(base_size = 8))
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
library(tidyverse)
library(ggpubr)
library(scales)
library(tidybayes)
library(cowplot)
theme_set(theme_pubr(base_size = 8))
key <- read_csv('../data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
newest <- readxl::read_excel('../data/Sucrose_All Experiments Consolidated .xlsx') %>%
mutate(Log_CFUs_per_GramStool = log10((((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1) ) %>%
filter(Day != 1) %>%
separate(Treatment, into = c('diet_treatment','abx_treatment'), sep = ', ', remove = T) %>%
mutate(diet_treatment = if_else(diet_treatment == 'Vehicle','vehicle','sucrose'),
abx_treatment = if_else(str_detect(abx_treatment, 'Bia'),'biapenem',abx_treatment),
diet_treatment = factor(diet_treatment, levels = c('vehicle','sucrose')),
abx_treatment = factor(abx_treatment, levels = c('PBS','biapenem'))) %>%
mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1) %>%
select(diet_treatment:Mouse_identifier, CFUs_per_GramStool, Log_CFUs_per_GramStool)
# are the mice paired in each of the treatment group
# the trapezpid auc
dat_entero <- newest %>%
select(diet_treatment,
abx_treatment,
Day,
Mouse_identifier,
CFUs_per_GramStool)
dat_entero_wide <- dat_entero %>%
pivot_wider(id_cols = c(diet_treatment,
abx_treatment,
Mouse_identifier),
names_from = Day,
names_prefix = "Day",
values_from = CFUs_per_GramStool)
dat_entero_wide <- dat_entero_wide %>%
mutate(trap_0_3 = (Day0+Day3)*3/2,
trap_3_6 = (Day3+Day6)*3/2,
trap = trap_0_3 + trap_3_6,
groups = paste(abx_treatment,
diet_treatment,sep="__")) %>%
mutate(groups = factor(groups, levels = c('PBS__vehicle','PBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
plotdf %>% count(xvar)
# maybe I can plot in a different way
plotdf <- newest %>%
#filter(Day != 3) %>%
mutate(Day = factor(Day)) %>%
arrange(abx_treatment,diet_treatment,  Day) %>%
mutate(xvar = str_glue('{abx_treatment}__{diet_treatment}__{Day}')) %>%
mutate(grp = str_glue('{abx_treatment}__{diet_treatment}')) %>%
mutate(grp = factor(grp, levels = c('PBS__vehicle','PBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
dat_entero <- newest %>%
select(diet_treatment,
abx_treatment,
Day,
Mouse_identifier,
CFUs_per_GramStool)
dat_entero_wide <- dat_entero %>%
pivot_wider(id_cols = c(diet_treatment,
abx_treatment,
Mouse_identifier),
names_from = Day,
names_prefix = "Day",
values_from = CFUs_per_GramStool)
# the trapezpid auc
dat_entero <- newest %>%
select(diet_treatment,
abx_treatment,
Day,
Mouse_identifier,
CFUs_per_GramStool)
dat_entero_wide <- dat_entero %>%
pivot_wider(id_cols = c(diet_treatment,
abx_treatment,
Mouse_identifier),
names_from = Day,
names_prefix = "Day",
values_from = CFUs_per_GramStool)
dat_entero_wide <- dat_entero_wide %>%
mutate(trap_0_3 = (Day0 - Day0 + Day3 - Day0)*3/2,
trap_3_6 = (Day3 - Day0 + Day6 - Day0)*3/2,
trap = trap_0_3 + trap_3_6,
groups = paste(abx_treatment,
diet_treatment,sep="__")) %>%
mutate(groups = factor(groups, levels = c('PBS__vehicle','PBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
plotdf %>% count(xvar)
f3_days <- plotdf %>%
ggboxplot(x = 'xvar', y = 'CFUs_per_GramStool',add = 'jitter',
xlab = '', ylab = 'Enterococcal\n CFU/gram',
width = 0.6,color  = 'grp')+
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
stat_compare_means(comparisons = list(c('biapenem__vehicle__3','biapenem__sucrose__3'), c('biapenem__vehicle__6','biapenem__sucrose__6')),label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),  labels = trans_format("log10", math_format(10^.x))) +
scale_x_discrete(labels=rep(c(0,3,6),4)) +
theme(axis.text =  element_text(size = 10),axis.title=element_text(size=10),legend.position = 'none',aspect.ratio=1/1.3)
# the boxplot of the AUC
my_comparisons <- list( c("PBS__vehicle", "biapenem__vehicle"),
c("biapenem__vehicle", "biapenem__sucrose"),
c("PBS__vehicle", "PBS__sucrose"))
f3_AUC <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons,label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
# combine the above two together on a stack
f3_mouse <- plot_grid(f3_days,NA, f3_AUC,  ncol = 1,
align = 'vh', axis = 'lrtb', rel_heights = c(1.1,-0.2,0.7))
f3_mouse
f3_AUC_stats <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons, method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
# the trapezpid auc
dat_entero <- newest %>%
select(diet_treatment,
abx_treatment,
Day,
Mouse_identifier,
CFUs_per_GramStool)
dat_entero_wide <- dat_entero %>%
pivot_wider(id_cols = c(diet_treatment,
abx_treatment,
Mouse_identifier),
names_from = Day,
names_prefix = "Day",
values_from = CFUs_per_GramStool)
dat_entero_wide <- dat_entero_wide %>%
mutate(trap_0_3 = (Day0 - Day0 + Day3 - Day0)*3/2,
trap_3_6 = (Day3 - Day0 + Day6 - Day0)*3/2,
trap = trap_0_3 + trap_3_6,
groups = paste(abx_treatment,
diet_treatment,sep="__")) %>%
mutate(groups = factor(groups, levels = c('PBS__vehicle','PBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
plotdf %>% count(xvar)
# the trapezpid auc
dat_entero <- newest %>%
select(diet_treatment,
abx_treatment,
Day,
Mouse_identifier,
CFUs_per_GramStool)
dat_entero_wide <- dat_entero %>%
pivot_wider(id_cols = c(diet_treatment,
abx_treatment,
Mouse_identifier),
names_from = Day,
names_prefix = "Day",
values_from = CFUs_per_GramStool)
dat_entero_wide <- dat_entero_wide %>%
mutate(trap_0_3 = (Day0 - Day0 + Day3 - Day0)*3/2,
trap_3_6 = (Day3 - Day0 + Day6 - Day0)*3/2,
trap = trap_0_3 + trap_3_6,
groups = paste(abx_treatment,
diet_treatment,sep="__")) %>%
mutate(groups = factor(groups, levels = c('PBS__vehicle','PBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
plotdf %>% count(xvar)
f3_days <- plotdf %>%
ggboxplot(x = 'xvar', y = 'CFUs_per_GramStool',add = 'jitter',
xlab = '', ylab = 'Enterococcal\n CFU/gram',
width = 0.6,color  = 'grp')+
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
stat_compare_means(comparisons = list(c('biapenem__vehicle__3','biapenem__sucrose__3'), c('biapenem__vehicle__6','biapenem__sucrose__6')),label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),  labels = trans_format("log10", math_format(10^.x))) +
scale_x_discrete(labels=rep(c(0,3,6),4)) +
theme(axis.text =  element_text(size = 10),axis.title=element_text(size=10),legend.position = 'none',aspect.ratio=1/1.3)
# the boxplot of the AUC
my_comparisons <- list( c("PBS__vehicle", "biapenem__vehicle"),
c("biapenem__vehicle", "biapenem__sucrose"),
c("PBS__vehicle", "PBS__sucrose"))
f3_AUC <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons,label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
# combine the above two together on a stack
f3_mouse <- plot_grid(f3_days,NA, f3_AUC,  ncol = 1,
align = 'vh', axis = 'lrtb', rel_heights = c(1.1,-0.2,0.7))
f3_mouse
f3_AUC_stats <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons, method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
f3_AUC_stats
f3_days <- plotdf %>%
ggboxplot(x = 'xvar', y = 'CFUs_per_GramStool',add = 'jitter',
xlab = '', ylab = 'Enterococcal\n CFU/gram',
width = 0.6,color  = 'grp')+
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
stat_compare_means(comparisons = list(c('biapenem__vehicle__3','biapenem__sucrose__3'), c('biapenem__vehicle__6','biapenem__sucrose__6')),label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),  labels = trans_format("log10", math_format(10^.x))) +
scale_x_discrete(labels=rep(c(0,3,6),4)) +
theme(axis.text =  element_text(size = 10),axis.title=element_text(size=10),legend.position = 'none',aspect.ratio=1/1.3)
# the boxplot of the AUC
my_comparisons <- list( c("PBS__vehicle", "biapenem__vehicle"),
c("biapenem__vehicle", "biapenem__sucrose"),
c("PBS__vehicle", "PBS__sucrose"))
f3_AUC <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons,label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
# combine the above two together on a stack
f3_mouse <- plot_grid(f3_days,NA, f3_AUC,  ncol = 1,
align = 'vh', axis = 'lrtb', rel_heights = c(1.1,-0.2,0.7))
f3_mouse
f3_AUC_stats <- ggboxplot(dat_entero_wide,
x="groups",add = 'jitter',
y="trap", color  = 'groups') +
ylab("Trapezoidal\nAUC")+xlab('') +
scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
scale_y_log10(breaks = c(1 %o% 10^(-1:8)),  labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means(comparisons = my_comparisons, method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
theme(axis.text.x = element_blank(),axis.title=element_text(size=10), axis.text =  element_text(size = 10),legend.position = 'none',aspect.ratio=1/3.1, axis.ticks.x = element_blank())
f3_mouse
f3_AUC_stats
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(survival)
# Load the data
data(veteran)
# Create a time-dependent covariate for tumor size
tumor_size <- c(rep(10, 5), rep(15, 5), rep(20, 5), rep(25, 5))
# Fit the Cox model
model <- coxph(Surv(time, status) ~ trt + prior + karno + tt(tumor_size), data=veteran)
# Load the data
data(veteran)
library(tidyverse)
library(survival)
df_main <- read_csv('../data/df_main.csv')
df_main <- read_csv('../data/df_main.csv')
df_main <- read_csv('../data/df_main.csv')
View(df_main)
df_main %>% count(OStime_landmark,OSevent)
# Load the data
data(veteran)
data(cancer, package="survival")
View(veteran)
# Create a time-dependent covariate for tumor size
tumor_size <- c(rep(10, 5), rep(15, 5), rep(20, 5), rep(25, 5))
# Fit the Cox model
model <- coxph(Surv(time, status) ~ trt + prior + karno + tt(tumor_size), data=veteran)
knitr::opts_chunk$set(echo = TRUE)
med_all <- read_csv('../data/169_all_medication.csv')
med_all <- read_csv('../data/169_all_medication.csv')
med_all <- read_csv('../data/169_all_medication.csv')
med_all <- read_csv('../data/169_all_medication.csv')
View(med_all)
med1 <- read_rds('../data/tasks_nutrition_batch1_2022-11-29.rds')
View(med1)
med1 %>% count(order_category)
med1 %>% glimpse()
med1 %>% count(med_class)
med2 <- read_rds('../data/batch2_medication_exposures.rds')
med1 %>% count(med_class1)
med1 %>% count(med_class2)
med1 %>% count(med_class1)
med1 %>% count(med_class1, sort = T)
med1 %>% filter(med_class1 == 'anti-infectives') %>% count(med_class2, sort = T)
knitr::opts_chunk$set(echo = TRUE)
library(vdbR)
connect_database()
get_table_from_database('shotgun_lookup_ad')
View(shotgun_lookup_ad)
View(shotgun_lookup_ad)
