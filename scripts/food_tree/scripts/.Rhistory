set_names(fns) %>%
purrr::map(~  read_tsv(file = ., n_max = 1 , col_types = 'cc',  skip = 2, col_names = c('bin','iRep')) %>%  select(iRep) ) %>%
bind_rows(.id = 'fn') %>%
mutate(fn = str_replace(fn, '_irep_dastool.tsv$',''),
fn = str_replace(fn, '../data/growth/irep/peter_samples_irep//','')) %>%
separate(fn, into = c('sampleid','samplebin'), sep = '__concat__', remove = T) %>%
mutate(iRep = as.numeric(iRep)) %>%
mutate(sbid = str_glue('{sampleid}__{samplebin}')) %>%
filter(str_detect(sampleid, '^Sample')) # to only include the project 13141 ones
samp <- irep %>%
distinct(sampleid)
bins <- read_tsv('../data/growth/irep/binning_table_all_simple_peter.tsv') %>%
rename_all(~ gsub("\\.", "_", .)) %>%
mutate(fpmbp = `# contigs (>= 0 bp)`/Size_Mb) %>%
filter(Completeness >= 75 & fpmbp <= 175 & Contamination <= 2) %>%
mutate(Sample = str_replace(Sample, '__concat',''),
sbid = str_glue('{Sample}__{Bin}')) %>%
inner_join(irep, by  = 'sbid') %>%
relocate(iRep, .after = 'Bin') %>%
relocate(best_species, .after = 'iRep') %>%
filter(!is.na(iRep)) %>%
arrange(Sample,Bin,  best_species) %>%
# if there are multiple get the average
#group_by(Sample, best_species, best_level) %>%
#summarise(aveirep = mean(iRep)) %>%
filter(best_species != 'Unclassified') %>%
mutate(sampleid = str_extract(Sample, '^Sample.+IGO'),
sampleid = str_replace(sampleid, 'Sample_',''),
sampleid = str_replace(sampleid, '_IGO','')) %>%
relocate(sampleid, .before = 'Sample')  %>%
mutate(sampleid = str_replace(sampleid, '_2', ''),
sampleid = str_replace(sampleid,'FMT_', 'FMT\\.'))
# find the genus and family of the irep bins
colnames(bins)
# do these samples overlap with the current diet cohort?
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')
stool <- read_csv('../data/011_802_total_stool_samples.csv')
length(intersect(stool$sampleid, bins$sampleid))
length(intersect(meta$sampleid, bins$sampleid)) # 28
has_diet <- intersect(meta$sampleid, bins$sampleid)
# find the previous 2 days sum of fruits and sweets
p2d_sum69 <- meta %>%
filter(sampleid %in% has_diet) %>%
select(sampleid, fg_fruit, fg_sweets) %>%
mutate(sum69 = (fg_fruit + fg_sweets) *2)
library(vdbR)
connect_database()
list_table_from_database('blast')
get_table_from_database('asv_annotation_blast_ag')
# do these samples overlap with the current diet cohort?
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')
stool <- read_csv('../data/011_802_total_stool_samples.csv')
length(intersect(stool$sampleid, bins$sampleid))
length(intersect(meta$sampleid, bins$sampleid)) # 28
has_diet <- intersect(meta$sampleid, bins$sampleid)
# find the previous 2 days sum of fruits and sweets
p2d_sum69 <- meta %>%
filter(sampleid %in% has_diet) %>%
select(sampleid, fg_fruit, fg_sweets) %>%
mutate(sum69 = (fg_fruit + fg_sweets) *2)
library(vdbR)
connect_database()
library(vdbR)
connect_database()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
fns <- list.files('../data/growth/irep/peter_samples_irep/', full.names = T, pattern = '.tsv')
df <- tibble(fns = fns)
irep <- fns %>%
set_names(fns) %>%
purrr::map(~  read_tsv(file = ., n_max = 1 , col_types = 'cc',  skip = 2, col_names = c('bin','iRep')) %>%  select(iRep) ) %>%
bind_rows(.id = 'fn') %>%
mutate(fn = str_replace(fn, '_irep_dastool.tsv$',''),
fn = str_replace(fn, '../data/growth/irep/peter_samples_irep//','')) %>%
separate(fn, into = c('sampleid','samplebin'), sep = '__concat__', remove = T) %>%
mutate(iRep = as.numeric(iRep)) %>%
mutate(sbid = str_glue('{sampleid}__{samplebin}')) %>%
filter(str_detect(sampleid, '^Sample')) # to only include the project 13141 ones
samp <- irep %>%
distinct(sampleid)
bins <- read_tsv('../data/growth/irep/binning_table_all_simple_peter.tsv') %>%
rename_all(~ gsub("\\.", "_", .)) %>%
mutate(fpmbp = `# contigs (>= 0 bp)`/Size_Mb) %>%
filter(Completeness >= 75 & fpmbp <= 175 & Contamination <= 2) %>%
mutate(Sample = str_replace(Sample, '__concat',''),
sbid = str_glue('{Sample}__{Bin}')) %>%
inner_join(irep, by  = 'sbid') %>%
relocate(iRep, .after = 'Bin') %>%
relocate(best_species, .after = 'iRep') %>%
filter(!is.na(iRep)) %>%
arrange(Sample,Bin,  best_species) %>%
# if there are multiple get the average
#group_by(Sample, best_species, best_level) %>%
#summarise(aveirep = mean(iRep)) %>%
filter(best_species != 'Unclassified') %>%
mutate(sampleid = str_extract(Sample, '^Sample.+IGO'),
sampleid = str_replace(sampleid, 'Sample_',''),
sampleid = str_replace(sampleid, '_IGO','')) %>%
relocate(sampleid, .before = 'Sample')  %>%
mutate(sampleid = str_replace(sampleid, '_2', ''),
sampleid = str_replace(sampleid,'FMT_', 'FMT\\.'))
# find the genus and family of the irep bins
colnames(bins)
# do these samples overlap with the current diet cohort?
meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv')
stool <- read_csv('../data/011_802_total_stool_samples.csv')
length(intersect(stool$sampleid, bins$sampleid))
length(intersect(meta$sampleid, bins$sampleid)) # 28
has_diet <- intersect(meta$sampleid, bins$sampleid)
# find the previous 2 days sum of fruits and sweets
p2d_sum69 <- meta %>%
filter(sampleid %in% has_diet) %>%
select(sampleid, fg_fruit, fg_sweets) %>%
mutate(sum69 = (fg_fruit + fg_sweets) *2)
library(vdbR)
connect_database()
list_table_from_database('blast')
get_table_from_database('asv_annotation_blast_ag')
target <- asv_annotation_blast_ag %>%
filter(family %in% c('Enterobacteriaceae','Enterococcaceae')) %>%
distinct(family, genus) %>%
summarise(genera = str_c(genus, collapse = "|"))
find_higher <- bins %>%
distinct(best_species,  best_level) %>%
arrange(best_species) %>%
filter(str_detect(best_species, target$genera)) %>%
mutate(genus = c('Enterobacter','Enterococcus','Enterococcus','Enterococcus','Escherichia','Klebsiella','Klebsiella'))
family2 <- bins %>%
select(sampleid,samplebin,  iRep, best_species,  best_level) %>%
inner_join(find_higher) %>%
inner_join(p2d_sum69 %>%
select(sampleid, sum_sugar = sum69)) %>%
select(sampleid, samplebin, iRep, genus, sum_sugar)
family2_irep <- bins %>%
select(sampleid,samplebin,  iRep, best_species,  best_level) %>%
inner_join(find_higher)
older <-  read_csv('../data/sum of sugar intake vs max zscore family(E,E).csv') %>%
select(colnames(family2_irep))
all_fam2_irep <- bind_rows(family2_irep,older )%>%
split(.$genus) %>%
map(function(df){
df %>%
mutate(iRep_zscore = scale(.$iRep, center = T, scale = T)[,1])
}
) %>%
bind_rows()  %>%
inner_join(all %>% select(sampleid, sum_sugar)
)
# the data from jonas lab people
them <- read_csv('../data/sum of sugar intake vs max zscore family(E,E).csv') %>%
select(sampleid, samplebin, iRep, genus, p1d_Sweets, p2d_Sweets,p1d_Fruits, p2d_Fruits, iRep_zscore, pid, sum_sugar) %>%
filter(!is.na(sum_sugar)) %>%
mutate(sum_fruits = p1d_Fruits + p2d_Fruits,
sum_sweets = p1d_Sweets + p2d_Sweets)
all <- bind_rows(them, family2) %>%
filter(!is.na(sum_sugar))
ave_fruit <- them %>%
mutate(ave_fruit = sum_fruits/2) %>%
ggpubr::ggscatter(x = 'ave_fruit', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Fruits intake averaged',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
legend.position = 'none',
legend.title=element_blank())
ave_sweets <- them %>%
mutate(ave_sweets = sum_sweets/2) %>%
ggpubr::ggscatter(x = 'ave_sweets', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets intake averaged',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
legend.position = 'none',
legend.title=element_blank())
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
legend.position = 'none',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.jpg', height = 3, plot = ave_combined)
ave_combined
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.jpg', height = 3, plot = ave_combined)
axis_text_size <- 10
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
axis_title_size <- 10
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left")) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.jpg', height = 3, plot = ave_combined)
ggsave('../data/123_new_2fam_fig3top.pdf', height = 3, plot = ave_combined)
ggsave('../data/123_new_2fam_fig3top.pdf', height = 1.5, plot = ave_combined)
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left", size = 1)) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left", size = 1)) +
theme(aspect.ratio = 4,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left", size = 4)) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left", size = 2)) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
ave_combined <- them %>%
mutate(ave_sugar = sum_sugar/2) %>%
ggpubr::ggscatter(x = 'ave_sugar', y = 'iRep_zscore',  color = 'genus',palette = 'lancet',
xlab = 'Sweets and fruits intake averaged (g)',
ylab = 'Growth rate\n(standardized within genus) ',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n", label.x.npc = "left", size = 2.5)) +
theme(aspect.ratio = 1,
axis.text=element_text(size=axis_text_size),
axis.title=element_text(size=axis_title_size),
legend.position = 'right',
legend.title=element_blank())
ggsave('../data/123_new_2fam_fig3top.pdf', height = 2, plot = ave_combined)
View(ave_combined)
View(them)
them %>% distinct(sampleid)
them %>% distinct(mrn)
them %>% distinct(pid)
View(meta)
knitr::opts_chunk$set(echo = TRUE, message = F)
meta %>% distinct(mrn)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(scales)
alldat4 <- readRDS("../data/alldat4.rds")
View(alldat4)
alldat4 <- readRDS("../data/alldat4.rds")
#Just for targeted stats purposes of day 6-7 with stat_compare_means()
alldat4 %>%
filter(abx_treatment == "biapenem") %>%
filter(day_factor_simple == "6-7") %>%
ggplot(aes(diet_treatment, y=as.numeric(Log_CFUs_per_GramStool))) +
geom_boxplot(alpha = 0.7,  outlier.shape = NA) +
geom_jitter(width = 0.1, alpha = 0.4) +
# geom_dotplot(dotsize=3, binaxis='y', stackdir='center', position=position_dodge(0.5), binwidth = 0.05) +
ylab("CFUs/gram of stool, Log10 Scale") +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
ggtitle(exp_title) +
theme(axis.text.x = element_text(angle = 90, vjust =0.5, hjust = 0.5)) +
theme_classic() +
# geom_text_repel(data=alldat1, aes(Day,as.numeric(Log_CFUs_per_GramStool), label=Mouse_identifier), fontface='bold')+
theme(legend.position = "none") +
ggpubr::stat_compare_means()
library(scales)
library(tidyverse)
exp_title <- 'Experiments 10, 12, 13, 14'
alldat4 <- readRDS("../data/alldat4.rds")
gg4 <- alldat4 %>%
ggplot(aes(day_factor_simple, y=as.numeric(Log_CFUs_per_GramStool))) +
geom_boxplot(aes(fill = diet_treatment), alpha = 0.7,  outlier.shape = NA) +
geom_jitter(width = 0.1, alpha = 0.4, shape = 16, size = 2) +
# geom_dotplot(dotsize=3, binaxis='y', stackdir='center', position=position_dodge(0.5), binwidth = 0.05) +
ylab("CFUs/gram of stool, Log10 Scale") +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
facet_grid(. ~abx_treatment + diet_treatment)+
ggtitle(exp_title) +
theme(axis.text.x = element_text(angle = 90, vjust =0.5, hjust = 0.5)) +
theme_classic() +
# geom_text_repel(data=alldat1, aes(Day,as.numeric(Log_CFUs_per_GramStool), label=Mouse_identifier), fontface='bold')+
theme(legend.position = "none")
alldat4$Mouse_identifier %>% unique() %>% length()
# wilxocon = 0.0012 for day 6-7
# N = 36 mice across 4 independent experiments
gg4
# ggsave("biapenem_combo.pdf", plot = gg4, device = "pdf")
#Just for targeted stats purposes of day 6-7 with stat_compare_means()
alldat4 %>%
filter(abx_treatment == "biapenem") %>%
filter(day_factor_simple == "6-7") %>%
ggplot(aes(diet_treatment, y=as.numeric(Log_CFUs_per_GramStool))) +
geom_boxplot(alpha = 0.7,  outlier.shape = NA) +
geom_jitter(width = 0.1, alpha = 0.4) +
# geom_dotplot(dotsize=3, binaxis='y', stackdir='center', position=position_dodge(0.5), binwidth = 0.05) +
ylab("CFUs/gram of stool, Log10 Scale") +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
ggtitle(exp_title) +
theme(axis.text.x = element_text(angle = 90, vjust =0.5, hjust = 0.5)) +
theme_classic() +
# geom_text_repel(data=alldat1, aes(Day,as.numeric(Log_CFUs_per_GramStool), label=Mouse_identifier), fontface='bold')+
theme(legend.position = "none") +
ggpubr::stat_compare_means()
View(alldat4)
alldat4
# the fold change for d0 d7
# of only the biapenem group
dat <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple  )
View(dat)
# the fold change for d0 d7
# of only the biapenem group
dat <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple  )
dat %>% count(diet_treatment, abx_treatment, Mouse_identifier,day_factor_simple)
tt <- dat %>% count(diet_treatment, abx_treatment, Mouse_identifier,day_factor_simple)
tt <- dat %>% count(diet_treatment, abx_treatment, Mouse_identifier,day_factor_simple)
View(tt)
tt <- dat %>% count(diet_treatment, abx_treatment, Group, Mouse_identifier,day_factor_simple)
# the fold change for d0 d7
# of only the biapenem group
dat <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )
tt <- dat %>% count(diet_treatment, abx_treatment, Group, Mouse_identifier,day_factor_simple)
View(alldat4)
tt <- dat %>% count(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,day_factor_simple)
tt
tt <- dat %>% count(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,day_factor_simple) %>%
filter(day_factor_simple != '3')
# the fold change for d0 d7
# of only the biapenem group
dat <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )%>%
filter(day_factor_simple != '3')
# the fold change for d0 d7
# of only the biapenem group
dat07 <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )%>%
filter(day_factor_simple != '3')
View(dat07)
dat07
# the fold change for d0 d7
# of only the biapenem group
dat07 <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )%>%
filter(day_factor_simple != '3') %>%
spread('day_factor_simple', 'Log_CFUs_per_GramStool')
dat07
# the fold change for d0 d7
# of only the biapenem group
dat07 <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )%>%
filter(day_factor_simple != '3') %>%
spread('day_factor_simple', 'Log_CFUs_per_GramStool') %>%
rename(d0 = `0`, d7 = `6-7`)
# the fold change for d0 d7
# of only the biapenem group
dat07 <- alldat4 %>%
filter(abx_treatment == 'biapenem') %>%
select(Experiment, diet_treatment, abx_treatment, Group, Mouse_identifier,Log_CFUs_per_GramStool,day_factor_simple )%>%
filter(day_factor_simple != '3') %>%
spread('day_factor_simple', 'Log_CFUs_per_GramStool') %>%
rename(d0 = `0`, d7 = `6-7`) %>%
mutate(d70_foldchange = d7/d0)
dat07
library(ggpubt)
library(ggpubr)
dat07
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange')
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange')
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange')
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange') +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x)))
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange', add = 'jitter') +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x)))
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange', add = 'jitter') +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means()
dat07 %>%
ggboxplot(x = 'diet_treatment', y = 'd70_foldchange', add = 'jitter',
title = 'd7 VS d0 fold change') +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
stat_compare_means()
#Just for targeted stats purposes of day 6-7 with stat_compare_means()
alldat4 %>%
filter(abx_treatment == "biapenem") %>%
filter(day_factor_simple == "6-7") %>%
ggplot(aes(diet_treatment, y=as.numeric(Log_CFUs_per_GramStool))) +
geom_boxplot(alpha = 0.7,  outlier.shape = NA) +
geom_jitter(width = 0.1, alpha = 0.4) +
# geom_dotplot(dotsize=3, binaxis='y', stackdir='center', position=position_dodge(0.5), binwidth = 0.05) +
ylab("CFUs/gram of stool, Log10 Scale") +
scale_y_log10(breaks = c(1 %o% 10^(-1:12)),
labels = trans_format("log10", math_format(10^.x))) +
ggtitle('day 7 only') +
theme(axis.text.x = element_text(angle = 90, vjust =0.5, hjust = 0.5)) +
theme_classic() +
# geom_text_repel(data=alldat1, aes(Day,as.numeric(Log_CFUs_per_GramStool), label=Mouse_identifier), fontface='bold')+
theme(legend.position = "none") +
ggpubr::stat_compare_means()
