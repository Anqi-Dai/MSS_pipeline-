ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5) +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
# plotting
# color by BM or BMT
pcoa_gvhd <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
# plotting
# color by BM or BMT
pcoa_gvhd <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber', facet.by = 'fiber') +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
# plotting
# color by BM or BMT
pcoa_gvhd <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
facet_grid(fiber ~ Day) +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
# plotting
pcoa_gvhd_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
# plotting
pcoa_gvhd_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_all
pcoa_gvhd <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
facet_grid(fiber ~ Day) +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
library(ggpubr)
pcoa_gvhd <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'grp', palette = 'lancet', size = 'Day', alpha = 0.5,
shape = 'fiber') +
facet_grid(fiber ~ Day) +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd
beta_df
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.5) +
labs(title = '') +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
install.packages('paletteer')
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.5) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 16) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 16) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 17) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha
# color by alpha diversity
pcoa_gvhd_alpha_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha_all
pcoa_gvhd_alpha_all
# color by alpha diversity
pcoa_gvhd_alpha_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_gvhd_alpha_all
# color by alpha diversity
pcoa_alpha_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15) +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha_all
pcoa_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15) +
labs(title = '') +
facet_grid(fiber ~ Day) +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha
pcoa_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15, shape = 'grp') +
labs(title = '') +
facet_grid(fiber ~ Day) +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15, shape = 'grp') +
labs(title = '') +
facet_grid(fiber ~ Day) +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha
pcoa_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15, shape = 'grp') +
labs(title = '') +
facet_grid(fiber ~ Day) +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha
pcoa_alpha <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15, shape = 'grp') +
labs(title = '') +
facet_grid(fiber ~ Day) +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha
# color by alpha diversity
pcoa_alpha_all <- beta_df %>%
ggscatter(x = 'V1', y = 'V2', color =  'inv', alpha = 0.8, point = 15, shape = 'grp') +
labs(title = '') +
paletteer::scale_color_paletteer_c("viridis::plasma") +
xlab(paste0("PC 1 [",percent_var[1],"%]")) +
ylab(paste0("PC 2 [",percent_var[2],"%]")) +
theme(aspect.ratio=1, legend.position = 'right')
pcoa_alpha_all
knitr::opts_chunk$set(echo = TRUE)
library(ggpubr)
library(tidyverse)
# look at the pathway results
pw <- read_tsv('../humann3_pathabundance_cpm_joined_unstratified.tsv')
View(pw)
# look at the pathway results
pws <- read_tsv('../humann3_pathabundance_cpm_joined_stratified.tsv')
View(pws)
meta <- read_csv('../pheno_with_alpha_diversity.csv')
# look at the pathway results the stratified version
pws <- read_tsv('../humann3_pathabundance_cpm_joined_stratified.tsv') %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)])
pws
?separate
# look at the pathway results the stratified version
pws <- read_tsv('../humann3_pathabundance_cpm_joined_stratified.tsv') %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)]) %>%
separate(`# Pathway`, into = c('pathway','species'),  sep = '\\|')
pws
# look at the pathway results the stratified version
pws <- read_tsv('../humann3_pathabundance_cpm_joined_stratified.tsv') %>%
gather('sampleid', 'cpm', names(.)[2]:names(.)[ncol(.)]) %>%
separate(`# Pathway`, into = c('pathway','species'),  sep = '\\|') %>%
mutate(sampleid = str_replace(sampleid, 'Sample_',''),
sampleid = str_replace(sampleid, '_IGO_12898.+$',''))
meta
bifido <- meta %>%
filter(fiber == '40%' & Day  == 14)
bifido
bifido <- meta %>%
filter(fiber == '40%' & Day  == 14)
d14 <- pws %>%
filter(sampleid %in% bifido$sampleid)
bifido_pw <- pws %>%
filter(sampleid %in% bifido$sampleid)
View(bifido_pw)
bifido_pw
bifido_pw <- pws %>%
filter(sampleid %in% bifido$sampleid) %>%
filter(str_detect(species, 'Bifidobacterium'))
View(bifido_pw)
bifido_pw <- pws %>%
filter(sampleid %in% bifido$sampleid) %>%
filter(str_detect(species, 'Bifidobacterium'))
bifido_pw %>% distinct(pathway)
bifido_pw
bifido_pw %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal")
bifido_pw %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal", add = 'dotplot')
bifido_pw %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal", add = 'jitter', add.params = list(color = 'green'))
bifido_pw %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal", add = 'jitter', add.params = list(color = 'forestgreen'))
bifido_pw %>%
mutate(pathway = fct_reorder(pathway, cpm, .fun=median, .desc = T)) %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal", add = 'jitter', add.params = list(color = 'forestgreen'))
bifido_pw %>%
mutate(pathway = fct_reorder(pathway, cpm, .fun=median, .desc = T)) %>%
ggboxplot(x = 'pathway', y = 'cpm', orientation = "horizontal", add = 'jitter', add.params = list(color = 'forestgreen'))
knitr::opts_chunk$set(echo = TRUE)
# load the three tables
library(vdbR)
remotes::install_git("https://github.mskcc.org/gomesa/vdbR.git",quiet=T)
install.packages('remotes')
remotes::install_git("https://github.mskcc.org/gomesa/vdbR.git",quiet=T)
# load the three tables
library(vdbR)
library(tidyverse)
connect_database('~/dbConfig.txt')
list_table_from_database('alpha')
get_table_from_database('asv_annotation_blast_ag')
get_table_from_database('asv_alpha_diversity_ag')
alpha <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1126|pool1127|pool1129|pool1128')) %>%
select(sampleid:shannon)
View(alpha)
alpha <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1126|pool1127|pool1129|pool1128')) %>%
select(sampleid:shannon, path_pool)
# check the meta table they sent us
meta <- readxl::read_excel('../data/3-1-22 Metadata MSK incl Abx.xlsx')
View(meta)
alpha
# downloading the 153 hackensack samples to local
alpha %>%
select(oligos_id, path_pool) %>%
mutate(R1 = str_glue('{oligos_id}_R1.fastq.gz'),
R2 = str_glue('{oligos_id}_R2.fastq.gz')) %>%
mutate(p1 = str_glue('{path_pool}/{R1}'),
p2 = str_glue('{path_pool}/{R2}')) %>%
select(p1, p2) %>%
gather() %>%
mutate(cmd = str_glue('rsync --progress --partial -avz daia1@lilac.mskcc.org:{value} .')) %>%
select(cmd) %>%
write_csv('../data/hackensack/', col_names = F)
# downloading the 153 hackensack samples to local
alpha %>%
select(oligos_id, path_pool) %>%
mutate(R1 = str_glue('{oligos_id}_R1.fastq.gz'),
R2 = str_glue('{oligos_id}_R2.fastq.gz')) %>%
mutate(p1 = str_glue('{path_pool}/{R1}'),
p2 = str_glue('{path_pool}/{R2}')) %>%
select(p1, p2) %>%
gather() %>%
mutate(cmd = str_glue('rsync --progress --partial -avz daia1@lilac.mskcc.org:{value} .')) %>%
select(cmd) %>%
write_csv('../data/hackensack/dl153.sh', col_names = F)
# check the meta table they sent us
meta <- readxl::read_excel('../data/3-1-22 Metadata MSK incl Abx.xlsx')
# check the meta table they sent us
meta <- readxl::read_excel('../data/5-3-22 Metadata MSK incl Abx.xlsx')
View(meta)
# find the oligos of the samples from Emily's file
p1126 <- read_tsv('../data/hackensack/pool1126.oligos')
View(p1126)
?read_tsv
# find the oligos of the samples from Emily's file
p1126 <- read_tsv('../data/hackensack/pool1126.oligos', skip = 2, comment = '#')
# find the oligos of the samples from Emily's file
p1126 <- read_tsv('../data/hackensack/pool1126.oligos', skip = 2, comment = '#', col_names = F)
# find the oligos of the samples from Emily's file
fns <- list.files('../data/hackensack/', pattern = '^pool', full.names = T)
fns
p1126 <-
all_oligos <- fns %>%
setnames(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
# find the oligos of the samples from Emily's file
fns <- list.files('../data/hackensack/', pattern = '^pool', full.names = T)
all_oligos <- fns %>%
setnames(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
fns
# find the oligos of the samples from Emily's file
fns <- list.files('../data/hackensack/', pattern = '^pool', full.names = T)
all_oligos <- fns %>%
setnames(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
# find the oligos of the samples from Emily's file
fns <- list.files('../data/hackensack/', pattern = '^pool', full.names = T)
all_oligos <- fns %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
View(all_oligos)
View(all_oligos[[1]])
all_oligos <- fns %>%
set_names(fns)
all_oligos <- fns %>%
set_names(fns) %>%
map_dfr( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
# find the oligos of the samples from Emily's file
fns <- list.files('../data/hackensack/', pattern = '^pool', full.names = T)
all_oligos <- fns %>%
set_names(fns) %>%
map_dfr( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
View(all_oligos)
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
View(all_oligos)
all_oligos <- fns %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
all_oligos <- fns %>%
map_dfr( ~ read_tsv(., skip = 2, comment = '#', col_names = F))
View(all_oligos)
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F)) %>%
bind_rows(.id = 'pool')
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F)) %>%
bind_rows(.id = 'pool') %>%
filter(!str_detect(X4, 'MB'))
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F)) %>%
bind_rows(.id = 'pool')
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F)) %>%
bind_rows(.id = 'pool') %>%
filter(!str_detect(X4, 'MB'))
View(all_oligos)
View(alpha)
```{r}
alpha <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1126|pool1127|pool1129|pool1128')) %>%
select(sampleid:shannon, path_pool)
alpha <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1126|pool1127|pool1129|pool1128')) %>%
select(sampleid:shannon, path_pool)
alpha <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1126|pool1127|pool1129|pool1128')) %>%
select(sampleid:shannon, path_pool)  %>%
filter(!str_detect(sampleid, 'MB'))
all_oligos <- fns %>%
set_names(fns) %>%
map( ~ read_tsv(., skip = 2, comment = '#', col_names = F)) %>%
bind_rows(.id = 'pool') %>%
filter(!str_detect(X4, 'MB')) %>%
mutate(sampleid = str_replace_all(X4, '-','\\.'))
# what happened to the missing 163-151 = 12 samples
missing <- all_oligos %>%
filter(!sampleid %in% alpha$sampleid)
View(missing)
missing
get_counts_subset(c('ENG1065.E'))
get_counts_subset(c('ENG1080.P'))
get_counts_subset(c('ENG1080.2.4M'))
missing %>%
select(sampleid) %>%
write_csv('../data/missing12_hackensack.csv')
knitr::opts_chunk$set(echo = TRUE)
meta <- read_csv('../data/Stool_mice_Fiber_Days1.7.14_JP_VDB_1.26.22.csv')
library(tidyverse)
library(ggpubr)
library(vegan)
dir <- '/Volumes/vandenBrinkLab/Diet-Microbiome Projects/Dietary Fiber/Shotgun Data/'
meta <- read_csv('../data/Stool_mice_Fiber_Days1.7.14_JP_VDB_1.26.22.csv')
View(meta)
knitr::opts_chunk$set(echo = TRUE, message = F)
# grab the metaphlan results for this project
fns <- list.files('../data/shotgun_output/', pattern = '12898', full.names = T)
# organize the meta table
# AVOID ALL SPACES. replace the space with underscores
meta <- read_csv('../data/Stool_mice_Fiber_Days1.7.14_JP_VDB_1.26.22.csv') %>%
rename(sampleid = `Tube ID`) %>%
separate(`Mice group`, into = c('grp','fiber'), sep = ' \\+ ') %>%
rename_all(~ gsub(" ", "_", .)) %>%
mutate(fiber = str_replace(fiber, ' fiber',''),
grp = str_replace(grp, ' ','_'))
knitr::opts_chunk$set(echo = TRUE, message = F)
library(tidyverse)
library(ggpubr)
library(vegan)
dir <- '/Volumes/vandenBrinkLab/Diet-Microbiome Projects/Dietary Fiber/Shotgun Data/'
# organize the meta table
# AVOID ALL SPACES. replace the space with underscores
meta <- read_csv('../data/Stool_mice_Fiber_Days1.7.14_JP_VDB_1.26.22.csv') %>%
rename(sampleid = `Tube ID`) %>%
separate(`Mice group`, into = c('grp','fiber'), sep = ' \\+ ') %>%
rename_all(~ gsub(" ", "_", .)) %>%
mutate(fiber = str_replace(fiber, ' fiber',''),
grp = str_replace(grp, ' ','_'))
# grab the metaphlan results for this project
fns <- list.files('../data/shotgun_output/', pattern = '12898', full.names = T)
taxa <- fns %>%
set_names(fns) %>%
map(~ read_tsv(., skip = 4, col_types = 'ccddd') %>%
rename(clade_name = names(.)[1]) %>%
select(clade_name, relative_abundance) %>%
filter(str_detect(clade_name, 's__')) %>%
mutate(relative_abundance = relative_abundance/100)) %>%
bind_rows(.id = 'sampleid') %>%
mutate(sampleid = str_replace(sampleid, '../data/shotgun_output//Sample_',''),
sampleid = str_replace(sampleid, '_IGO_12898.+$',''))
taxa %>% write_csv(file.path(dir, 'Mouse/metaphlan_results_fraction.csv'))
cts <- taxa %>%
spread(key = 'clade_name', value = 'relative_abundance', fill = 0) %>%
column_to_rownames('sampleid')
meta_mouse <- diversity(cts, index = 'inv') %>%
enframe(name = 'sampleid', value = 'inv') %>%
inner_join(meta)  %>%
mutate(fiber = factor(fiber, levels = c('0%','12%','40%')))
meta_mouse %>%
write_csv(file.path(dir, 'Mouse/pheno_with_alpha_diversity.csv'))
# visualize the diversity comparison in different groups
all_alpha <- meta_mouse %>%
ggboxplot(x = 'fiber', y = 'inv', add = 'dotplot', ylab = 'inverse simpson',
add.params = list(color = 'forestgreen', size = 2, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
ggsave(file.path(dir, 'Mouse/results/alpha_comparison.jpg'), width = 5, height = 8, plot = all_alpha)
# for the BM only group what is the p value
bm_alpha <- meta_mouse %>%
filter(grp == 'BM_only') %>%
ggboxplot(x = 'fiber', y = 'inv', add = 'dotplot', ylab = 'inverse simpson',
add.params = list(color = 'forestgreen', size = 2, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(
c('12%', '40%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
ggsave(file.path(dir, 'Mouse/results/alpha_comparison_BM_only.jpg'), width = 2.5, height = 8, plot = bm_alpha)
