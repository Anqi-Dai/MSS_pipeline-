---
title: "beta diversity visualization"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ape)
library(vegan)
library(ggpubr)
```

Check the beta distance matrix

```{r}
beta_un_uni <- read.delim('../data/finalized/beta_phylo/distance-matrix.tsv', sep = '\t', row.names = 1)
food_dist <- as.dist(beta_un_uni)

#pcoa
pcoa_f <- as.data.frame(pcoa(food_dist)$vectors) %>% 
  select(Axis.1, Axis.2) %>% 
  rownames_to_column('mrnDay') %>% 
  separate(mrnDay, into = c('mrn','DayRT'), sep = 'd') %>% 
  mutate(DayRT = str_replace(DayRT,'_','-'),
         DayRT = as.numeric(DayRT),
         mrn = as.numeric(mrn))
```

```{r}
# load the pheno data of the patients 
pheno <- read_csv('../data/pheno/final_pheno.csv')

# join the coords with the pheno
beta_un_uni_df <- pcoa_f %>% 
  left_join(pheno, by  = 'mrn')
```


```{r}
# plot
beta_un_uni_df %>% 
  mutate(mrn = factor(as.character(mrn))) %>% 
ggplot( aes(x = Axis.1, y = Axis.2, fill = mrn)) +
  geom_point(color = "#5a2071",alpha=0.75, size = 2) +
  stat_ellipse(color = "dark grey", type = "norm", linetype = 2, level = 0.95, alpha = 0.5) +
  theme_classic() +
  theme(legend.position = 'none')


```



```{r}
# split by each patient and color by day 

beta_un_uni_df %>% 
  ggplot(aes(x = Axis.1, y = Axis.2, color = DayRT, shape = intensity)) +
  geom_point(size = 2) +
  scale_color_continuous(type = 'viridis') +
  theme_classic() +
  facet_wrap(source~ mrn)

```



