---
title: "Compile the most comprehensive meta pheno table"
output: html_document
--- 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```


```{r}
# create a meta data table so that I can qiime view with the unifrac distance table
# the dietID gonna be my sampleid

pheno <- read_csv('../data/pheno/final_pheno.csv')

faith <- read_csv('../data/finalized/alpha_faith_daily_all.csv') %>% 
  left_join(link, by = 'mrn') %>% 
  mutate(DayRT = as.character(DayRT)) %>% 
  mutate(DayRT = str_replace(DayRT, '-','_')) %>% 
  mutate(dietID = str_glue('{pt}d{DayRT}')) 

en <- read_csv('../data/finalized/TPN_EN_all.csv') %>% 
  # just color by the mrn that is either en or tpn
  distinct(mrn, type) %>% 
  distinct(mrn, .keep_all = T)

tpns <- en %>% 
  filter(type == 'TPN') %>% 
  pull(mrn)

ens <- en %>% 
  filter(type == 'EN') %>% 
  pull(mrn)

meta <- final %>% 
  distinct(dietID, mrn, DayRT) %>% 
  left_join(pheno, by  = 'mrn') %>% 
  full_join(faith %>% 
              select(dietID, faith_pd), by = 'dietID') %>% 
  # change the first column name to work on qiime
  rename(`#SampleID` = names(.)[1]) %>% 
  rename(foodDayRT = DayRT) %>% 
  # change back the foodDayRT to be numeric
  mutate(foodDayRT = str_replace(foodDayRT,'_','-')) %>% 
  mutate(foodDayRT = as.numeric(foodDayRT)) %>% 
  mutate(entronutri = if_else(mrn %in% ens, "EN", 
                              if_else(mrn %in% tpns, "TPN", 'none')))


meta  %>% 
  write_tsv('../data/finalized/meta_data_67.tsv')



```
