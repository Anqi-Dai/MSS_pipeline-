---
title: "for tct figures"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggpubr)
```

```{r}
ptb <- read_csv('../data/cleaned_patients/diet_patients_97.csv')

meta <- read_csv('../data/cleaned_stool/all_samples_meta_p2d_fg9_updated.csv') %>% 
  mutate(timebin = cut_width(sdrt, 7, boundary=0, closed = 'left')) %>% 
  mutate(intensity = factor(intensity, levels = c('nonablative','reduced','ablative')))

faith <- read_tsv('../data/cleaned_diet_data/FINAL_97_faith_pd/alpha-diversity.tsv') %>% 
  separate(X1, into = c('mrn', 'fdrt'), sep = 'd', convert = T)  %>% 
  mutate(mrn = as.numeric(str_replace(mrn, 'P',''))) 
```

```{r}
alpha_val <- 0.2
cal_ <- meta %>% 
  ggscatter(x = 'sdrt', y = 'ave_cal', alpha = alpha_val, 
            xlab = '',
            ylab = 'Caloric intake',
            add = "loess", color = 'maroon',
            add.params = list(color = "brown", fill = "darkgray", size = 2), 
            conf.int = TRUE) +
  xlim(-10, 50) +
  scale_x_continuous(breaks = seq(-10, 50, 10)) + theme(aspect.ratio=1)
cal_
```

```{r}
diet_alpha <- faith %>% 
  ggscatter('fdrt', 'faith_pd', 
             alpha = alpha_val,
            color = 'forestgreen',
            #size = 1,
            ylab = 'Diet alpha diversity', 
            xlab = '',
            title = '',
            add = "loess", 
            add.params = list(color = "darkgreen", fill = "darkgray", size = 2), 
            conf.int = TRUE) +
  xlim(-10, 50)+
  scale_x_continuous(breaks = seq(-10, 50, 10)) +
  #scale_color_gradient2(midpoint = mid, low = "black", mid = "cornflowerblue", high = "red", space = "Lab", name = 'Diet\nalpha\ndiversity' )+
  theme(legend.position = c(20,2000)) + theme(aspect.ratio=1)
diet_alpha
```

```{r}
stool_alpha <- meta %>% 
  mutate(log_div = log(simpson_reciprocal)) %>% 
  ggscatter(x = 'sdrt', y = 'simpson_reciprocal', alpha = alpha_val, 
            xlab = 'Day relative to transplant',
            ylab = 'Microbiome alpha diversity',
            add = "loess", color = 'darkgoldenrod',
            add.params = list(color = "darkgoldenrod4", fill = "darkgray", size = 2), 
            conf.int = TRUE) +
  xlim(-10, 50) +
  scale_x_continuous(breaks = seq(-10, 50, 10)) + theme(aspect.ratio=1)
stool_alpha
```

```{r}
alpha <- plot_grid(cal_, diet_alpha, stool_alpha, 
          nrow = 3, 
          align = 'hv',
          #rel_heights = c(1,1),
          axis = 'blrt')  +
  ggsave('../figs/alhpa_ch.pdf', width = 10, height = 9)
alpha 
```

