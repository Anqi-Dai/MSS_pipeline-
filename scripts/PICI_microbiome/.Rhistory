distinct(genus)
genera %>%
write_csv('../data/03_amadeus_genus_perc.csv')
genera %>%
ungroup() %>%
distinct(genus)
spp
family <- spp %>%
mutate(fami = str_replace(clade_name, '\\|g__.+$','')) %>%
group_by(sampleid, fami) %>%
summarise(relab = sum(perc))
View(family)
family <- spp %>%
mutate(family = str_replace(clade_name, '\\|g__.+$','')) %>%
group_by(sampleid, family) %>%
summarise(relab = sum(perc))
family <- spp %>%
mutate(family = str_replace(clade_name, '\\|g__.+$','')) %>%
group_by(sampleid, family) %>%
summarise(relab = sum(perc))
family %>%
write_csv('../data/03_amadeus_family_perc.csv')
spp %>%
write_csv('../data/03_amadeus_species_perc.csv')
family %>%
ungroup() %>%
distinct(family)
family
family %>%
mutate(fam = str_extract(family, 'f__.+$'))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
select(sampleid, fam, perc)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
select(sampleid, fam, relab)
family %>%
mutate(fam = str_extract(family, 'f__.+$'))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
select(sampleid, fam, relab)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
select(sampleid, fam, relab) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) , stat = 'identity')
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
select(sampleid, fam, relab) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
?fct_reorder
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F))
tt <- family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F))
View(tt)
levels(tt$fam)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
#compute hierarchical cluster
hc <- hclust(dist_, method = 'complete')
dend <- as.dendrogram(hc)
#compute hierarchical cluster
hc <- hclust(dist_, method = 'complete')
#compute hierarchical cluster
hc <- hclust(dist_, method = 'complete')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
?hclust
#compute hierarchical cluster
hc <- hclust(dist_, method = 'ward.D')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 10, height = 10)
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
#compute hierarchical cluster
hc <- hclust(dist_, method = 'average')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
#compute hierarchical cluster
hc <- hclust(dist_, method = 'centroid')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
#compute hierarchical cluster
hc <- hclust(dist_, method = 'single')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
#compute hierarchical cluster
hc <- hclust(dist_, method = 'complete')
dend <- as.dendrogram(hc)
sample_dendogram_order <- labels(dend)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
family <- spp %>%
mutate(family = str_replace(clade_name, '\\|g__.+$','')) %>%
group_by(sampleid, family) %>%
summarise(relab = sum(perc)) %>%
mutate(fam = str_extract(family, 'f__.+$'))
family
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid")
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit)
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free')
ggsave('../figs/03_family_bar.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free')
ggsave('../figs/03_family_bar_visit.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
theme( axis.text.x = element_text(angle=45, hjust=1)) +
facet_wrap(~ Visit, scales = 'free')
ggsave('../figs/03_family_bar_visit.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_visit.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=1))
ggsave('../figs/03_family_bar_visit.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ Visit, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_visit.pdf', width = 15, height = 5)
View(meta_amadeus)
family
colnames(meta_amadeus)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ ORR_Responder, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_ORR_Responder.pdf', width = 15, height = 5)
# split by conversion
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ CD8_Conversion_Hot_to_Cold, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_CD8_Conversion_Hot_to_Cold.pdf', width = 15, height = 5)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sampleid = factor(sampleid, levels = sample_dendogram_order)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 5)
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
# split by patients
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
mutate(sid = sid(sid, sid,  .desc = F)) %>%
ggplot(aes(x = sampleid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
#mutate(sid = sid(sid, sid,  .desc = F)) %>%
ggplot(aes(x = sid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
# split by patients
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggplot(aes(x = sid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
# split by patients
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggplot(aes(x = sid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggplot(aes(x = sid, y = relab, fill = fam) ) +
geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}')) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1))
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1)) +
ggpar(legend = 'right')
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' , label = T) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' , label = 'fam') +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' , label = 'fam') +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' , label = .$fam) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_pid.pdf', width = 15, height = 15)
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
pull(levels(sid))
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ pid, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
family %>%
mutate(fam = str_extract(family, 'f__.+$')) %>%
mutate(fam = fct_reorder(fam, family,  .desc = F)) %>%
left_join(meta_amadeus, by = "sampleid") %>%
mutate(sid = str_glue('{pid}__{Visit}'),
sid = factor(sid)) %>%
ggbarplot(x = 'sid', y = 'relab', fill = 'fam', color = 'white' ) +
#geom_bar( stat = 'identity') +
facet_wrap(~ CD8_Conversion_Hot_to_Cold, scales = 'free') +
theme( axis.text.x = element_text(angle=45, hjust=1),
legend.position = 'right')
ggsave('../figs/03_family_bar_CD8_Conversion_Hot_to_Cold.pdf', width = 15, height = 15)
ggsave('../figs/03_family_bar_CD8_Conversion_Hot_to_Cold.pdf', width = 15, height = 5)
