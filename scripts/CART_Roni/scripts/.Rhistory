library(tidyverse)
load('./2022_9_13.rdata')
load('../data/2022_9_13.rdata')
View(codebook)
View(data)
View(df_lab)
View(df_msk)
library(tidyverse)
load('../data/2022_9_13.rdata')
View(data)
colnames(df_msk)
View(df_lab)
summary(df_msk$dx.factor)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
View(asv_alpha_diversity_ag)
get_table_from_database("samples_castori_ag")
View(samples_castori_ag)
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
df_msk_filt <-  df_msk %>%
filter(!is.na(dx)) %>%  # only patients with complete information on disease
filter(dx.factor %in% lbcl_inclusion) %>%  # took out PCNSL
mutate(dt_car_t = lubridate:: ymd (dt_car_t))
# define the group of LBCL
lbcl_inclusion <- c("DLBCL NOS", "High-grade B-cell lymphoma with MYC and BCL2 and/or BCL6 rearrangement",
"High-grade B-cell lymphoma, NOS", "Primary mediastinal B-cell lymphoma",
"T-cell rich DLBCL",
"Intravascular large B-cell lymphoma", "EBV-positive DLBCL",
"Primary cutaneous DLBCL, leg type","DLBCL associated with chronic inflammation",
"ALK positive large B-cell lymphoma",
"Plasmablastic lymphoma",
"Large B-cell lymphoma arising in HHV8-associated multicentric Castleman Disease",
"High-grade B-cell lymphoma with 11q aberrations", "Large B-cell lymphoma with IRF4 rearrangement")
df_msk_filt <-  df_msk %>%
filter(!is.na(dx)) %>%  # only patients with complete information on disease
filter(dx.factor %in% lbcl_inclusion) %>%  # took out PCNSL
mutate(dt_car_t = lubridate:: ymd (dt_car_t))
# merge clinical data with sample data + filter to day -40 to 60
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
ymd <- lubridate::ymd
library(speedyseq)
library(vdbR)
library(phyloseq)
library(patchwork)
# One-time configuration of the MSK RStudio Package Manager
# install.packages("rstudio.prefs")
# rstudio.prefs::use_rstudio_secondary_repo(
#   MSK_RSPM = "http://rspm.mskcc.org/MSKREPO/latest"
# )
# install.packages("biostatR")
library(biostatR)
install.packages("biostatR")
# merge clinical data with sample data + filter to day -40 to 60
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
View(samples)
# define the group of LBCL
lbcl_inclusion <- c("DLBCL NOS", "High-grade B-cell lymphoma with MYC and BCL2 and/or BCL6 rearrangement",
"High-grade B-cell lymphoma, NOS", "Primary mediastinal B-cell lymphoma",
"T-cell rich DLBCL",
"Intravascular large B-cell lymphoma", "EBV-positive DLBCL",
"Primary cutaneous DLBCL, leg type","DLBCL associated with chronic inflammation",
"ALK positive large B-cell lymphoma",
"Plasmablastic lymphoma",
"Large B-cell lymphoma arising in HHV8-associated multicentric Castleman Disease",
"High-grade B-cell lymphoma with 11q aberrations", "Large B-cell lymphoma with IRF4 rearrangement", "Mantle Cell Lymphoma")
# define the group of LBCL
lbcl_inclusion <- c("DLBCL NOS", "High-grade B-cell lymphoma with MYC and BCL2 and/or BCL6 rearrangement",
"High-grade B-cell lymphoma, NOS", "Primary mediastinal B-cell lymphoma",
"T-cell rich DLBCL",
"Intravascular large B-cell lymphoma", "EBV-positive DLBCL",
"Primary cutaneous DLBCL, leg type","DLBCL associated with chronic inflammation",
"ALK positive large B-cell lymphoma",
"Plasmablastic lymphoma",
"Large B-cell lymphoma arising in HHV8-associated multicentric Castleman Disease",
"High-grade B-cell lymphoma with 11q aberrations", "Large B-cell lymphoma with IRF4 rearrangement", "Mantle Cell Lymphoma")
df_msk_filt <-  df_msk %>%
filter(!is.na(dx)) %>%  # only patients with complete information on disease
filter(dx.factor %in% lbcl_inclusion) %>%  # took out PCNSL
mutate(dt_car_t = lubridate:: ymd (dt_car_t))
# merge clinical data with sample data + filter to day -40 to 60
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
View(samples)
new <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1157'))
View(new)
length(intersect(samples$sampleid, new$sampleid))
View(df_msk_filt)
View(df_msk_filt)
df_lab_sample <- samples %>%
select(record_id) %>%
group_by(record_id) %>%
slice(1) %>%
ungroup() %>%
left_join(df_lab %>%
select(record_id,performed_dte, lab, result_value, unit_measure:lower_limit, day_rel_car, day_rel_ld ), by ="record_id") %>%
mutate(result_value = as.numeric(result_value)) %>%
set_variable_labels(
performed_dte = "Lab date",
result_value = "Value",
unit_measure = "Unit",
day_rel_car = "Day relative to CAR-T",
day_rel_ld = "Day relative to lymphodepletion") %>%
filter(between(day_rel_car,-20, 365))   # filter time of car-t
# this is gonna be the table that has the finalized patient cohort
df_msk_filt <-  df_msk %>%
filter(!is.na(dx)) %>%  # only patients with complete information on disease
filter(dx.factor %in% lbcl_inclusion) %>%  # took out PCNSL
mutate(dt_car_t = lubridate:: ymd (dt_car_t))
View(df_msk_filt)
new <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1157'))
View(new)
View(samples_castori_ag)
newpt <- new %>% inner_join(samples_castori_ag %>% select(mrn, sampleid))
View(newpt)
library(tidyverse)
---
title: "Microbiome Exploratory LBCL 2022-09-13"
load('../data/2022_9_13.rdata')
# define the group of LBCL
lbcl_inclusion <- c("DLBCL NOS", "High-grade B-cell lymphoma with MYC and BCL2 and/or BCL6 rearrangement",
"High-grade B-cell lymphoma, NOS", "Primary mediastinal B-cell lymphoma",
"T-cell rich DLBCL",
"Intravascular large B-cell lymphoma", "EBV-positive DLBCL",
"Primary cutaneous DLBCL, leg type","DLBCL associated with chronic inflammation",
"ALK positive large B-cell lymphoma",
"Plasmablastic lymphoma",
"Large B-cell lymphoma arising in HHV8-associated multicentric Castleman Disease",
"High-grade B-cell lymphoma with 11q aberrations", "Large B-cell lymphoma with IRF4 rearrangement", "Mantle Cell Lymphoma")
# added the "Mantle Cell Lymphoma" 8 additional samples
# this is gonna be the table that has the finalized patient cohort
df_msk_filt <-  df_msk %>%
filter(!is.na(dx)) %>%  # only patients with complete information on disease
filter(dx.factor %in% lbcl_inclusion) %>%  # took out PCNSL
mutate(dt_car_t = lubridate:: ymd (dt_car_t))
get_table_from_database("samples_castori_ag")
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
get_table_from_database("samples_castori_ag")
# merge clinical data with sample data + filter to day -40 to 60
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
library(lubridate)
library(vdbR)
connect_database()
get_table_from_database('asv_alpha_diversity_ag')
get_table_from_database("samples_castori_ag")
# merge clinical data with sample data + filter to day -40 to 60
samples <- samples_castori_ag %>%
mutate(mrn=str_pad(mrn, pad = "0", width = 8)) %>%
filter(grepl("stool", sampletype, ignore.case = TRUE)) %>%
select(mrn, sampleid, datecollection, consistency, sampletype) %>%
inner_join(df_msk_filt,  by=c("mrn"))%>%
#  inner_join(df_msk_filt %>% select(mrn,record_id, dx.factor, dt_car_t,ind_aph_cart_d, crs.factor, objres_100,everCR_100, icans.factor, dur_neut_d, bestres_3lvl_100, everCR_100), by=c("mrn"))%>%
mutate(dr_car = as.numeric(ymd(datecollection) - ymd(dt_car_t))) %>%
filter(dr_car > -40 & dr_car <= 100)
# figure out what are the most recently sequenced samples in the pool1157
new <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1157'))
newpt <- new %>% inner_join(samples_castori_ag %>% select(mrn, sampleid))
View(newpt)
# figure out what are the most recently sequenced samples in the pool1157
new <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1157'))
new <- asv_alpha_diversity_ag %>%
filter(str_detect(oligos_id, 'pool1157'))
View(new)
newpt <- new %>% left_join(samples_castori_ag %>% select(mrn, sampleid))
View(newpt)
View(newpt)
View(new)
View(newpt)
library(vdbR)
connect_database()
connect_database()
