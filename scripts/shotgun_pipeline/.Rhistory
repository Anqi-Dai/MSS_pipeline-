add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
subcazy <- cazy %>%
inner_join(sub) %>%
filter(NumberofTools == 2)
subcazy %>%
count(fiber, sampleid,Day, grp ) %>%
ggboxplot(x = 'fiber', y = 'n', add = 'dotplot', ylab = 'count of cazyme',
add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
subcazy <- cazy %>%
inner_join(sub) %>%
filter(NumberofTools == 3)
subcazy %>%
count(fiber, sampleid,Day, grp ) %>%
ggboxplot(x = 'fiber', y = 'n', add = 'dotplot', ylab = 'count of cazyme',
add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
ggsave('../data/14_fiber_sub_total_cazyme.pdf')
ggsave('../data/14_fiber_sub_total_cazyme.pdf', height = 5)
subcazy %>%
count(fiber, sampleid,Day, grp ) %>%
ggboxplot(x = 'fiber', y = 'n', add = 'dotplot', ylab = 'count of cazyme',
add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
subcazy %>%
count(fiber, sampleid,Day, grp ) %>%
ggboxplot(x = 'fiber', y = 'n', add = 'dotplot', ylab = 'Number of cazymes',xlab = 'Fiber content',
add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
subcazy %>%
count(fiber, sampleid,Day, grp ) %>%
ggboxplot(x = 'fiber', y = 'n', add = 'dotplot', ylab = 'Number of cazymes',xlab = 'Fiber content',
add.params = list(color = 'forestgreen', size = 1.5, alpha = 1, shape = 20)) +
facet_grid(Day ~ grp)  +
stat_compare_means(comparisons= list(c('12%', '40%'),
c('0%', '12%'),
c('40%', '0%')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE) +
theme_bw()
ggsave('../data/14_fiber_sub_total_cazyme.pdf', height = 5)
View(test)
View(look)
test <- fiber %>%
filter(sampleid == 'CO11302') %>%
mutate(cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
View(test)
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
)
View(subsummarized)
View(subsummarized[["CO11409"]])
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
) %>%
bind_rows()
View(subsummarized)
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
)
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
) %>%
bind_rows()
subsummarized
look <- subsummarized %>%
count(cazymes, sort = T)
View(look)
subcategory <- subsummarized %>%
mutate(cazygroup = str_replace(cazymes, '\\d+$',''))
View(subcategory)
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
) %>%
bind_rows() %>%
mutate(cazygroup = str_replace(cazymes, '\\d+$',''))
subsummarized
subsummarized <- subcazy %>%
split(.$sampleid) %>%
map(function(df){
mutate(.data = df,cazyme = eCAMI) %>%
relocate(cazyme, .after = projectid) %>%
mutate(cazyme = str_replace_all(cazyme, '\\+',',')) %>%
group_by(sampleid, fiber, Day, grp) %>%
summarise(all_cazyme = str_c(cazyme, collapse = ",")) %>%
ungroup() %>%
tibble(cazymes = str_split(all_cazyme, ',')[[1]]) %>%
select(-all_cazyme)
}
) %>%
bind_rows() %>%
mutate(cazygroup = str_replace(cazymes, '\\d+$',''))
subsummarized
subsummarized
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup)
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(Day ~ grp, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
View(sub)
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup', facet.by = 'fiber') +
facet_grid(Day ~ grp, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup', facet.by = 'fiber') +
#facet_grid(Day ~ grp, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(fiber ~ ., scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(. ~ fiber, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup',
facet.by = 'fiber') +
#facet_grid(. ~ fiber, scales = 'free') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup)
subfaction <- subsummarized %>%
count(sampleid,fiber,  Day, grp, cazygroup)
View(subfaction)
subfaction
sample_total <- subfaction %>%
group_by(sampleid) %>%
summarise(total = sum(n))
subfaction
sample_total
sub_fra <- subfaction %>%
left_join(sample_total)
sub_fra
sub_fra <- subfaction %>%
left_join(sample_total) %>%
mutate(fraction = round(n/total, 2))
View(sub_fra)
sub_fra
sub_fra %>%
select(-total)
sub_fra %>%
select(-total)
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:fraction)
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:fraction) %>%
ggbarplot(x = 'sampleid', y = 'n', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber) +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:fraction) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber) +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:fraction) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra <- subfaction %>%
left_join(sample_total) %>%
mutate(fraction = round(n/total))
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:fraction) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra <- subfaction %>%
left_join(sample_total) %>%
mutate(perc = round(n/total*100))
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:perc) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
sub_fra <- subfaction %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100))
sub_fra
sub_fra <- subfaction %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100))
sub_fra %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazygroup', color = 'white' , xlab = '', ylab = 'cazygroup') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
ggsave('../data/14_fiber_sub_catetory_cazyme.pdf', height = 5)
ggsave('../data/14_fiber_sub_catetory_cazyme.pdf', height = 7)
ggsave('../data/14_fiber_sub_catetory_cazyme.pdf', height = 5)
View(subsummarized)
View(subsummarized)
subsummarized
View(sub_fra)
subsummarized
subsummarized %>%
count(sampleid, cazymes)
top_n(3, wt = n)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
select(-total)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent)
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid, fiber) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, cazymes) %>%
group_by(sampleid, fiber)
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n)
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
check <- subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n)
View(check)
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(3, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(vegan)
# organize the meta table
# AVOID ALL SPACES. replace the space with underscores
meta <- read_csv('../data/Stool_mice_Fiber_Days1.7.14_JP_VDB_1.26.22.csv') %>%
rename(sampleid = `Tube ID`) %>%
separate(`Mice group`, into = c('grp','fiber'), sep = ' \\+ ') %>%
rename_all(~ gsub(" ", "_", .)) %>%
mutate(fiber = str_replace(fiber, ' fiber',''),
grp = str_replace(grp, ' ','_'))
?top_n
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(5, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(5, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes', palette = 'lancet') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(5, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes', palette = 'jco') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(5, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes', palette = 'jco') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
subsummarized %>%
count(sampleid, fiber, cazymes) %>%
group_by(sampleid) %>%
top_n(5, wt = n) %>%
left_join(sample_total) %>%
mutate(percent = round(n/total*100)) %>%
select(-total) %>%
gather('type', 'value', n:percent) %>%
ggbarplot(x = 'sampleid', y = 'value', fill = 'cazymes', color = 'white' , xlab = '', ylab = 'cazymes', palette = 'jco') +
facet_grid(type ~ fiber, scales = 'free_y') +
theme( axis.text.x = element_text(angle=90, hjust=0, size = 6.5),
legend.position = 'bottom')
ggsave('../data/14_fiber_sub_top5_cazyme.pdf', height = 5)
View(test)
View(fiber)
