mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
# figure out the lower gi patients
allpt_gvhd_all <- allpt_gvhd %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
View(allpt_gvhd_all)
allpt_gvhd_all %>% count(grp)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
allpt_gvhd
# to look at the gvhd info and put them to the 4 groups as Marina suggested
allpt_gvhd <- allpt %>%
mutate(d100_a_gvhd = if_else(d100_a_gvhd == 'NE', 'N/E', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'N', 'No', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'Y', 'Yes', d100_a_gvhd)) %>%
filter(d100_a_gvhd %in% c('Yes','No'))
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
allpt_gvhd_all %>% count(grp)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
# join with gvhd info of the patients
allpt <- read_csv('../../food_tree/data/156_transplant_data.csv')
View(allpt)
# join with gvhd info of the patients
allpt <- read_csv('../../food_tree/data/156_transplant_data.csv')
# to look at the gvhd info and put them to the 4 groups as Marina suggested
allpt_gvhd <- allpt %>%
mutate(d100_a_gvhd = if_else(d100_a_gvhd == 'NE', 'N/E', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'N', 'No', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'Y', 'Yes', d100_a_gvhd)) %>%
filter(d100_a_gvhd %in% c('Yes','No'))
View(allpt_gvhd)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
allpt_gvhd_all %>% count(grp)
View(allpt_gvhd_all)
View(allpt_gvhd_all)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp)
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt))
View(allpt_gvhd_all)
allpt_gvhd_all. %>% write_csv('../data/11_samples_from_groups.csv')
allpt_gvhd_all %>% write_csv('../data/11_samples_from_groups.csv')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
# join with gvhd info of the patients
allpt <- read_csv('../../food_tree/data/156_transplant_data.csv')
# to look at the gvhd info and put them to the 4 groups as Marina suggested
allpt_gvhd <- allpt %>%
mutate(d100_a_gvhd = if_else(d100_a_gvhd == 'NE', 'N/E', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'N', 'No', d100_a_gvhd),
d100_a_gvhd = if_else(d100_a_gvhd == 'Y', 'Yes', d100_a_gvhd)) %>%
filter(d100_a_gvhd %in% c('Yes','No'))
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
allpt_gvhd_all %>% count(grp)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
View(allpt_gvhd_all)
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
View(allpt)
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt))
View(allpt_gvhd_all)
library(vdbR)
connect_database()
connect_database()
list_table_from_database()
list_table_from_database('fmt')
get_table_from_database('fmt_arm_ag')
View(fmt_arm_ag)
fmt_arm_ag
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
inner_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date))
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date))
allpt_gvhd
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date))
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(fmtday = as.numeric(fmt_procedure_date - hct))
allpt_gvhd_all
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(hct = ymd(hct),
fmtday = as.numeric(fmt_procedure_date - hct))
allpt_gvhd_all
allpt_gvhd_all %>% count(grp)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(hct = ymd(hct),
fmtday = as.numeric(fmt_procedure_date - hct))
allpt_gvhd_all %>% count(grp)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(hct = ymd(hct),
fmtday = as.numeric(fmt_procedure_date - hct))
allpt_gvhd_all %>% count(grp)
View(allpt_gvhd_all)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
))
allpt_gvhd_all %>% count(grp)
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(hct = ymd(hct),
fmtday = as.numeric(fmt_procedure_date - hct)) %>%
mutate(grp = if_else(grp %in% c('non_gi','upper_gi'), 'exclu_lower_gi', grp))
allpt_gvhd_all <- allpt_gvhd %>%
filter(source != 'TCD') %>%
mutate(grp = case_when(
d100_a_gvhd == 'No' ~ "no_gvhd",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage == 0 & d100_lower_gi_stage == 0 ~ "non_gi",
d100_a_gvhd == 'Yes' & d100_upper_gi_stage != 0 & d100_lower_gi_stage == 0  ~ "upper_gi",
d100_a_gvhd == 'Yes' &  d100_lower_gi_stage != 0  ~ "lower_gi",
.default = NA
)) %>%
select(mrn, source, grp, hct) %>%
inner_join(meta %>% select(mrn, sampleid, sdrt)) %>%
left_join(fmt_arm_ag %>% select(mrn, fmt_procedure_date)) %>%
mutate(hct = ymd(hct),
fmtday = as.numeric(fmt_procedure_date - hct)) %>%
mutate(grp = if_else(grp %in% c('non_gi','upper_gi'), 'exclu_lower_gi', grp))
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
left_join(allpt %>% select(mrn, source))
type <- read_csv('../data/10_patients_foods_fiber_type_all.csv')
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
left_join(allpt %>% select(mrn, source))
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'blue'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_with_TCD.pdf', width = 4, height = 4)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd)) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'd100_a_gvhd'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
inner_join(allpt_gvhd_all %>% select(mrn, grp)) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
tcd_pt <- allpt %>%
filter(source == 'TCD') %>%
pull(mrn)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
inner_join(allpt_gvhd_all %>% select(mrn, grp)) %>%
filter(!mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'd100_a_gvhd'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
inner_join(allpt_gvhd_all %>% select(mrn, grp)) %>%
filter(!mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_without_TCD_gvh.pdf', width = 4, height = 4)
dailytotaldry <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(alldry = sum(dehydrated_weight))
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)])%>%
left_join(allpt %>% select(mrn, source))
all_types %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
all_types %>%
inner_join(allpt_gvhd_all) %>%
filter(fdrt %in% -10:30 & ! mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
all_types
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
inner_join(allpt_gvhd_all)
View(dailycode)
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
inner_join(allpt_gvhd_all)
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
inner_join(allpt_gvhd_all)
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
inner_join(allpt_gvhd_all)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
inner_join(allpt_gvhd_all %>% select(mrn, grp)) %>%
filter(!mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_without_TCD_gvh.pdf', width = 4, height = 4)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
filter(!mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'blue'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_without_TCD.pdf', width = 4, height = 4)
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)])%>%
inner_join(allpt_gvhd_all %>% select(mrn, source))
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)])%>%
inner_join(allpt_gvhd_all %>% select(mrn, source))
all_types %>%
filter(fdrt %in% -10:30 & ! mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_without_TCD.pdf', width = 15, height = 5)
View(all_types)
View(dailycode)
View(dailycode)
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble')
View(dailycode)
View(allpt_gvhd)
