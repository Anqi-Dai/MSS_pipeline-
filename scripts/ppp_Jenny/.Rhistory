summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
left_join(pts %>% select(mrn, d100_a_gvhd))
View(dailycode)
# new pts
pts <- read_csv('../data/selected_pts.csv')
View(pts)
# new pts
pts <- read_csv('../data/selected_pts.csv') %>%
filter(!is.na(mrn))
pts
pts <- read_csv('../../food_tree/data/156_transplant_data.csv')
# join with gvhd info of the patients
allpt <- read_csv('../../food_tree/data/156_transplant_data.csv') %>%
mutate(d100_a_gvhd = if_else(d100_a_gvhd == 'NE', 'N/E', d100_a_gvhd))
allpt
# new pts
pts <- read_csv('../data/selected_pts.csv') %>%
filter(!is.na(mrn)) %>% inner_join(allpt)
allpt
allpt
allpt
allpt
# new pts
pts <- read_csv('../data/selected_pts.csv') %>%
filter(!is.na(mrn)) %>% inner_join(allpt)
View(pts)
dailyfgfiber <-  DTB %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
group_by(mrn, fdrt, fgrp1) %>%
summarise(dfgfiber = sum(Fibers_g))
View(dailyfgfiber)
dailyfgfiber <-  DTB %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
group_by(mrn, fdrt, fgrp1) %>%
summarise(dfgfiber = sum(Fibers_g)) %>%
left_join(pts %>% select(mrn, d100_a_gvhd)) %>%
left_join(key %>% select(fgrp1, shortname))
key <- read_csv('../../food_tree/data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
key <- read_csv('../../food_tree/data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
dailyfgfiber <-  DTB %>%
mutate(fgrp1 = str_sub(Food_code, 1, 1)) %>%
group_by(mrn, fdrt, fgrp1) %>%
summarise(dfgfiber = sum(Fibers_g)) %>%
left_join(pts %>% select(mrn, d100_a_gvhd)) %>%
left_join(key %>% select(fgrp1, shortname))
dailyfgfiber %>%
filter( d100_a_gvhd %in% c('Y','N') & fdrt <= 30) %>%
ggscatter(x = 'fdrt', y = 'dfgfiber',  alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, ylab = 'Daily fiber intake from each group',
#title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_wrap(~ shortname, scales = 'free')
# now join a line of gvhd or not
color_key <- c('#42B440','#EC0000')
dailyfgfiber %>%
filter( d100_a_gvhd %in% c('Y','N') & fdrt <= 30) %>%
ggscatter(x = 'fdrt', y = 'dfgfiber',  alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, ylab = 'Daily fiber intake from each group',
#title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_wrap(~ shortname, scales = 'free')
ggsave('../data/11_daily_fiber_fg.pdf', width = 8, height = 6)
dailytotaldry <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(alldry = sum(dehydrated_weight))
View(dailytotaldry)
dailytotaldry
dailytotaldry <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(alldry = sum(dehydrated_weight))
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)])%>%
left_join(pts %>% select(mrn, d100_a_gvhd))
all_types %>% write_csv('../data/11_patients_fiber_type_intake.csv')
all_types %>%
filter(fdrt %in% -30:30) %>%
ggscatter(x = 'fdrt', y = 'fiber_perc', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type)
all_types
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)])%>%
left_join(pts %>% select(mrn, d100_a_gvhd))
all_soluble %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake.pdf', width = 6, height = 4)
# now join a line of gvhd or not
color_key <- c('#42B440','#EC0000')
all_soluble
all_soluble %>%
filter( fdrt <= 30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
all_soluble %>%
filter( fdrt <= 30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
# maybe break the fdrt down to weeks
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
# maybe break the fdrt down to weeks
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
ggboxplot(x = 'timebin', y = 'gram', add = 'jitter', add.params = list(alpha = 0.06),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
# subsample to select the median value for repeated sampling
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, d100_a_gvhd, soluble, timebin) %>%
summarise(med_week = median(gram)) %>%
ggboxplot(x = 'timebin', y = 'med_week', add = 'jitter', add.params = list(alpha = 0.3),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd_week_median.pdf', width = 8, height = 4)
all_types
all_types %>%
filter(fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_daily_intake_gvhd.pdf', width = 15, height = 4)
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
all_types %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'fiber_perc', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type)
all_types
all_types %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type)
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_daily_intake_gvhd.pdf', width = 15, height = 4)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
key <- read_csv('../../food_tree/data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
dtb1 <- read_csv('../../food_tree/data/149_finalized_dtb1.csv')
dtb2 <- read_csv('../../food_tree/data/149_finalized_dtb2.csv')
unit <- read_csv('../../food_tree/data/148_both_batches_UNIT_table_EN_exclu.csv')
DTB <- bind_rows(dtb1, dtb2)
colnames(unit)
meta <- read_csv('../../food_tree/data/153_combined_META.csv')
meta <- read_csv('../../food_tree/data/153_combined_META.csv') %>%
filter(mrn %in% pts$mrn)
meta
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera34.csv')
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv')
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)
meta %>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber.pdf')
View(all_soluble)
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N'))
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'soluble', size = 1)) +
facet_grid(~ d100_a_gvhd)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'soluble', size = 1)) +
facet_grid(~ d100_a_gvhd)  +
scale_color_manual(values = c('blue','yellow')) +
scale_fill_manual(values = c('blue','yellow'))+
scale_y_sqrt()
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'soluble', size = 1)) +
facet_grid(~ d100_a_gvhd)  +
scale_color_manual(values = c('blue','yellow')) +
scale_fill_manual(values = c('blue','yellow'))+
scale_y_sqrt()
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'soluble', size = 1)) +
facet_grid(~ d100_a_gvhd)  +
scale_color_manual(values = c('lightblue','orange')) +
scale_fill_manual(values = c('blue','yellow'))+
scale_y_sqrt()
all_soluble %>%
filter( fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'soluble', size = 1)) +
facet_grid(~ d100_a_gvhd)  +
scale_color_manual(values = c('lightblue','orange')) +
scale_fill_manual(values = c('blue','yellow'))+
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd_2.pdf', width = 6, height = 4)
View(pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber))
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber))
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber))
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber.pdf')
View(meta)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(grp = if_else(mean_fiber >= 6.5, 'high', 'low'))
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(grp = if_else(mean_fiber >= 6.5, 'high', 'low'))
meta
meta %>%
ggboxplot(x = 'grp', y = 'ave_div')
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv')
View(meta)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
mutate(grp = if_else(mean_fiber >= 6.5, 'high', 'low'))
meta %>%
ggboxplot(x = 'grp', y = 'ave_div')
meta %>%
ggboxplot(x = 'grp', y = 'ave_div')
meta %>%
ggboxplot(x = 'grp', y = 'ave_div') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100)
median_now <- median(meta$mean_fiber)
median_now
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
mutate(grp = if_else(mean_fiber >= median_now, 'high', 'low'))
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
median_now
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 0:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100)
median_now <- median(meta$mean_fiber)
median_now <- median(meta$mean_fiber)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 0:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
mutate(grp = if_else(mean_fiber >= median_now, 'high', 'low'))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber.pdf')
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100)
median_now <- median(meta$mean_fiber)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
mutate(grp = if_else(mean_fiber >= median_now, 'high', 'low'))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber.pdf')
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100)
median_now <- median(meta$mean_fiber)
median_now <- median(meta$mean_fiber)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
inner_join( pts)%>%
filter(sdrt %in% 7:21)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
mutate(grp = if_else(mean_fiber >= median_now, 'high', 'low'))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber.pdf')
meta %>%
ggboxplot(x = 'grp', y = 'ave_div', add = 'jitter') +
stat_compare_means(comparisons= list(c('high', 'low')),
label= "p.format",
method= 'wilcox.test',
correct=FALSE)
ggsave('../data/11_box_low_and_high.pdf')
