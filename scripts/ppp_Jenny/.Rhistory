spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source))
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)])
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source))
View(all_types)
# the type of the different fibers
# remove the tcd patients here!!!!!
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source))
# remove the tcd patients here!!!!!
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source))
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
# the type of the different fibers
# remove the tcd patients here!!!!!
all_types <- dailycode %>%
group_by(mrn, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(fiber_type)) %>%
spread('fiber_type','gram', fill = 0) %>%
gather('fiber_type','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_grp3.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
# with only the no gvhd and LGI
all_types %>%
filter(fdrt %in% -10:30 & grp != 'exclu_lower_gi') %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_grp2.pdf', width = 15, height = 5)
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_grp3.pdf', width = 15, height = 5)
# with only the no gvhd and LGI
all_types %>%
filter(fdrt %in% -10:30 & grp != 'exclu_lower_gi') %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_grp2.pdf', width = 15, height = 5)
# with only the no gvhd and LGI
all_types %>%
filter(fdrt %in% -10:30 & grp != 'exclu_lower_gi') %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/11_fiber_all_type_daily_intake_grp2.pdf', width = 15, height = 5)
dailycode
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
View(all_soluble)
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
all_soluble <- dailycode %>%
group_by(mrn, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup() %>%
filter(!is.na(soluble)) %>%
spread('soluble','gram', fill = 0) %>%
gather('soluble','gram', names(.)[3]:names(.)[ncol(.)]) %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source, grp))
View(all_soluble)
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake.pdf', width = 6, height = 4)
# gvhd groups
all_soluble %>%
filter(fdrt %in% -10:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_grp3.pdf', width = 6, height = 4)
all_soluble %>%
inner_join(allpt_gvhd) %>%
filter(fdrt %in% -10:30 & ! mrn %in% tcd_pt) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_without_TCD_gvh.pdf', width = 6, height = 4)
# with only two groups
all_soluble %>%
filter(fdrt %in% -10:30 & grp != 'exclu_lower_gi') %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'Transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'grp', size = 1)) +
facet_grid(~ soluble, labeller = 'label_both') +
scale_y_sqrt()
ggsave('../data/11_fiber_all_soluble_daily_intake_grp2.pdf', width = 6, height = 4)
all_types
all_types %>%
filter(fdrt %in% -10:30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
all_types %>%
filter(fdrt %in% -10:30 ) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
#inner_join(allpt_gvhd_all %>% select(mrn, grp)) %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'blue'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
dailycode
# calculate daily intake of each food code
# remove the TCD patients here!!!
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
#filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
inner_join(allpt_gvhd_all %>% distinct(mrn, source , grp))
# the above but with the gvhd info
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source, grp) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_grp3.pdf', width = 4, height = 4)
View(dailycode)
# the above but with the gvhd info only two groups
dailycode %>%
filter(fdrt %in% -10:30 & grp != 'exclu_lower_gi') %>%
group_by(mrn, fdrt, source, grp) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
ggsave('../data/11_daily_all_fiber_grp2.pdf', width = 4, height = 4)
dailycode %>%
filter(fdrt %in% -10:30) %>%
group_by(mrn, fdrt, source, grp) %>%
summarise(dayfiber = sum(dcodefiber)) %>%
ungroup() %>%
ggscatter(x = 'fdrt', y = 'dayfiber', add = "loess", conf.int = TRUE, alpha = 0.1, shape = 16,
add.params = list(color = 'grp'),
xlab = 'Transplant day', ylab = 'Daily fiber intake' ) +
scale_y_sqrt() +theme(aspect.ratio = 1)
View(meta)
meta  %>%
filter(!mrn %in% tcd_pt) %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "pearson",  label.sep = "\n")) +
theme(aspect.ratio=1)
View(allpt_gvhd_all)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "blue", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 5, height = 5)
median_now <- median(meta$mean_fiber)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 5, height = 5)
meta
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:20)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 5, height = 5)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 5, height = 5)
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',facet.by = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 5, height = 5)
meta <- read_csv('~/pipeline/scripts/food_tree/data/090_all_samples_meta_p2d_fg9_dietall_genera90.csv') %>%
filter(sdrt %in% -10:30)%>%
group_by(mrn) %>%
summarise(ave_div = mean(simpson_reciprocal),
mean_fiber = mean(ave_fiber)) %>%
mutate(mean_fiber = mean_fiber * 100) %>%
inner_join( allpt_gvhd_all %>% distinct(mrn, source, grp ))
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',facet.by = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
ggsave('../data/11_alpha_and_fiber_grp3.pdf', width = 10, height = 5)
meta  %>%
ggscatter(x = 'mean_fiber', y = 'ave_div',color = 'grp',facet.by = 'grp',
xlab = 'Prior 2 day fiber intake averaged by patient', ylab = 'microbiome alpha diversity averaged by patient',
add = "reg.line",  # Add regressin line
add.params = list(color = "grp", fill = "lightgray"), # Customize line
conf.int = TRUE, # Add confidence interval
cor.coef = TRUE, # Add correlation coefficient.
cor.coeff.args = list(method = "spearman",  label.sep = "\n")) +
theme(aspect.ratio=1)
View(allpt_gvhd)
colnames(allpt_gvhd)
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset))
View(ptbg)
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct))
ptbg
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct)) %>%
mutate(datecollection =hct + sdrt)
ptbg
get_table_from_database('samples_castori_ag')
samples_castori_ag
list_table_from_database('castori')
list_table_from_database('samples')
connect_database()
list_table_from_database('samples')
get_table_from_database('samples_castori_ag')
allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct))
colnames(allpt_gvhd)
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct)) %>%
inner_join(samples_castori_ag %>% select(sampleid, datecollection ))
ptbg
colnames(allpt_gvhd)
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct)) %>%
inner_join(samples_castori_ag %>% select(sampleid, datecollection )) %>%
mutate(sdronset = as.numeric(datecollection - d100_a_gvhd_onset))
ptbg
colnames(allpt_gvhd)
ptbg <- allpt_gvhd_all %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset, hct)) %>%
inner_join(samples_castori_ag %>% select(sampleid, datecollection )) %>%
mutate(d100_a_gvhd_onset = ymd(d100_a_gvhd_onset),
sdronset = as.numeric(datecollection - d100_a_gvhd_onset))
ptbg
dailycode
dailycode
dailycode %>%
inner_join(allpt_gvhd %>% select(mrn, d100_a_gvhd_onset)) %>%
inner_join(samples_castori_ag %>% select(sampleid, datecollection )) %>%
mutate(d100_a_gvhd_onset = ymd(d100_a_gvhd_onset),
sdronset = as.numeric(datecollection - d100_a_gvhd_onset))
