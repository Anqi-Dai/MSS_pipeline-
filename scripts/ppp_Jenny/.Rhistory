ggscatter(x = 'fdrt', y = 'fiber_pd', size = 0.5) +
geom_line(aes(group = mrn), color = "grey", alpha = 0.5) +
facet_wrap(~ mrn )
ggsave('../data/08_pt_fiber_day-21.pdf', width = 15, height = 15)
# see the distribution of the per day fiber eating
summary(fiber_per_day$fiber_pd)
# median for the day 0-21
fiber_per_day_day21 <- fiber_per_day %>%
filter(fdrt %in% 0:21)
summary(fiber_per_day_day21$fiber_pd)
# see what the foods are for the patients that had above 75% fiber
above0.75fiber <- fiber_per_day_day21 %>%
filter(fiber_pd >= quantile(fiber_per_day_day21$fiber_pd, 0.75))
# how many patients
above0.75fiber %>%  distinct(mrn)
# order by the number of days that are high fiber days
above0.75fiber_days <- above0.75fiber %>%
count(mrn, sort = T)
summary(above0.75fiber_days$n)
# at least 4 days of high fiber days patients
highfiber_4day <- above0.75fiber_days %>%
filter(n >= 4)
pt_order <- highfiber_4day %>%
pull(mrn)
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn) )
all_patients_groups <- bind_rows(
all_patients_groups %>% filter(!is.na(n)),
all_patients_groups %>% filter(is.na(n)) %>% mutate(n = 0)
)
all_patients_groups_fiber <- all_patients_groups %>%
mutate(fiber_grp = case_when(
n >= 4 ~ 'High',
n %in% 1:3 ~ 'Mod',
n == 0 ~ 'Low'
))
# find the gvhd of the patients
library(vdbR)
connect_database()
get_table_from_database('patient_allo_ks_20221104')
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_a_gvhd, hct)
# what food groups are the high fiber coming from for those patients
highfiber_pt <- DTB %>%
filter(mrn %in% highfiber_4day$mrn & fdrt %in% 0:21) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc))  %>%
mutate(mrn = factor(mrn, levels =pt_order )) %>%
mutate(fdesc = str_sub(fdesc , start = 1,end = 6))
highfiber_pt %>%
ggboxplot(x = 'fdesc', y = 'Fibers_g', orientation = 'horizontal',color = 'fdesc',
add = 'jitter',
ylab = 'Fibers_g') +
facet_wrap(~ mrn , ncol = 6 , scales = 'free' )
ggsave('../data/08_highfiber_pt_fg.pdf', width = 15, height = 25)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
key <- read_csv('../../food_tree/data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
dtb1 <- read_csv('../../food_tree/data/149_finalized_dtb1.csv')
dtb2 <- read_csv('../../food_tree/data/149_finalized_dtb2.csv')
unit <- read_csv('../../food_tree/data/148_both_batches_UNIT_table_EN_exclu.csv')
DTB <- bind_rows(dtb1, dtb2)
colnames(unit)
# distribution of fiber psu
summary(unit$Fiber_psu)
# the percentage of the fiber in dry weight
perc <- unit %>%
mutate(fiber_dry_perc = round(Fiber_psu/dehydrated_psu*100, 2))
# the distribution of the above
summary(perc$fiber_dry_perc)
# the foods that is above the median perc
above2.38 <- perc %>%
filter(fiber_dry_perc >= median(perc$fiber_dry_perc)) %>%
select(food_all, Food_code, description, Fiber_psu, fiber_dry_perc) %>%
distinct(Food_code, description, fiber_dry_perc) %>%
arrange(desc(fiber_dry_perc)) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc)) %>%
mutate(fdesc = fct_reorder(fdesc, fiber_dry_perc, .fun=median, .desc = T))
# make box plot to see the groups and the fiber perc distribution
above2.38 %>%
ggboxplot(x = 'fdesc', y = 'fiber_dry_perc', orientation = 'horizontal',
add = 'jitter',
ylab = 'fiber_g/dry_weight_g %')
above2.38 %>% distinct(fgrp1)
# Fats, Oils & Salad Dressings does not have fiber
# the things in the group 9 that is high in fiber
above2.38 %>%
filter(fgrp1 == '9') %>%
arrange(desc(fiber_dry_perc))
# the patients intake of these foods
# the patients fiber intake during the days 0-21
fiber_per_day <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(fiber_pd = sum(Fibers_g))
fiber_per_day %>%
ggscatter(x = 'fdrt', y = 'fiber_pd', size = 0.5) +
geom_line(aes(group = mrn), color = "grey", alpha = 0.5) +
facet_wrap(~ mrn )
ggsave('../data/08_pt_fiber.pdf', width = 15, height = 15)
# Can you calculate the fiber intake in % per patient and per day, as well as the absolute grams? This way we may be able to inform the mice experiments
# calculate the dry weight of food intake per pt per day
dry_perday <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(dry_pd = sum(dehydrated_weight))
fiber_perc <- fiber_per_day %>%
full_join(dry_perday, by = c("mrn", "fdrt")) %>%
mutate(fiber_percent = round(fiber_pd/dry_pd*100, 2))
fiber_perc %>% write_csv('../data/patients_16s_data/08_patients_fiber_absweight_and_percent.csv')
# day 0-21
fiber_per_day %>%
filter(fdrt %in% 0:21) %>%
ggscatter(x = 'fdrt', y = 'fiber_pd', size = 0.5) +
geom_line(aes(group = mrn), color = "grey", alpha = 0.5) +
facet_wrap(~ mrn )
ggsave('../data/08_pt_fiber_day-21.pdf', width = 15, height = 15)
# see the distribution of the per day fiber eating
summary(fiber_per_day$fiber_pd)
# median for the day 0-21
fiber_per_day_day21 <- fiber_per_day %>%
filter(fdrt %in% 0:21)
summary(fiber_per_day_day21$fiber_pd)
# see what the foods are for the patients that had above 75% fiber
above0.75fiber <- fiber_per_day_day21 %>%
filter(fiber_pd >= quantile(fiber_per_day_day21$fiber_pd, 0.75))
# how many patients
above0.75fiber %>%  distinct(mrn)
# order by the number of days that are high fiber days
above0.75fiber_days <- above0.75fiber %>%
count(mrn, sort = T)
summary(above0.75fiber_days$n)
# at least 4 days of high fiber days patients
highfiber_4day <- above0.75fiber_days %>%
filter(n >= 4)
pt_order <- highfiber_4day %>%
pull(mrn)
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn) )
all_patients_groups <- bind_rows(
all_patients_groups %>% filter(!is.na(n)),
all_patients_groups %>% filter(is.na(n)) %>% mutate(n = 0)
)
all_patients_groups_fiber <- all_patients_groups %>%
mutate(fiber_grp = case_when(
n >= 4 ~ 'High',
n %in% 1:3 ~ 'Mod',
n == 0 ~ 'Low'
))
# find the gvhd of the patients
library(vdbR)
connect_database()
get_table_from_database('patient_allo_ks_20221104')
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_a_gvhd, hct)
# what food groups are the high fiber coming from for those patients
highfiber_pt <- DTB %>%
filter(mrn %in% highfiber_4day$mrn & fdrt %in% 0:21) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc))  %>%
mutate(mrn = factor(mrn, levels =pt_order )) %>%
mutate(fdesc = str_sub(fdesc , start = 1,end = 6))
highfiber_pt %>%
ggboxplot(x = 'fdesc', y = 'Fibers_g', orientation = 'horizontal',color = 'fdesc',
add = 'jitter',
ylab = 'Fibers_g') +
facet_wrap(~ mrn , ncol = 6 , scales = 'free' )
ggsave('../data/08_highfiber_pt_fg.pdf', width = 15, height = 25)
View(all_patients_groups_fiber)
View(highfiber_pt)
# the top 5 patients
top5 <- all_patients_groups_fiber %>%
slice(5)
all_patients_groups_fiber
# the top 5 patients
top5 <- all_patients_groups_fiber %>%
top_n(5, wt = n)
View(top5)
# the top 5 patients
top5 <- all_patients_groups_fiber %>%
slice_max(order_by = n, n = 5)
# the top 5 patients
top5 <- all_patients_groups_fiber %>%
ungroup() %>%
slice_max(order_by = n, n = 5)
View(top5)
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc))  %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
mutate(fdesc = str_sub(fdesc , start = 1,end = 6))
key
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, fgrp1) %>%
summarise(tot_fg = sum(dehydrated_weight))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(tot_fg = sum(dehydrated_weight))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(tot_fg = sum(Fibers_g))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter',
ylab = 'Fibers_g')
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
mutate(shortname = fct_reorder(shortname, daily_fiber, .fun=median, .desc = T)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter',
ylab = 'Fibers_g')
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
mutate(shortname = fct_reorder(shortname, daily_fiber, .fun=median, .desc = F)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter',
ylab = 'Fibers_g')
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g))
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
mutate(shortname = fct_reorder(shortname, daily_fiber, .fun=median, .desc = F)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter',
ylab = 'Fibers_g')
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
mutate(shortname = fct_reorder(shortname, daily_fiber, .fun=median, .desc = F)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter', xlab = '',
ylab = 'Daily fiber intake from each food groups')
ggsave('../data/patients_16s_data/08_Daily fiber intake from each food groups_top5.pdf')
DTB %>%
filter(mrn %in% top5$mrn & fdrt %in% 0:30) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, shortname))  %>%
group_by(mrn, fdrt, shortname) %>%
summarise(daily_fiber = sum(Fibers_g)) %>%
mutate(shortname = fct_reorder(shortname, daily_fiber, .fun=median, .desc = F)) %>%
#mutate(mrn = factor(mrn, levels =pt_order )) %>%
ggboxplot(x = 'shortname', y = 'daily_fiber', orientation = 'horizontal',color = 'shortname',
add = 'jitter', xlab = '',
ylab = 'Daily fiber intake from each food groups')
ggsave('../data/08_Daily fiber intake from each food groups_top5.pdf')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
type <- read_csv('../data/10_patients_foods_fiber_type_all.csv')
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# join with gvhd info of the patients
pts <- read_csv('../../food_tree/data/156_transplant_data.csv') %>%
mutate(d100_a_gvhd = if_else(d100_a_gvhd == 'NE', 'N/E', d100_a_gvhd))
colnames(pts)
pts %>% count(d100_a_gvhd)
# calculate daily intake of each food code
dailycode <- DTB %>%
group_by(mrn, fdrt, Food_code) %>%
summarise(dcodefiber = sum(Fibers_g)) %>%
janitor::clean_names() %>%
filter(dcodefiber > 0) %>%
left_join(type, by = "food_code") %>%
ungroup() %>%
relocate(description, .after = 'soluble') %>%
left_join(pts %>% select(mrn, d100_a_gvhd))
dailycode %>% write_csv('../data/patients_16s_data/11_pt_daily_fiber_type.csv')
dailycode %>% write_csv('../data/11_pt_daily_fiber_type.csv')
#   looking at cellulose over time in patients with GVHD vs no GVHD (geom_point and geom_smooth, colored by GVHD day -30 to +30)
# similarly looking at soluble fibers over time in patients with GVHD vs no GVHD (geom_point and geom_smooth, colored by GVHD day -30 to +30)
# similarly looking at insoluble fibers over time in patients with GVHD vs no GVHD (geom_point and geom_smooth, colored by GVHD day -30 to +30)
all_types <- dailycode %>%
group_by(mrn, d100_a_gvhd, fdrt, fiber_type) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup()
all_types %>% write_csv('../data/patients_16s_data/11_patients_fiber_type_intake.csv')
all_types %>% write_csv('../data/11_patients_fiber_type_intake.csv')
all_types %>%
filter(fdrt %in% -30:30) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE,
add.params = list(color = 'forestgreen', size = 1)) +
facet_grid(~ fiber_type)
ggsave('../data/patients_16s_data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
ggsave('../data/11_fiber_all_type_daily_intake.pdf', width = 15, height = 5)
# what is with the inulin a horizontal line
inulin <- all_types %>%
filter(fiber_type == 'Inulin')
inulin_same_value <- inulin%>%
count(gram, sort = T) %>%
slice(1) %>%
pull(gram)
pt_ate <- inulin %>%
filter(gram == inulin_same_value) %>%
count(mrn, sort = T)
what_ate <- pt_ate %>%
slice(1) %>% pull(mrn)
# one banana a day ....
# what about the Beta-Glucans
all_types %>%
filter(fiber_type == 'Beta-Glucans') %>%
count(gram, sort = T) %>%
slice(1) %>%
pull(gram)
# it's because of breakfast cereal
all_soluble <- dailycode %>%
group_by(mrn, d100_a_gvhd, fdrt, soluble) %>%
summarise(gram = sum(dcodefiber)) %>%
ungroup()
all_soluble %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'brown', size = 1)) +
facet_grid(~ soluble) +
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake.pdf', width = 6, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake.pdf', width = 6, height = 4)
# now join a line of gvhd or not
color_key <- c('#42B440','#EC0000')
names(color_key) <- c('N','Y')
all_soluble %>%
filter(fdrt <= 30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
# now join a line of gvhd or not
color_key <- c('#42B440','#EC0000')
names(color_key) <- c('N','Y')
all_soluble %>%
filter(  d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
# now join a line of gvhd or not
color_key <- c('#42B440','#EC0000')
names(color_key) <- c('N','Y')
all_soluble %>%
filter( fdrt <= 30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'soluble',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key)+
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd.pdf', width = 6, height = 4)
# all of the types of fiber
all_types %>%
filter(fdrt <= 30 & d100_a_gvhd %in% c('Y','N')) %>%
ggscatter(x = 'fdrt', y = 'gram', alpha = 0.05, shape = 16,xlab = 'transplant day',
add = "loess", conf.int = TRUE, title = 'All fiber types',
add.params = list(color = 'd100_a_gvhd', size = 1)) +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
facet_grid(~ fiber_type) +
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_daily_intake_gvhd.pdf', width = 15, height = 4)
ggsave('../data/11_fiber_all_daily_intake_gvhd.pdf', width = 15, height = 4)
# maybe break the fdrt down to weeks
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
View(soluble_week)
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, soluble, timebin)
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, soluble, timebin) %>%
summarise(med_week = median(gram))
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, soluble, timebin) %>%
summarise(med_week = median(gram)) %>%
ggboxplot(x = 'timebin', y = 'med_week', add = 'jitter', add.params = list(alpha = 0.06),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, soluble, timebin) %>%
summarise(med_week = median(gram))
# maybe break the fdrt down to weeks
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
ggboxplot(x = 'timebin', y = 'gram', add = 'jitter', add.params = list(alpha = 0.06),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
# subsample to select the median value for repeated sampling
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, d100_a_gvhd, soluble, timebin) %>%
summarise(med_week = median(gram)) %>%
ggboxplot(x = 'timebin', y = 'med_week', add = 'jitter', add.params = list(alpha = 0.06),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake_gvhd_week_median.pdf', width = 8, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd_week_median.pdf', width = 8, height = 4)
# maybe break the fdrt down to weeks
soluble_week <- all_soluble %>%
mutate(timebin = cut_width(fdrt, 7, boundary=0, closed = 'left'))
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
ggboxplot(x = 'timebin', y = 'gram', add = 'jitter', add.params = list(alpha = 0.06),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
# subsample to select the median value for repeated sampling
soluble_week %>%
filter(d100_a_gvhd %in% c('Y','N')) %>%
group_by(mrn, d100_a_gvhd, soluble, timebin) %>%
summarise(med_week = median(gram)) %>%
ggboxplot(x = 'timebin', y = 'med_week', add = 'jitter', add.params = list(alpha = 0.3),
xlab = 'transplant day', title = 'Soluble',shape = 16,
color = 'd100_a_gvhd') +
facet_grid(~ soluble)  +
scale_color_manual(values = color_key) +
scale_fill_manual(values = color_key) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
scale_y_sqrt()
ggsave('../data/patients_16s_data/11_fiber_all_soluble_daily_intake_gvhd_week_median.pdf', width = 8, height = 4)
ggsave('../data/11_fiber_all_soluble_daily_intake_gvhd_week_median.pdf', width = 8, height = 4)
