arrange(desc(fiber_dry_perc)) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc)) %>%
mutate(fdesc = fct_reorder(fdesc, fiber_dry_perc, .fun=median, .desc = T))
View(above2.38)
# make box plot to see the groups and the fiber perc distribution
above2.38 %>%
ggboxplot(x = 'fdesc', y = 'fiber_dry_perc', orientation = 'horizontal',
add = 'jitter',
ylab = 'fiber_g/dry_weight_g %')
# the things in the group 9 that is high in fiber
above2.38 %>%
filter(fgrp1 == '9') %>%
arrange(desc(fiber_dry_perc))
View(fiber_per_day)
# see the distribution of the per day fiber eating
summary(fiber_per_day$fiber_pd)
# how many patients
above0.75fiber %>%  distinct(mrn)
summary(fiber_per_day_day21$fiber_pd)
# order by the number of days that are high fiber days
above0.75fiber_days <- above0.75fiber %>%
count(mrn, sort = T)
View(above0.75fiber_days)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
key <- read_csv('../../food_tree/data/cleaned_diet_data/food_group_color_key_final.csv', col_types = 'ccccc')
dtb1 <- read_csv('../../food_tree/data/149_finalized_dtb1.csv')
dtb2 <- read_csv('../../food_tree/data/149_finalized_dtb2.csv')
unit <- read_csv('../../food_tree/data/148_both_batches_UNIT_table_EN_exclu.csv')
DTB <- bind_rows(dtb1, dtb2)
colnames(unit)
# distribution of fiber psu
summary(unit$Fiber_psu)
# the percentage of the fiber in dry weight
perc <- unit %>%
mutate(fiber_dry_perc = round(Fiber_psu/dehydrated_psu*100, 2))
# the distribution of the above
summary(perc$fiber_dry_perc)
# the foods that is above the median perc
above2.38 <- perc %>%
filter(fiber_dry_perc >= median(perc$fiber_dry_perc)) %>%
select(food_all, Food_code, description, Fiber_psu, fiber_dry_perc) %>%
distinct(Food_code, description, fiber_dry_perc) %>%
arrange(desc(fiber_dry_perc)) %>%
mutate(fgrp1 = str_sub(as.character(Food_code), 1, 1)) %>%
left_join(key %>% select(fgrp1, fdesc)) %>%
mutate(fdesc = fct_reorder(fdesc, fiber_dry_perc, .fun=median, .desc = T))
# make box plot to see the groups and the fiber perc distribution
above2.38 %>%
ggboxplot(x = 'fdesc', y = 'fiber_dry_perc', orientation = 'horizontal',
add = 'jitter',
ylab = 'fiber_g/dry_weight_g %')
above2.38 %>% distinct(fgrp1)
# Fats, Oils & Salad Dressings does not have fiber
# the things in the group 9 that is high in fiber
above2.38 %>%
filter(fgrp1 == '9') %>%
arrange(desc(fiber_dry_perc))
# the patients intake of these foods
# the patients fiber intake during the days 0-21
fiber_per_day <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(fiber_pd = sum(Fibers_g))
fiber_per_day %>%
ggscatter(x = 'fdrt', y = 'fiber_pd', size = 0.5) +
geom_line(aes(group = mrn), color = "grey", alpha = 0.5) +
facet_wrap(~ mrn )
ggsave('../data/08_pt_fiber.pdf', width = 15, height = 15)
View(fiber_per_day)
View(DTB)
View(DTB)
# Can you calculate the fiber intake in % per patient and per day, as well as the absolute grams? This way we may be able to inform the mice experiments
# calculate the dry weight of food intake per pt per day
dry_perday <- DTB %>%
group_by(mrn, fdrt) %>%
summarise(dry_pd = sum(dehydrated_weight))
View(fiber_per_day)
fiber_perc <- fiber_per_day %>%
full_join(dry_perday)
fiber_perc <- fiber_per_day %>%
full_join(dry_perday, by = c("mrn", "fdrt"))
View(fiber_perc)
fiber_perc
fiber_perc <- fiber_per_day %>%
full_join(dry_perday, by = c("mrn", "fdrt")) %>%
mutate(fiber_percent = round(fiber_pd/dry_pd*100, 2))
fiber_perc %>% write_csv('../data/patients_16s_data/08_patients_fiber_absweight_and_percent.csv')
# median for the day 0-21
fiber_per_day_day21 <- fiber_per_day %>%
filter(fdrt %in% 0:21)
summary(fiber_per_day_day21$fiber_pd)
above0.75fiber <- fiber_per_day_day21 %>%
filter(fiber_pd >= quantile(fiber_per_day_day21$fiber_pd, 0.75))
# order by the number of days that are high fiber days
above0.75fiber_days <- above0.75fiber %>%
count(mrn, sort = T)
View(above0.75fiber_days)
View(above0.75fiber_days)
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above %>%
full_join(DTB %>% distinct(mrn))
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn))
View(all_patients_groups)
all_patients_groups
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn)) %>%
mutate(n = if_else(is.na(n), 0, n))
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn)) %>%
mutate(n = if_else(is.na(n), 0, n))
?full_join
all_patients_groups %>% filter(is.na(n))
all_patients_groups <- bind_rows(
all_patients_groups %>% filter(!is.na(n)),
all_patients_groups %>% filter(is.na(n)) %>% mutate(n = 0)
)
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn) )
all_patients_groups <- bind_rows(
all_patients_groups %>% filter(!is.na(n)),
all_patients_groups %>% filter(is.na(n)) %>% mutate(n = 0)
)
# - can you classify patients based on how many days they had high fiber diet (between days 0 and 21) in 3 groups:
#     - High fiber: at least 4 days of high fiber diet
#     - Mod fiber: 1-3 days of high fiber diet
#     - Low fiber: no high fiber diet
all_patients_groups <- above0.75fiber_days %>%
full_join(DTB %>% distinct(mrn) )
all_patients_groups <- bind_rows(
all_patients_groups %>% filter(!is.na(n)),
all_patients_groups %>% filter(is.na(n)) %>% mutate(n = 0)
)
all_patients_groups
all_patients_groups_fiber <- all_patients_groups %>%
mutate(fiber_grp = case_when(
n >= 4 ~ 'High',
n %in% 1:3 ~ 'Mod',
n == 0 ~ 'Low'
))
View(all_patients_groups_fiber)
# find the gvhd of the patients
library(vdbR)
connect_database()
list('patient')
list_table_from_database('patient')
get_table_from_database('patient_allo_ks_20221104')
View(patient_allo_ks_20221104)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn)
View(pt_clinincal)
get_table_from_database('patient_allo_ag')
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn)
colnames(pt_clinincal)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn) %>%
colnames(pt_clinincal_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn) %>%
colnames(pt_clinincal_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn) %>%
colnames(pt_clinincal_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn)
get_table_from_database('patient_allo_ag')
get_table_from_database('patient_allo_ks_20221104')
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn)
colnames(pt_clinincal_old)
pt_clinincal_old <- patient_allo_ag %>%
filter(mrn %in% DTB$mrn)  %>%
select(mrn, gvhd)
length(union(pt_clinincal$mrn, pt_clinincal_old$mrn))
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old)
View(pt_clinincal)
View(pt_clinincal_old)
View(pt_clinincal)
View(pt_clinincal_old)
colnames(patient_allo_ks_20221104)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_gvhd)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_gvhd)
colnames(patient_allo_ks_20221104)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_a_gvhd)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_a_gvhd, hct)
pt_clinincal <- patient_allo_ks_20221104 %>%
filter(mrn %in% DTB$mrn) %>%
select(mrn, gvhd_old, d100_a_gvhd, hct)
View(pt_clinincal)
View(pt_clinincal)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3)
View(types)
View(types)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3)
types
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100)
View(types)
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
View(DTB)
types
types
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food))
View(types)
types
types
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
dtb_find <- DTB %>%
distinct(Food_NSC)
unique_foodnsc <- DTB %>%
distinct(Food_NSC, Food_code, description)
?str_detect
View(unique_foodnsc)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
unique_foodnsc
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
View(found)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''))
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
View(found)
View(found[["bran"]])
View(found[["cherrie"]])
View(found[["frie"]])
View(found[["fruit"]])
View(found[["goldfish"]])
View(found[["italian wedding"]])
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
View(notfound)
# names of the not found food
names(notfound)
View(unique_foodnsc)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
ood = str_replace(Food, '_$',''))
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
ood = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
# names of the not found food
names(notfound)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
# names of the not found food
names(notfound)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
# names of the not found food
names(notfound)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
# names of the not found food
names(notfound)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
types <- readxl::read_excel('../data/148_both_batches_UNIT_table_EN_exclu_UPDATEDJP (1).xlsm', sheet = 3) %>%
mutate(fraction = Percentage/100) %>%
mutate(Food = str_to_lower(Food),
Food = str_replace(Food, 's$',''),
Food = str_replace(Food, '_$',''))
DTB <- read_csv('../../food_tree/data/152_combined_DTB.csv')
# find how many food_nsc have each of the "Food"
unique_food <- types %>%
distinct(Food) %>% pull(Food)
unique_foodnsc <- DTB %>%
mutate(Food_NSC = str_to_lower(Food_NSC)) %>%
distinct(Food_NSC, Food_code, description)
found <- unique_food %>%
set_names(unique_food) %>%
map(function(food_str){
unique_foodnsc %>%
filter(str_detect(Food_NSC, food_str))
})
# the foods that have no matches
notfound <- found %>%
keep( ~ nrow(.) == 0)
# names of the not found food
names(notfound)
View(types)
DTB %>% distinct(description)
# names of the not found food
names(notfound)
DTB %>%
distinct(mrn, fdrt)
